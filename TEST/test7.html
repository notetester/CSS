<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
        <title>Megabox</title>
        <link rel="stylesheet" href="https://www.megabox.co.kr/static/pc/dist/megabox.min.css" media="all"><style type="text/css">
            /* FDK 결제용 CSS */
            /* table { margin: 1em; border-collapse: collapse; }
            td, th { padding: .3em; border: 1px #ccc solid; font-size:12px; }
            thead { background: #fc9; }
            thead .white { background: #fff; }
            input { background-color: #ffffff; border: #bbbbbb 1px solid; font-size: 9pt; height: 20px; width: 250px;}
            select { background-color: #ffffff; border-bottom: #a5a4a4 1px solid; border-left: #a5a4a4  1px solid; border-right: #a5a4a4  1px solid; border-top: #a5a4a4 1px solid; font-size: 9pt; height: 20px } */
        
            /* LAYER POPUP STYLE START */
            .fdLayer {display:none; position: absolute; top: 50%; left: 50%; height:auto;  background-color:#fff; border: 5px solid rgb(0, 66, 101); z-index: 10;}
            .fdLayer .fdContainer {padding: 3px;}
            .fdLayer .fdBtn {width: 100%; margin:10px 0 0; padding-top: 10px; border-top: 1px solid #DDD; text-align:right;}
            a.closeBtn {display:inline-block; height:25px; padding:0 14px 0; border:1px solid #304a8a; background-color:rgb(0, 32, 61); font-size:13px; color:#fff; line-height:25px;}
            a.closeBtn:hover {border: 1px solid #091940; background-color:#1f326a; color:#fff;}
            #mask { position:absolute; left:0; top:0; z-index:9; background-color:#000; display:none;}
            /* LAYER POPUP STYLE END */
        
            /* 할인수단 FONT size 변경처리 (기본15px;)*/
            span.txt{ font-size : 13px;}
        </style><script src="https://www.megabox.co.kr/static/pc/js/jquery-1.12.4.js"></script><script src="https://www.megabox.co.kr/static/pc/js/jquery-ui.1.12.1.js"></script><script src="https://www.megabox.co.kr/static/pc/js/gsaps.js"></script><script src="https://www.megabox.co.kr/js/megaboxCom.js"></script><script src="https://www.megabox.co.kr/js/common/mega.prototype.js"></script><script src="https://www.megabox.co.kr/js/common/commons.js"></script><script src="https://www.megabox.co.kr/static/pc/js/bootstrap-custom.js"></script><script src="https://www.megabox.co.kr/static/pc/js/bootstrap-select.js"></script><script type="text/javascript" src="https://www.megabox.co.kr/js/netfunnel/netfunnel.js" charset="UTF-8"></script><script type="text/javascript" src="https://www.megabox.co.kr/js/netfunnel/netfunnel_skin.js" charset="UTF-8"></script><script type="text/javascript" src="https://www.megabox.co.kr/js/netfunnel/netfunnel_frm.js" charset="UTF-8"></script><script type="text/javascript">
            var _init = {
                cache	: Date.now(),
                path	: '/static/pc/js/'
            };
        
            var sysCd = 'ON';
        
              //넷퍼넬 스킨 타입 지정
            NetfunnelChk.setting( sysCd, MegaboxUtil.Common.isApp() );
        </script><script type="text/javascript">
        
            //예매 사용 카드번호 체크
            $.fn.megaBoxCardNumberCheck = function() {
                $(this).on("keypress",function(e){
                    if ( !e.key.isNumber() && e.key != '-') return false;
                })
                $(this).on("focus",function(e){
                    $(this).val($('#'+$(this).attr('id')+'_hid').val());
                })
                $(this).on("focusout",function(e){
                    var val = $(this).val().replace(/[^0-9]+/g, '');
                    $(this).val(val);
                    $('#'+$(this).attr('id')+'_hid').val(val);
        
                    var makNo = $(this).val().maskCardNo();
                    var varArr = makNo.split('-');
                    if (varArr.length > 3) {
                        varArr[2] = varArr[2].replaceAll(/[0-9]/g, '*');
                    }
        
                    $(this).val(varArr.join("-"));
                })
            };
        
        
            //예매 금액 체크
            $.fn.megaBoxCommaNumberCheck  = function() {
                $(this).on("keypress",function(e){
                    if ( !e.key.isNumber() && e.key != ',') return false;
                })
                $(this).on("focusout",function(e){
                    $(this).val($(this).val().replace(/[^0-9]+/g, ''));
                    $(this).val($(this).val().maskNumber() );
                })
            };
        
            var _init = {
                cache	: Date.now(),
                path	: '/static/pc/js/'
            };
        
        
            document.write(
                '<script src="'+_init.path+'ui.common.js?v='+_init.cache+'"><\/script>'+
                '<script src="'+_init.path+'front.js?v='+_init.cache+'"><\/script>'
            );
        
        
            $(function() {
        
                // 체크 활성화
                /*
                $(document).on('click', '.discout-setting .discout-list .item a', function(){
                    $(this).closest('.item').addClass('on');
                });
        
                // 체크 해제 == 취소
                $(document).on('click', '.discout-setting .discout-list .item .btn-cancel', function(){
                    $(this).closest('.item').removeClass('on');
                });
                */
        
                $(window).on('load', function(){
        
                    
                });
        
        
                //페이지 나가는 경우 선점 취소(윈도우창 닫기에만 실행)
                $(window).on("beforeunload", function (e){
                    var transNo = $("#transNo").val();
                    var paramData = { transNo:transNo };
                    if ($("#completeYn").val() != "Y" && $("#prepareYn").val() == "Y" && $("#goBackYn").val() != "Y") {  //예매완료로 이동시는 제외, 결제 준비 완료시에만, 뒤로가기 제외(자체 버튼 클릭시 초기화)
                        $.ajax({
                            url: "/on/oh/ohz/PayBooking/initOccupSeat.do",
                            type: "POST",
                            contentType: "application/json;charset=UTF-8",
                            dataType: "json",
                            data: JSON.stringify(paramData),
                            success: function (data, textStatus, jqXHR) {
                            },
                            error: function(xhr,status,error){
                            }
                        });
                    }
                });
        
        
                //vip쿠폰 클릭 이벤트(vip 쿠폰은 오픈시 바로 조회)
                $('#btn_pay_vipCpon').on('click', function() {
                    //vip 쿠폰 데이터 유무에 따라서 초기화 실행
                    //if (getInitVipcponCnt() == 0) {
                    if (!$(this).hasClass('disabled')) {
                        if ($('#btn_cancel_apply_vipCpon').css('display') == 'none') {
                            searchVipCpon();
                        }
                    }
                });
        
                //스토어교환권 클릭 이벤트
                $('#btn_pay_scoupon').on('click', function() {
                    //스토어교환권 데이터 유무에 따라서 초기화 실행
                    //if (getInitStoreChgCnt() == 0) {
                    if (!$(this).hasClass('disabled')) {
                        if ($('#btn_cancel_apply_scoupon').css('display') == 'none') {
                            searchStoreChg();
                        }
                    }
                });
        
                //영화할인쿠폰 클릭 이벤트
                $('#btn_pay_dcoupon').on('click', function() {
                    //영화관람권 데이터 유무에 따라서 초기화 실행
                    //if (getInitDcouponChgCnt() == 0) {
                    if (!$(this).hasClass('disabled')) {
                        if ($('#btn_cancel_apply_dcoupon').css('display') == 'none') {
                            searchDcouponChg();
                        }
                    }
                });
        
                //영화관람권 클릭 이벤트
                $('#btn_pay_mcoupon').on('click', function() {
                    //스토어교환권 데이터 유무에 따라서 초기화 실행
                    //if (getInitMcouponChgCnt() == 0) {
                    if (!$(this).hasClass('disabled')) {
                        if ($('#btn_cancel_apply_mcoupon').css('display') == 'none') {
                            searchMcouponChg();
                        }
                    }
                });
        
                //멤버십 포인트 클릭 이벤트
                $('#btn_pay_memp').on('click', function() {
                    if (!$(this).hasClass('disabled')) {
                        if ($('[id^="memp_chk_point_"]:checked').length == 0) {
                            searchMempPoint();
                        }
                    }
                });
        
        
                //중앙 패밀리 포인트 클릭 이벤트
                $('#btn_pay_jfamily').on('click', function() {
                    if (!$(this).hasClass('disabled')) {
                        if ($('#btn_cancel_apply_jfamily').css('display') == 'none') {
                            searchChkJfamily();
                        }
                    }
                });
        
        
                //다음에도 이 결제수단 사용 클릭
                $("#same_use_payment").on('click', function() {
                    savePaymentSelect();
                });
        
                //결제수단 라디오버튼 클릭
                $(':radio[name="radio_payment"]').on('click', function() {
                    $('#lastPayMethod').val($(this).val());
        
                    if ($(this).val() == 'credit') {
                        $(".select-payment-card").show();
                    } else {
                        $(".select-payment-card").hide();
                    }
        
                    if ( $(this).val() == 'credit' && $(':radio[name="rdo_card_select"]:checked').val() == '00' ){
                        $('#btn_booking_pay').attr('href', '#layer_favor_credit').attr('w-data', '600').attr('h-data', '500');
                    } else {
                        $('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
                    }
        
                    if( $("#card_select option:selected").val() == '00' ) {
                        $('#app_card').hide();
                        $('#lab_app_card').hide();
                        $('#general_card').hide();
                        $('#lab_general_card').hide();
                    } else {
                        $('#app_card').show();
                        $('#lab_app_card').show();
                        $('#general_card').show();
                        $('#lab_general_card').show();
                    }
        
                    savePaymentSelect();  //결제수단 저장
        
                    fn_dispPayAlertMsg(); //알림 문구 노출
        
        
                });
        
                //최종 결제수단 변경시 명칭 세팅
                $(':radio[name="radio_payment"]').on('change', function() {
                    changePaymentName();
                });
        
                //결제버튼 클릭
                $('#btn_booking_pay').on('click', function() {
        
                    var selCard       = $("#card_select option:selected").val();
                    var selSpCard     = $(':radio[name="rdo_card_select"]:checked').val();
                    var lastPayMethod = $('#lastPayMethod').val();
        
                    $('#preDisc').val('');
                    $('#discType').val('');
        
        // 			if($('#rdo_pay_credit').is(":disabled")){
        // 				$('#btn_booking_pay').attr('href', '#layer_favor_credit').attr('w-data', '600').attr('h-data', '500');
        // 			} else {
        // 				$('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
        // 			}
        
                    //현대M포인트 사용
                    if ($('#btn_cancel_hydm').length > 0) {
                        if ($('#btn_cancel_hydm').css('display') != "none") {
                            $('#preDisc').val('Y');
                            $('#discType').val('HYUNM');
                            payHyMPoint();
                            return;
                        }
                    }
        
                    //문화누리 사용
                    if ($('#btn_cancel_culturenuri').length > 0) {
                        if ($('#btn_cancel_culturenuri').css('display') != "none") {
                            $('#preDisc').val('Y');
                            $('#discType').val('CULTURE');
                            payCulturenuri();
        
                            return;
                        }
                    }
        
                    // 카카오뱅크 할인
                    if ( selCard == "90" && selSpCard == "02" && lastPayMethod == 'credit') {
                        $('#preDisc').val('Y');
                        $('#discType').val('KAKAOPRE');
                        chkPrePayAmt();
                        return;
                    }
        
                    //bc 선할인
                    if (selCard == "01" && selSpCard == "02" && lastPayMethod == 'credit') {
                        //bc 결제화면 팝업
                        $('#preDisc').val('Y');
                        $('#discType').val('BCPRE');
                        $('#pre_disc_pop').click();
                        return;
                    }
        
                    // 구인증
                    if(selSpCard == "00" && lastPayMethod == 'credit') {
                        favorCreditCard_init();
        
                        var chkRemainAmt = $('.pay-area > .pay').eq(0).find('.money').find('em').text().replaceAll(',', '');
                        if (parseInt(chkRemainAmt) == 0) {
                            $('#btn_booking_ria_pay').addClass('disabled');  //리아결제 팝업 오픈 방지
                            chkLastPayAmt();
                        }
                        return;
                    }
        
                    // 모바일 결제시 상영월과 결제 월이 다른경우 결제 못하도록
                    if($(':radio[name="radio_payment"]:checked').val() == 'mobile') {
                        var playDe = $('#playDe').text().replaceAll('.', '').substr(4,2);
        
                        var date = new Date();
                        var month = date.getMonth()+1; //January is 0!
                        if(month < 10){
                            month = '0'+month;
                        }
        
                        if(playDe != month){
        
                            // 익월 예매건은 휴대폰결제가 불가합니다.\\n다른 결제수단을 이용바랍니다.
                            gfn_alertMsgBox('익월 예매건은 휴대폰결제가 불가합니다.\n다른 결제수단을 이용바랍니다.');
                            return false;
                        }
                    }
        
                    //최종 금액 점검
                    chkLastPayAmt();
                });
        
        
                //리아결제버튼 클릭
                $('#btn_booking_ria_pay').on('click', function(e) {
                    teller_init();
        
                    var chkRemainAmt = $('.pay-area > .pay').eq(0).find('.money').find('em').text().replaceAll(',', '');
                    if (parseInt(chkRemainAmt) == 0) {
                        $('#btn_booking_ria_pay').addClass('disabled');  //리아결제 팝업 오픈 방지
                        chkLastPayAmt();
                    }
                });
        
                //구인증 클릭
                $('#btn_booking_favor_credit_pay').click(function() {
                    favorCreditCard_init();
        
                    var chkRemainAmt = $('.pay-area > .pay').eq(0).find('.money').find('em').text().replaceAll(',', '');
                    if (parseInt(chkRemainAmt) == 0) {
                        $('#btn_booking_ria_pay').addClass('disabled');  //리아결제 팝업 오픈 방지
                        chkLastPayAmt();
                    }
                });
        
        
                //초기화 버튼 클릭
                $('#btn_booking_init').on('click', function() {
                    payRefresh();	//2019.07.24 화면 reload 가 아닌 적용수단 해제
                });
        
                //삭제 버튼 이벤트 적용(공통)
                $('.btn-delete').on('click', function() {
                    var sMethodName   = $(this).attr('method');
                    var options       = {};
                    options.msg       = '적용 내역을 취소하시겠습니까?';
                    options.confirmFn = delApplyMethod;
                    options.param     = {confirm:sMethodName} ;
                    options.minWidth  = 400;
                    options.minHeight = 300;
                    gfn_confirmMsgBox(options);
                });
        
        
                //삭제 버튼 이벤트 적용(공통)
                $('.btn-cancel').on('click', function() {
                    var sMethodName   = $(this).attr('method');
                    var options       = {};
                    options.msg       = '적용 내역을 취소하시겠습니까?';
                    options.confirmFn = delApplyMethod;
                    options.param     = {confirm:sMethodName} ;
                    options.minWidth  = 400;
                    options.minHeight = 300;
                    gfn_confirmMsgBox(options);
        
                });
        
                //이전버튼 클릭
                $('#btn_booking_back').on('click', function() {
                    initOccupSeat('back');
                });
        
                //카드선택
                $('#card_select').on('change', function() {
                    var selVal = $("#card_select option:selected").val();
                    var isNotUseSpecial = selVal.indexOf("B")==0?true:false;	// B로 시작하는 카드는 즉시할인 영역을 보여주지 않는다.
        
                    if(selVal.indexOf("B")==0){
                        
                        selVal = "01";
                    }else if(selVal.indexOf("S")==0){
                        
                        selVal = "03";
                    }
        
                    if(selVal == '00'){
                        $('#app_card').hide();
                        $('#lab_app_card').hide();
                        $('#general_card').hide();
                        $('#lab_general_card').hide();
                    } else {
                        $('#app_card').show();
                        $('#lab_app_card').show();
                        $('#general_card').show();
                        $('#lab_general_card').show();
                    }
        
                    if (selVal == "01" || selVal == "03" ||  selVal == "27" || (selVal == "90" && 20200730 >= 20200801)) {	//비씨, 삼성, 하나 선택시
                        $('#sepecial_card').show();
                        $('#lab_sepecial_card').show();
                        var selText = "";
        
                        if (selVal == "01" || (selVal == "90" && 20200730 >= 20200801)) {
                            selText = "즉시할인";<!-- BC 즉시할인카드 -->
                        } else if (selVal == "03") {
                            selText = "포인트사용";<!-- 삼성카드 보너스포인트 -->
                        } else if (selVal == "27") {
                            selText = "하나머니";<!-- 하나머니 -->
                        }
                        $('#lab_sepecial_card').text(selText);
                    } else {
                        $('#sepecial_card').hide();
                        $('#lab_sepecial_card').hide();
                    }
        
                    // B로 시작하는 카드는 즉시할인 영역을 보여주지 않는다.
                    if(isNotUseSpecial){
                        $('#sepecial_card').hide();
                        $('#lab_sepecial_card').hide();
                    }
        
                    // 항목 변경 시 첫번째 항목 선택처리, 최초에는 DB에서 조회된 값을 설정
                    var initVal = $(this).data('init');
                    if(initVal){
                        $(this).data('init', '');
                        $(':radio[name="rdo_card_select"]:input[value="'+initVal+'"]').prop('checked', true);
                    }else{
                        $(':radio[name="rdo_card_select"]:input[value="01"]').prop('checked', true);
                    }
        
                    
                    if ( selVal == '07' || selVal == '02' || selVal == '03' || selVal == '05' || selVal == '12'
                            || selVal == '04' ||selVal == '13' ||selVal == '14' || selVal == '27'){
                        $('#lab_app_card').text('앱카드'); //앱카드
                    } else { 
                        $('#lab_app_card').text('ISP'); //ISP
                    }
        
                    if ( $(':radio[name="radio_payment"]:checked').val() == 'credit' && $(':radio[name="rdo_card_select"]:checked').val() == '00' ){
                        $('#btn_booking_pay').attr('href', '#layer_favor_credit').attr('w-data', '600').attr('h-data', '500');
                    } else {
                        $('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
                    }
        
                    savePaymentSelect();
                });
        
                //특수카드 선택
                $(':radio[name="rdo_card_select"]').on('change', function() {
                    savePaymentSelect();
        
                    if ( $(':radio[name="radio_payment"]:checked').val() == 'credit' && $(':radio[name="rdo_card_select"]:checked').val() == '00' ){
                        $('#btn_booking_pay').attr('href', '#layer_favor_credit').attr('w-data', '600').attr('h-data', '500');
                    } else {
                        $('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
                    }
                });
        
                //관람권 할인영역 클릭
                $(document).on('click', '.discout-setting .discout-list ul li .tit', function(e){
                    e.preventDefault();
                    $(this).closest('.discout-list').find('li').removeClass('on');
                    $(this).closest('li').addClass('on');
        
                    var height = $('.inner-wrap').outerHeight();
                    parent.calcFrameHeight($('#bokdMPayBooking', parent.document), $('#framePayBooking', parent.document));
                });
        
        
                
        
                //5분 연장하기
                $('#delayFiveMin').on('click', function() {
                    var transNo   = $("#transNo").val();
                    var paramData = {transNo:transNo};
        
                    $.ajax({
                        url: "/on/oh/ohz/PayBooking/appendPayBookingTime.do",
                        type: "POST",
                        contentType: "application/json;charset=UTF-8",
                        dataType: "json",
                        data: JSON.stringify(paramData),
                        success: function (data, textStatus, jqXHR) {
                            //알림메시지 노출
                            if (data.msg != null && data.msg !="") {
                                gfn_alertMsgBox(data.msg);
                            }
        
                            if (!msgBookingLoginChk(data)) {
                                return;
                            }
        
                            $('#delayFiveMinClose').click();
                        },
                        error: function(xhr,status,error){
                            var err = JSON.parse(xhr.responseText);
                            //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                            errBookingChk(err.msg);
                        }
                    });
                });
        
            });
        
        
            //중앙패밀리 조회
            function searchChkJfamily() {
                var transNo    = $("#transNo").val();
        
                //추후 중앙 그룹ID 적용 필요
                var paramData  = {transNo:transNo, usrId:parent.usrId};
        
                $.ajax({
                  url: "/on/oh/ohz/PayBooking/searchJoongAngFamily.do",
                  type: "POST",
                  contentType: "application/json;charset=UTF-8",
                  dataType: "json",
                  data: JSON.stringify(paramData),
                  success: function (data, textStatus, jqXHR) {
                      //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    var jfamilyUseAbleAmt = data.jfamilyInfo.useAbleAmt;
                    var chkRemainAmt = parseInt($('.pay-area > .pay').eq(0).find('.money').find('em').text().replaceAll(',', '').nvlNum(0));
                    if (jfamilyUseAbleAmt < chkRemainAmt) {
                        $('#btn_pay_jfamily').addClass("no-event");
                        gfn_alertMsgBox("보유하신 포인트가 결제금액보다 적습니다.");
                    } else {
        
                        if ($('#btn_pay_jfamily').hasClass("no-event")) {
                            $('#btn_pay_jfamily').removeClass("no-event");
                            $('#btn_pay_jfamily').click();
                        } else {
                            searchJfamily();
                        }
                    }
                  },
                  error: function(xhr,status,error){
                      var err = JSON.parse(xhr.responseText);
                      //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                      errBookingChk(err.msg);
                  }
                });
            }
        
        
            //결제수단 명칭 세팅
            function changePaymentName(policyList) {
                var chk_payment  = $(':radio[name="radio_payment"]:checked');
                var id_payment   = $(chk_payment).attr('id');
                var text_payment = $('label[for="'+id_payment+'"]').text();
        
                if (text_payment == null) {
                    text_payment = "";
                }
        
                
                    //전체금액
                    var allSumAmt = parseInt($('.price-process > .box').eq(0).find('.all').find('em').text().replaceAll(',', '').nvlNum(0));
                    //할인금액
                    var allDiscAmt = parseInt($('.price-process > .box').eq(1).find('.all').find('em').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0));
                    //추가금액
                    var allAddAmt = parseInt($('.pay-area > .add-thing').eq(0).find('.money').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0).replaceAll('+', '').nvlNum(0));
                    //최종결제금액
                    var remainAmt = allSumAmt + allAddAmt - allDiscAmt;
        
                    //현대M포인트, 문화누리 사용시 별도표기
        
                    //현대 M 포인트, 문화누리 사용시 결제수단 disabled
                    var hyCultApply = '';
                    var hyCultName  = '';
                    if (policyList != null && policyList != undefined) {
                        for(var i=0;i<policyList.length;i++) {
                            if (('hydm' == policyList[i].methodName || 'culturenuri' == policyList[i].methodName) && policyList[i].applyAmt > 0) {
                                hyCultApply = policyList[i].methodName;
                                break;
                            }
                        }
                    }
        
                    if (hyCultApply) {
                        $('.payment-thing').show();
                        if (hyCultApply == 'hydm') {
                            $('.payment-thing > .thing').text('현대 M 포인트 카드');
                        } else {
                            $('.payment-thing > .thing').text('문화누리카드');
                        }
                    } else {
                        //금액이 0인 경우
                        if (remainAmt == 0) {
                            $('.payment-thing').hide();
                        } else {
                            $('.payment-thing').show();
                            $('.payment-thing > .thing').text(text_payment);
                        }
                    }
                
        
                
        
                
            }
        
        
            //기본 결제 수단 선택 : 2019.11.06 쿠키저장 -> db 저장 방식으로 변경
            function savePaymentSelect() {
        
                if ($("#prepareFavorYn").val() == "Y") {  //최초 세팅시는 제외
                    //메가박스만 대상
                    
        
                    var use_payment = $(':radio[name="radio_payment"]:checked').val();
        
                    var favorPayMeanCd;
                    var favorCardcmCd;
                    var favorCardDiv;
        
                    if ($(":checkbox[id='same_use_payment']:checked").length > 0) {
                        favorPayMeanCd = use_payment;
                        if (use_payment == 'credit') {
                            var selectCard  = $("#card_select option:selected").val();
                            var selSpCard   = $(':radio[name="rdo_card_select"]:checked').val();
        
                            favorCardcmCd = selectCard;
                            favorCardDiv  = selSpCard;
                        }
        
                    } else {
        
                        favorPayMeanCd = "";
                        favorCardcmCd  = "";
                        favorCardDiv   = "";
                    }
        
                    switch (favorPayMeanCd){
                      case "mobile" :
                          favorPayMeanCd = "FPM02";
                          break;
                      case "kakaopay" :
                          favorPayMeanCd = "FPM03";
                          break;
                      case "payco" :
                          favorPayMeanCd = "FPM04";
                          break;
                      case "credit" :
                          favorPayMeanCd = "FPM01";
                          break;
                      default :
                          favorPayMeanCd = "";
                    }
        
                    var paramData  = {favorPayMeanCd:favorPayMeanCd, favorCardcmCd:favorCardcmCd, favorCardDiv:favorCardDiv};
        
                    $.ajax({
                        url: "/on/oh/ohz/PayBooking/saveFavorPayMean.do",
                        type: "POST",
                        contentType: "application/json;charset=UTF-8",
                        dataType: "json",
                        data: JSON.stringify(paramData),
                        success: function (data, textStatus, jqXHR) {
                            //console.log(data);
                            if (!msgBookingLoginChk(data)) {
                                return;
                            }
                        },
                        error: function(xhr,status,error){
                            var err = JSON.parse(xhr.responseText);
                            //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                            errBookingChk(err.msg);
                        }
                    });
                }
            }
        
        
            //화면 초기화(전체 수단 삭제)
            function payRefresh() {
                //적용수단 일괄삭제
                $('.btn-delete').each(function(idx) {
                    if (idx == 0) {  //순차적으로 호출
                        var sMethodName   = $(this).attr('method');
                        cancelMbxSellCpInfoAll(sMethodName);
                    }
                });
        
                $("#cashBillYn").val("");
                $("#cashrecIssueCd").val("");
            }
        
        
            //적용 할인 결제 수단 일괄 초기화
            function cancelMbxSellCpInfoAll(sMethodName) {
                var transNo       = $("#transNo").val();
                var paramData     = {transNo:transNo, methodName:sMethodName};
        
                if (sMethodName == "") {
                    return;
                }
        
                //초기화시 순차적용을 위해 sync 처리
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/cancelMbxSellCpInfo.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
        
                        //할인내역 갱신
                        setMovieDcInfo(data.policyList);
        
                        //각 수단별 팝업 초기화(모든 팝업 공통)
                        try {
                            eval(sMethodName+'_init()');
                            //삭제버튼 숨김
                            $('#btn_cancel_'+sMethodName).hide();
                            //레이어내 적용취소버튼 숨김
                            if ($('#btn_cancel_apply_'+sMethodName).length > 0) {
                                $('#btn_cancel_apply_'+sMethodName).hide();
                            }
        
                        } catch(e){
                            //console.log("초기화 대상 없음.....");
                        }
        
                        payRefresh();  //재귀호출
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
                    }
                });
            }
        
        
            //좌석선택 완료
            function completeSeat() {
                var playSchdlNo   = $("#playSchdlNo").val();
                var seatOccupText = $("#seatOccupText").val();
                var totalAmt      = $("#totalAmt").val();
                var paramData     = {playSchdlNo:playSchdlNo, seatOccupText:seatOccupText, totalAmt:totalAmt};
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/preCompleteSeat.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
                        $('a[name*="btn_pay"]').addClass('disabled');
                        $("#transNo").val(data.transNo);
        
                        $("#prepareYn").val("Y");  //결제 준비여부세팅
        
                        prepareBooking();
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        errBookingChk(err.msg);
                    }
                });
            }
        
        
            //결제 준비
            function prepareBooking() {
                var playSchdlNo   = $("#playSchdlNo").val();
                var seatOccupText = $("#seatOccupText").val();
                var totalAmt      = $("#totalAmt").val();
                var transNo       = $("#transNo").val();
                var paramData     = {playSchdlNo:playSchdlNo, seatOccupText:seatOccupText, totalAmt:totalAmt, transNo:transNo};
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/prepareBooking.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
        
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
        
                        /*
                        2019.07.31 기능 삭제
                        //vip 쿠폰 수
                        if (data.vipCponCnt != null && data.vipCponCnt != undefined) {
                            $('#btn_pay_vipCpon .result').text(data.vipCponCnt + ' 매');
                        }
        
                        //영화관람권 수
                        if (data.movieCponCnt != null && data.movieCponCnt != undefined) {
                            $('#btn_pay_mcoupon .result').text(data.movieCponCnt + ' 매');
                        }
        
                        //멤버십 포인트 금액
                        if (data.mebershipPoint != null && data.mebershipPoint != undefined) {
                            $('#btn_pay_memp .result').text(String(data.mebershipPoint).maskNumber() + ' P');
                        }
                        */
        
                        //블랙리스트 결과 체크
                        var dataBlackListAt = data.blackMap.result;
                        if(dataBlackListAt  == "Y"){
                            //블랙리스트 안내 메세지 표시
                            var blackListParam = { bokdAbleBrch: data.blackMap.bokdAbleBrch
                                                 , bokdAbleCnt: data.blackMap.bokdAbleCnt
                                                 , bokdAbleQty: data.blackMap.bokdAbleQty
                                                 }
        
                            parent.fn_altBlackgoPrePagePayBooking(blackListParam);  //좌석도로 이동
                            return;
                        }
        
                        //메가박스 회원인 경우에만 노출
                        var exist = data.returnMap.mbIdntfcDivCd;
                        
                            
                                if (data.returnMap.mbIdntfcDivCd == "MEMID01") {
                                    var favorMap = data.favorMap;
                                    var favorPayMeanCd = "";
                                    var favorCardcmCd  = "";
                                    var favorCardDiv   = "";
        
                                    if (favorMap != null && favorMap != undefined) {
        
                                        switch (favorMap.favorPayMeanCd){
                                          case "FPM02" :
                                              favorPayMeanCd = "mobile";
                                              break;
                                          case "FPM03" :
                                              favorPayMeanCd = "kakaopay";
                                              break;
                                          case "FPM04" :
                                              favorPayMeanCd = "payco";
                                              break;
                                          case "FPM01" :
                                              favorPayMeanCd = "credit";
                                              break;
                                          default :
                                              favorPayMeanCd = "";
                                        }
        
                                        favorCardcmCd  = favorMap.favorCardcmCd;
                                        favorCardDiv   = favorMap.favorCardDiv;
                                    }
        
                                    //다음에도 이결제 수단 사용 자동 체크
                                    if (favorPayMeanCd == null || favorPayMeanCd == '') {
                                        //기본 신용카드
                                        $(':radio[name="radio_payment"][value="credit"]').prop('checked', true);
                                        $('#lastPayMethod').val('credit');
        
                                        $('#app_card').hide();
                                        $('#lab_app_card').hide();
                                        $('#general_card').hide();
                                        $('#lab_general_card').hide();
                                    } else {
                                        var use_payment = favorPayMeanCd;
        
                                        $(':radio[name="radio_payment"][value="'+use_payment+'"]').prop('checked', true);
                                        $('#lastPayMethod').val(use_payment);
        
                                        if (use_payment == 'credit') {
                                            var selectCard = favorCardcmCd;
                                            var selSpCard  = favorCardDiv;
        
                                            $("#card_select").val(selectCard);
                                            $('.selectpicker').selectpicker('refresh');
        
                                            // 변경전 초기화 되었다는 것을 알려준다
                                            $('#card_select').data('init', selSpCard);
                                            $('#card_select').trigger('change');
        
                                            // 전체카드인경우 라디오버튼 비노출
                                            if(selectCard == '00'){
                                                $('#app_card').hide();
                                                $('#lab_app_card').hide();
                                                $('#general_card').hide();
                                                $('#lab_general_card').hide();
                                            } else {
                                                $('#app_card').show();
                                                $('#lab_app_card').show();
                                                $('#general_card').show();
                                                $('#lab_general_card').show();
                                            }
        
                                        }
        
                                        // 구인증 결제 팝업 기능
                                        if ( $(':radio[name="radio_payment"]:checked').val() == 'credit' && $(':radio[name="rdo_card_select"]:checked').val() == '00' ){
                                            $('#btn_booking_pay').attr('href', '#layer_favor_credit').attr('w-data', '600').attr('h-data', '500');
                                        } else {
                                            $('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
                                        }
        
                                        $(":checkbox[id='same_use_payment']").prop('checked', true);
                                    }
                                } else {
                                    $('#same_use_payment').hide();
                                    $('#label_use_payment').hide();
                                    $(':radio[name="radio_payment"][value="credit"]').prop('checked', true);
                                    $('#lastPayMethod').val('credit');
                                }
                            
                            
                        
        
                        $("#prepareFavorYn").val("Y");  //결제 준비여부세팅
        
                        //영화정보 세팅
                        setMoiveInfo(data.movieMap);
        
                        //좌석정보 세팅
                        setTicketInfo(data.ticketList);
        
                        //버튼별 정책그룹(할인수단) 사용가능여부 세팅
                        setButtonPolicyInfo(data.policyList);
        
                        //최종 결제 금액 적용
                        setLastPayAmt(data.policyList);
        
                        //수단별 알림 문구 노출
                        fn_dispPayAlertMsg();
        
                        //타이머 시작
                        Timers.call(19,"m",function(param){},function(param){$modal('layer_time_delay');});
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        errBookingChk(err.msg);
                    }
                });
            }
        
        
            //영화정보 세팅
            function setMoiveInfo(movieInfo) {
                //영화명
                $('#movieNm').html(movieInfo.movieNm);
        
                //관람등급 아이콘
                var admisClassCd = '';
                if (movieInfo.admisClassCd == 'AD01') {
                    admisClassCd = 'age-all';
                } else if (movieInfo.admisClassCd == 'AD02') {
                    admisClassCd = 'age-12';
                } else if (movieInfo.admisClassCd == 'AD03') {
                    admisClassCd = 'age-15';
                } else if (movieInfo.admisClassCd == 'AD04') {
                    admisClassCd = 'age-19';
                } else if (movieInfo.admisClassCd == 'AD05') {
                    admisClassCd = 'age-19';
                } else  {
                    admisClassCd = 'age-no';
                }
        
                $('#admisClassNm').addClass(admisClassCd);
                //관람등급
                $('#admisClassNm').text(movieInfo.admisClassNm);
        
                //상영종류
                if (movieInfo.movieEventTyNm != undefined && movieInfo.movieEventTyNm != '') {
                    $('#playKindNm').html(movieInfo.playKindNm + '/' + movieInfo.movieEventTyNm);
                } else {
                    $('#playKindNm').html(movieInfo.playKindNm);
                }
                //지점명
                $('#brchNm').text(gfn_charToHtml(movieInfo.brchNm) + '/' + gfn_charToHtml(movieInfo.theabExpoNm));
        
                // 지점코드 임시 저장
                $('#brchNo').val(movieInfo.brchNo);
        
                //상영일자
                $('#playDe').text(movieInfo.playDe.maskDate());
                //상영요일
                $('#dowNm').text('('+movieInfo.dowNm+')');
                //상영요일_CD
                $('#dowCd').text(movieInfo.dowCd);
                //상영시간
                $('#playTime').html('<i class="iconset ico-clock-white"></i>' + movieInfo.playStartTime.maskTime() + '~' + movieInfo.playEndTime.maskTime());
            }
        
        
            //티켓정보 세팅
            function setTicketInfo(ticketInfo) {
                var sumPlayAmt = 0;	//전체금액
                var dispTicketList = new Array();
                var totalAmt = $("#totalAmt").val();
        
                for(var i=0;i<ticketInfo.length;i++) {
                    //console.log("ticket : " + ticketInfo[i]);
                    var exist = false;  //기존재여부
                    var idx   = 0; 		//기존재순번
                    var tempTicketMap;  //티켓정보
                    for(var j=0;j<dispTicketList.length;j++) {
                        if (dispTicketList[j].ticketKindCd == ticketInfo[i].ticketKindCd) {
                            tempTicketMap = dispTicketList[j];
                            exist = true;
                            idx = j;
                            break;
                        }
                    }
        
                    if (exist) {
                        tempTicketMap.playAmt = tempTicketMap.playAmt +  ticketInfo[i].playAmt;
                        tempTicketMap.count = tempTicketMap.count +  Number(ticketInfo[i].paySeatToCnt);
                        dispTicketList[idx] = tempTicketMap;
                    } else {
                        var order = 9;
                        switch(ticketInfo[i].ticketKindCd) {
                            case 'TKA' : order = 1;
                            break;
                            case 'TKY' : order = 2;
                            break;
                            case 'TKC' : order = 3;
                            break;
                            case 'TKS' : order = 4;
                            break;
                        }
        
                        tempTicketMap = new Object();
                        tempTicketMap.playAmt = ticketInfo[i].playAmt;
                        tempTicketMap.ticketKindCd = ticketInfo[i].ticketKindCd;
                        tempTicketMap.ticketKindNm = ticketInfo[i].ticketKindNm;
                        tempTicketMap.count = Number(ticketInfo[i].paySeatToCnt);
                        tempTicketMap.order = order;
                        dispTicketList.push(tempTicketMap);
                    }
        
                    sumPlayAmt += ticketInfo[i].playAmt;
                }	//end of for
        
                if (totalAmt != sumPlayAmt) {
                    gfn_alertMsgBox('999:티켓금액이 일치하지 않습니다.'); //티켓금액이 일치하지 않습니다.
                    parent.fn_goPrePagePayBooking();  //좌석도로 이동
                }
        
                //권종별 sort
                dispTicketList.sort(function(a, b) {
                    return b.order - a.order;
                });
        
                //티켓 권종 영역 삭제
                $('.price-process > .box').eq(0).find('.data').remove();
        
                //티켓 권종 영역 추가
                var prependText = "";
                for(var i=0;i<dispTicketList.length;i++) {
                    var tickAmt = dispTicketList[i].playAmt;
                    prependText = '<div class="data"><span class="tit">' + dispTicketList[i].ticketKindNm;
                    prependText += ' <em>' + dispTicketList[i].count + '</em></span>';
                    prependText += '<span class="price">' + String(dispTicketList[i].playAmt).maskNumber() + '</span></div>';
                    $('.price-process > .box').eq(0).prepend(prependText);
                }
        
                //전체 금액 추가
                $('.price-process > .box').eq(0).find('.all').find('em').text(String(totalAmt).maskNumber());
        
                //할인금액 영역 삭제
                $('.price-process > .box').eq(1).find('.data').remove();
                $('.price-process > .box').eq(1).find('.all').find('em').text(0);
        
                $('.pay-area > .pay').eq(0).find('.money').find('em').text(0);
                $('.pay-area > .add-thing').eq(0).find('.money').text(0);
        
            }
        
        
            //정책에 따른 버튼별 en/disabled 설정
            function setButtonPolicyInfo(policyList) {
                var btnList = $('a[name*="btn_pay"]');
                for(var i=0;i<policyList.length;i++) {
                    for(var j=0;j<btnList.length;j++) {
                        var policyName = btnList[j].name.replace('btn_pay_', '');
                        if (policyName == policyList[i].methodName) {
                            if (policyList[i].useAbleAt == 'N') {	//해당 정책 사용 가능시
                                $(btnList).eq(j).addClass("disabled");
                            }
                        }
                    }
                }
                if($('#brchNo').val() == '1562'){
                    $('#btn_pay_annus').addClass('disabled');
                }
            }
        
        
            //전체 버튼 en/disabled 설정
            function setAllButtonDispInfo(policyList, gubun) {
                if (gubun == 'enable') {
                    //할인수단 버튼 disabled
                    var btnList = $('a[name*="btn_pay"]');
                    for(var i=0;i<policyList.length;i++) {
                        for(var j=0;j<btnList.length;j++) {
                            var policyName = btnList[j].name.replace('btn_pay_', '');
                            if (policyName == policyList[i].methodName) {
                                //console.log(policyName + " : " + policyList[i].methodName);
                                $(btnList).eq(j).removeClass("disabled");
                            }
                        }
                    }
        
                    //결제버튼 disabled
                    btnList = $('button[name*="btn_pay"]');
                    for(var j=0;j<btnList.length;j++) {
                        $(btnList).eq(j).attr("disabled", false);
                    }
                } else if (gubun == 'disable') {
                    //할인수단 버튼 disabled
                    var btnList = $('a[name*="btn_pay"]');
                    for(var i=0;i<policyList.length;i++) {
                        for(var j=0;j<btnList.length;j++) {
                            var policyName = btnList[j].name.replace('btn_pay_', '');
                            if (policyName == policyList[i].methodName) {
                                //console.log(policyName + " : " + policyList[i].methodName);
                                $(btnList).eq(j).addClass("disabled");
                            }
                        }
                    }
        
                    //결제버튼 disabled
                    btnList = $('button[name*="btn_pay"]');
                    for(var j=0;j<btnList.length;j++) {
                        $(btnList).eq(j).attr("disabled", true);
                    }
                }
            }
        
        
            //최종 결제 금액 적용
            function setLastPayAmt(policyList) {
                //전체금액
                var allSumAmt = parseInt($('.price-process > .box').eq(0).find('.all').find('em').text().replaceAll(',', '').nvlNum(0));
        
                //할인금액
                var allDiscAmt = parseInt($('.price-process > .box').eq(1).find('.all').find('em').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0));
        
                //추가금액
                var allAddAmt = parseInt($('.pay-area > .add-thing').eq(0).find('.money').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0).replaceAll('+', '').nvlNum(0));
        
                //최종결제금액
                var remainAmt = allSumAmt + allAddAmt - allDiscAmt;
                $('.pay-area > .pay').eq(0).find('.money').find('em').text( String(remainAmt).maskNumber() );
        
                //최종 결제 금액 0인경우 disabled 처리
                if (allSumAmt + allAddAmt - allDiscAmt == 0) {
                    setAllButtonDispInfo(policyList, 'disable');
        
                    //결제수단 disabled
                    $('#lastPayMethod').val('');
                    $(':radio[name="radio_payment"]').prop('checked', false);
                    $(':radio[name="radio_payment"]').attr('disabled', true);
        
                    $('.select-payment-card').hide();
        
        // 			$('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
                } else {
                    setAllButtonDispInfo(policyList, 'enable');
        
                    //결제수단 enabled
                    $(':radio[name="radio_payment"]').attr('disabled', false);
        
                    // pg결제 처리 되도록 수정
        // 			$('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
        
                    if ($('#lastPayMethod').val() == 'credit') {
                        $('.select-payment-card').show();
                    } else {
                        $('.select-payment-card').hide();
                    }
                }
        
                // 구인증 결제 팝업 기능
                if ( $(':radio[name="radio_payment"]:checked').val() == 'credit' && $(':radio[name="rdo_card_select"]:checked').val() == '00' ){
                    $('#btn_booking_pay').attr('href', '#layer_favor_credit').attr('w-data', '600').attr('h-data', '500');
                } else {
                    $('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
                }
        
                //실시간 변경
                setButtonPolicyInfo(policyList);
        
                //현대 M 포인트, 문화누리 사용시 결제수단 disabled
                var hyCultApply = '';
                for(var i=0;i<policyList.length;i++) {
                    if (('hydm' == policyList[i].methodName || 'culturenuri' == policyList[i].methodName) && policyList[i].applyAmt > 0) {
                        hyCultApply = policyList[i].methodName;
                        break;
                    }
                }
        
                if (hyCultApply != '') {
                    //$('.select-payment > button').attr('disabled', true);
                    $(':radio[name="radio_payment"]').attr('disabled', true);
        
                    $('.select-payment-card').hide();
        
                    if ('hydm' == hyCultApply) {
                        $('#btn_pay_culturenuri').addClass('disabled');
                        $('#btn_pay_hydm').removeClass('disabled');
                    } else {
                        $('#btn_pay_hydm').addClass('disabled');
                        $('#btn_pay_culturenuri').removeClass('disabled');
                    }
        
                    $('#lastPayMethod').val('credit');
                }
        
                //최종 결제수단 명칭 세팅
                changePaymentName(policyList);
        
            }
        
        
            //할인내역 적용
            function setMovieDcInfo(policyList) {
        
                $('.price-process > .box').eq(1).find('.data').remove();
                var prependText = '';
                var sumApplyAmt = 0;
                var sumAddAmt   = 0;
        
                for(var i=0;i<policyList.length;i++) {
                    var applyAmt = policyList[i].applyAmt;
                    var applyCnt = policyList[i].applyCnt;
                    if (applyAmt > 0 || applyCnt > 0) {
                        prependText = '<div class="data"><span class="tit">' + policyList[i].meanPrnNm;
                        if (policyList[i].cponType == 'CMBND' || policyList[i].cponType == 'CPON') {
                            prependText += ' <em>' + policyList[i].applyCponCnt + '</em> 매</span>';
                        } else {
                            prependText += ' <em>' + policyList[i].applyCnt + '</em> 매</span>';
                        }
        
                        prependText += '<span class="price">' + String(policyList[i].applyAmt).maskNumber() + '</span>';
                        if (policyList[i].methodName == 'skt-normal') {
                            prependText += '<button type="button" class="btn-delete" method="skt">삭제</button></div>';
                        } else {
                            prependText += '<button type="button" class="btn-delete" method="' + policyList[i].methodName + '">삭제</button></div>';
                        }
        
                        sumApplyAmt += applyAmt;
        
                        if (policyList[i].applyAddAmt != null && policyList[i].applyAddAmt != undefined) {
                            sumAddAmt   += policyList[i].applyAddAmt;
                        }
        
                        $('.price-process > .box').eq(1).prepend(prependText);
        
                        if (policyList[i].methodName == 'skt-normal') {
                            $('#btn_pay_skt').closest('div').addClass('on')
                        } else {
                            $('#btn_pay_' + policyList[i].methodName).closest('div').addClass('on')
                        }
        
                    } else {
        
                        if (policyList[i].methodName == 'skt-normal') {
                            $('#btn_pay_skt').closest('div').removeClass('on')
                        } else {
                            $('#btn_pay_' + policyList[i].methodName).closest('div').removeClass('on');
                            if ( $(':radio[name="radio_payment"]:checked').val() == 'credit' && $(':radio[name="rdo_card_select"]:checked').val() == '00'){
                                $('#btn_booking_pay').attr('href', '#layer_favor_credit').attr('w-data', '600').attr('h-data', '500');
                            } else {
                                $('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
                            }
                        }
                    }
        // 			// 문화누리, 현대M포인트는 바로 결제 되도록
        // 			if( policyList[i].methodName == 'hydm' || policyList[i].methodName == 'culturenuri'){
        // 				$('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
        // 			}
                }
        
        
                $('.price-process > .box').eq(1).find('.all').find('em').text(sumApplyAmt==0?'0':'-'+String(sumApplyAmt).maskNumber());
        
                //추가결제금액
                if (sumAddAmt > 0) {
                    $('.pay-area > .add-thing').eq(0).find('.money').text( '+' + String(sumAddAmt).maskNumber() );
                } else {
                    $('.pay-area > .add-thing').eq(0).find('.money').text( '0' );
                }
        
                //최종 결제 금액 적용
                setLastPayAmt(policyList);
        
                //삭제 이벤트 적용
                setCancelEvent();
        
                if ($('#pre_disc_all_text').text() != '') {  //bc 선할인 초기화
                    pre_disc_init();
                }
            }
        
        
            //적용 수단 삭제 callback함수
            function delApplyMethod(sMethodName) {
                if (sMethodName != undefined && sMethodName != ''){
                    cancelMbxSellCpInfo(sMethodName);
                }
            }
        
        
            //삭제 적용 (공통)
            function cancelMbxSellCpInfo(sMethodName) {
                var transNo       = $("#transNo").val();
                var paramData     = {transNo:transNo, methodName:sMethodName};
        
                if (sMethodName == "") {
                    return;
                }
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/cancelMbxSellCpInfo.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
        
                        //할인내역 갱신
                        setMovieDcInfo(data.policyList);
        
                        //각 수단별 팝업 초기화(모든 팝업 공통)
                        try {
                            eval(sMethodName+'_init()');
                            //삭제버튼 숨김
                            $('#btn_cancel_'+sMethodName).hide();
                            //레이어내 적용취소버튼 숨김
                            if ($('#btn_cancel_apply_'+sMethodName).length > 0) {
                                $('#btn_cancel_apply_'+sMethodName).hide();
                            }
        
                            if( !$('#rdo_pay_credit').is(":disabled") && $(':radio[name="radio_payment"]:checked').val() == 'credit'
                                    && $(':radio[name="rdo_card_select"]:checked').val() == '00'){
                                $('#btn_booking_pay').attr('href', '#layer_favor_credit').attr('w-data', '600').attr('h-data', '500');
                            } else {
                                $('#btn_booking_pay').attr('href', '#').attr('w-data', '600').attr('h-data', '400');
                            }
        
                        } catch(e){
                            //console.log("초기화 대상 없음.....");
                        }
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
                    }
                });
            }
        
        
            //삭제버튼 이벤트 적용 (공통)
            function setCancelEvent() {
                //삭제 버튼 이벤트 적용
                $('.btn-delete').off('click');
        
                //삭제 버튼 이벤트 적용
                $('.btn-delete').on('click', function() {
                    var sMethodName   = $(this).attr('method');
                    var options       = {};
                    options.msg       = '적용 내역을 취소하시겠습니까?';
                    options.confirmFn = delApplyMethod;
                    options.param     = {confirm:sMethodName} ;
                    options.minWidth  = 400;
                    options.minHeight = 300;
                    gfn_confirmMsgBox(options);
                });
            }
        
            function chkPrePayAmt(){
                var transNo       = $("#transNo").val();
                var paramData     = {transNo:transNo};
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/chkPrePayAmt.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
        
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
        
                        $('#pre_disc_pop').click();
        
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
                    }
                });
            }
        
            //최종결제 금액 유효성 검사
            function chkLastPayAmt(option) {
                var transNo       = $("#transNo").val();
                var lastPayMethod = $('#lastPayMethod').val();
                var paramData     = {transNo:transNo};
                var discType      = $('#discType').val();
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/chkLastPayAmt.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
        
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
        
                        $('#btn_booking_ria_pay').removeClass('disabled');  //리아결제 팝업 오픈 해제
        
                        var lastPayInfo = data.lastPayInfo;
                        if (lastPayInfo != null && lastPayInfo != undefined) {
                            var remainAmt    = lastPayInfo.remainAmt;
                            var chkRemainAmt = $('.pay-area > .pay').eq(0).find('.money').find('em').text().replaceAll(',', '');
        
                            if (String(chkRemainAmt) != String(remainAmt)) {
                                //결제금액이 일치하지 않습니다.
                                gfn_alertMsgBox('결제금액이 일치하지 않습니다.');
                                return;
                            }
        
                            if (lastPayMethod == 'credit' || lastPayMethod == 'mobile' || lastPayMethod == 'kakaopay' || lastPayMethod == 'payco')  {
                                //결제 금액이 0 이상인 경우
                                if (discType != 'HYUNM' && discType != 'CULTURE' && discType != 'TELLER') {	//현대M포인트, 문화누리 사용시 금액이 0일 수 있음
                                    if (remainAmt == 0) {
                                        //결제버튼을 선택하세요
                                        gfn_alertMsgBox('결제 버튼을 클릭 하세요.');
                                        return;
                                    }
        
                                    //카드사 선택 필수
                                    if (lastPayMethod == 'credit' && $("#card_select option:selected").val() == "00" && remainAmt > 0) {
                                        //결제하실 카드를 선택하세요
                                        gfn_alertMsgBox('결제하실 카드를 선택하세요.');
                                        $("#card_select").focus();
                                        return;
                                    }
                                }
        
                            } else {
                                //결제 금액이 0 이상인 경우
                                if (remainAmt > 0) {
                                    //결제 하지 않은 금액이 있습니다. \\n결제 수단을 선택해주세요.
                                    gfn_alertMsgBox('결제 하지 않은 금액이 있습니다. \n결제 수단을 선택해주세요.');
                                    return;
                                }
                            }
        
                            NetfunnelChk.script('BOOK_PAY', function(){
                                //현금영수증 팝업
                                chkCshRec(option);
                            });
                        }
        
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
                    }
                });
            }
        
        
            //현금 영수증 팝업 여부 체크
            function chkCshRec(option) {
                var transNo       = $("#transNo").val();
                var paramData     = {transNo:transNo};
                var lastPayMethod = $('#lastPayMethod').val();
                var preDisc       = $('#preDisc').val();
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/chkCshRecAt.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
        
                        $('#cashBillYn').val('N');
                        $('#cashrecIssueCd').val('');
                        var cshRecInfo = data.cshRecInfo;
        
                        if (cshRecInfo != null && cshRecInfo != undefined) {
                            var tktCashrecAmt = cshRecInfo.tktCashrecAmt;
        
                            //현금 영수증 금액이 0 이상인 경우
                            if (tktCashrecAmt > 0) {
                                precash_option = option;  //현금 영수증에 option 정보를 넘긴다.
                                $('#cashBillAmt').text(String(tktCashrecAmt).maskNumber());
                                $('#cash_pop').click();
                            } else {
                                //예매번호 생성
                                payBokdNoProc(option);
                            }
                        }
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        $('#cashBillYn').val('N');
                        $('#cashrecIssueCd').val('');
                        errBookingChk(err.msg);
                    }
                });
            }
        
        
            //예매번호 생성
            function payBokdNoProc(option) {
                var transNo       = $("#transNo").val();
                var lastPayMethod = $('#lastPayMethod').val();
                var preDisc       = $('#preDisc').val();
                var discType      = $('#discType').val();
                var tellerFee     = $('#tellerFee').val();
                var chkRemainAmt = $('.pay-area > .pay').eq(0).find('.money').find('em').text().replaceAll(',', '');
        
                var paramData = { transNo:transNo, lastPayMethod:lastPayMethod, preDisc:preDisc, discType:discType, tellerFee:tellerFee };
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/selectBokdNo.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
        
                        if (data.statCd != "0") {
                            gfn_alertMsgBox(data.msg);
                        } else {
                            //결제 실행
                            if ((lastPayMethod == "credit" || lastPayMethod == "mobile" || lastPayMethod == 'kakaopay' || lastPayMethod == 'payco') && preDisc != "Y") {
                                fdkPayProc();
                            } else {
                                //로딩 생성
                                gfn_logdingModal();
        
                                if (preDisc == "Y" && parseInt(chkRemainAmt) > 0) {	//bc는 무조건 0이상(선할인은 결제 금액에 포함)
                                    applyPreCreditCard(option);
                                } else {
                                    execBookingPayment();
                                }
                            }
                        }
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
                        cancelMbxSellCpInfo($('#lastPayMethod').val());
                    }
                });
            }
        
        
            //선할인 카드 적용
            function applyPreCreditCard(option) {
                var transNo    = $("#transNo").val();
                var useAmt     = $('.pay-area > .pay').eq(0).find('.money').find('em').text().replaceAll(',', '');
                var preDisc    = $('#preDisc').val();
                var discType   = $('#discType').val();
        
                /*
                카드번호 등 세팅필요
                */
                var paramData  = { transNo:transNo, useAmt:useAmt, preDisc:preDisc, discType:discType };
                $.extend(paramData, option);
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/applyPreCreditCard.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
        
                        execBookingPayment();
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        //로딩 삭제
                        gfn_logdingModal();
        
                        errBookingChk(err.msg);
                        cancelMbxSellCpInfo($('#lastPayMethod').val());
                    }
                });
            }
        
        
            //최종 결제 실행
            function execBookingPayment() {
                var transNo         = $("#transNo").val();
                var cashBillYn      = $('#cashBillYn').val();
                var cashrecIssueCd  = $('#cashrecIssueCd').val();
                var bizmDivCd       = $(':radio[name="bizmDivCd"]:checked').val();
                var cashBillPhoneNo = $('#cashBillPhoneNo').val();
                var cashrecPubAmt   = $('#cashBillAmt').text().replaceAll(',', '');
                var preDisc         = $('#preDisc').val();
        
                var paramData = { transNo:transNo, cashBillYn:cashBillYn,
                                  cashrecIssueCd:cashrecIssueCd, bizmDivCd:bizmDivCd, cashBillPhoneNo:cashBillPhoneNo, cashrecPubAmt:cashrecPubAmt , preDisc:preDisc };
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/execBookingPayment.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
        
                        remainAmt = data.returnMap.remainAmt;
                        if (data.statCd != "0") {
                            //로딩 삭제
                            gfn_logdingModal();
        
                            
                            data.msg = data.msg || '';
                            var prefix = data.msg.split(':');
                            if(data.msg.indexOf('결제키 기간경과')>=0){
                                gfn_alertMsgBox(prefix[0] + ' : 잔액 재조회 후 이용 바랍니다.(결제키 기간경과)');
                            }else if(data.msg.indexOf('결제불가 상품권 존재')>=0){
                                gfn_alertMsgBox(prefix[0] + ' : 상품권 정보를 재확인 바랍니다.(결제불가 상품권 존재)');
                            }else if(data.msg.indexOf('상품권잔액부족')>=0){
                                gfn_alertMsgBox(prefix[0] + ' : 상품권 정보를 재확인 바랍니다.(상품권 잔액부족)');
                            }else{
                                gfn_alertMsgBox(data.msg);
                            }
        
                            cancelMbxSellCpInfo($('#lastPayMethod').val());
                            //경우에 따라서 back 등 결정 필요
                            return;
                        }
        
                        //예매 완료 페이지 이동
                        goCompleteBooking();
        
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        //로딩 삭제
                        gfn_logdingModal();
        
                        errBookingChk(err.msg);
                        cancelMbxSellCpInfo($('#lastPayMethod').val());
                    }
                });
            }
        
        
            //초기화, 이전화면 이동(좌석 선점 취소는 beforeunload 로 이동)
            function initOccupSeat(gubun) {
                if (gubun == 'refresh') {
                    payRefresh();
                } else {
                    goPrePageInitSeat();
                }
            }
        
        
            //메시지 체크
            function msgBookingLoginChk(data) {
                //알림메시지 노출
                if (data.statCd == "-777") {  //비로그인
                    //메가박스는 예매 또는 상영스케쥴로 이동
                    
                        gfn_alertMsgBox({ msg: data.msg, callback:goBookingFrist });
                    
                    //리아는 예매창 닫고 다시 진행 alert
                    
        
                    return false;
                } else if (data.statCd == "0") {
                    try {
                        var chkAddAmt = data.returnMap.chkAddAmt;
                        if (chkAddAmt > 0) {
                            gfn_alertMsgBox('해당 관람권은 '+String(chkAddAmt).maskNumber()+'원 추가금액 지불시\n관람이 가능합니다.')
        
                        }
                    } catch(e) {
                        //console.log("추가금액 누락.....");
                    }
                }
        
                return true;
            }
        
        
            //오류메시지 체크 : 999 로 시작되는 오류 메시지 처음페이지로 리턴
            function errBookingChk(msg) {
                //알림메시지 노출
                if (msg != null && msg != "") {
                    if (msg.indexOf("999:") == 0) {  //온라인 999 좌석도로
                        var almsg = msg.substring(4, msg.length).replaceAll('9999:', '');
                        if (almsg == "msg.pay.overPayTime") {  //결제가능 시간이 초과되어 좌석선택부터 다시 진행바랍니다. 메시지는 예매화면에서 팝업한다.(ria 체크 필요)
                            goPrePageInitSeat('BookingPay_msg94');
                        } else if (almsg == "msg.pay.over.session") {  //결제가능 시간이 초과되어 좌석선택부터 다시 진행바랍니다. 메시지는 예매화면에서 팝업한다.(ria 체크 필요)
                            
                                var sessMsg = "로그인 가능시간이 초과되었습니다.<br/> 재 로그인 후 이용 바랍니다.";
                                gfn_alertMsgBox({ msg: sessMsg, callback:goBookingFrist });
                            
                            
                        } else {
                            gfn_alertMsgBox({ msg: almsg, callback:goPrePageInitSeat });
                        }
                    } else if (msg.indexOf("888:") == 0) {  //온라인 888 예매 처음으로
                        var almsg = msg.substring(4, msg.length).replaceAll('9999:', '');
                        gfn_alertMsgBox({ msg: almsg, callback:goBookingFrist });
                    } else {
                        if (msg.indexOf("9999:") == 0) {  //현장용. 9999 제외 메시지 노출
                            var almsg = msg.substring(5, msg.length);
                            gfn_alertMsgBox({ msg: almsg });
                        } else {
                            gfn_alertMsgBox({ msg: msg });
                        }
                    }
                }
            }
        
        
            //예매 페이지 이동
            function goBookingFrist(msg) {
                
        
                //parent.fn_goPrePagePcntSeatChoi(msg); //예매 페이지로 이동
                //예매 페이지 또는 상영스케쥴로 이동
                parent.fn_bokdReload('/booking');
        
            }
        
        
            //좌석도 페이지 이동
            function goPrePageInitSeat(msg) {
                $("#goBackYn").val("Y");
                var transNo = $("#transNo").val();
                var paramData = { transNo:transNo };
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/initOccupSeat.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        parent.fn_goPrePageInitSeat(msg);  //좌석도 페이지로 이동(초기화)
                    },
                    error: function(xhr,status,error){
                        //오류 발생시도 이전으로 이동
                        parent.fn_goPrePageInitSeat(msg);  //좌석도 페이지로 이동(초기화)
                    }
                });
            }
        
        
            //쿠키설정
            function fn_setCookie(cname, cvalue, exdays) {
                var d = new Date();
                d.setTime(d.getTime() + (exdays*24*60*60*1000));
                var expires = "expires="+d.toUTCString();
                document.cookie = cname + "=" + cvalue + "; " + expires + ";path=/";
            }
        
        
            //쿠키조회
            function fn_getCookie(name) {
                var value = document.cookie.match('(^|;) ?' + name + '=([^;]*)(;|$)');
                return value? value[2] : null;
            }
        
        
            //결제 수단별 알림 메시지 노출
            function fn_dispPayAlertMsg() {
                var selPayment = $(':radio[name="radio_payment"]:checked').val();
        
                switch (selPayment){
                  case "mobile" :
                      $(".select-mobile-info").show();
                      $(".select-kakao-info").hide();
                      $(".select-payco-info").hide();
                      break;
                  case "kakaopay" :
                      $(".select-mobile-info").hide();
                      $(".select-kakao-info").show();
                      $(".select-payco-info").hide();
                      break;
                  case "payco" :
                      $(".select-mobile-info").hide();
                      $(".select-kakao-info").hide();
                      $(".select-payco-info").show();
                      break;
                  case "credit" :
                      $(".select-mobile-info").hide();
                      $(".select-kakao-info").hide();
                      $(".select-payco-info").hide();
                      break;
                  default :
                      $(".select-mobile-info").hide();
                        $(".select-kakao-info").hide();
                      $(".select-payco-info").hide();
                }
            }
        
        
        
            //========================================================================================
            //fdk 결제 영역
            //========================================================================================
            function fdkPayProc() {
                var transNo     = $("#transNo").val();
                var useAmt      = $('.pay-area > .pay').eq(0).find('.money').find('em').text().replaceAll(',', '');
                var sMethodName = $('#lastPayMethod').val();
                var selectCard  = $("#card_select option:selected").val();
                var selSpCard   = $(':radio[name="rdo_card_select"]:checked').val();
                var pointDmode  = "";
        
                if (sMethodName == 'credit') {  //신용카드
                    if (selectCard == '03' && selSpCard == '02') {	//삼성카드 포인트
                        pointDmode = 'S004';
                    } else if (selectCard == '27' && selSpCard == '02') {	//하나머니
                        pointDmode = 'H004';
                    }
                } else if (sMethodName == 'kakaopay') {  //카카오페이
                    selectCard = 'X4';
                } else if (sMethodName == 'payco') {  //카카오페이
                    selectCard = 'W2';
                } else {
                    selectCard = '';
                    pointDmode = '';
                }
        
                //console.log("/on/oh/ohz/PayBooking/applyCreditCard.do?transNo="+transNo+"&useAmt="+useAmt+"&methodName="+sMethodName+"&selectCard="+selectCard+'&pointDmode='+pointDmode);
                //form 방식으로 변경
                $("#ifrm_transNo").val(transNo);
                $("#ifrm_useAmt").val(useAmt);
                $("#ifrm_methodName").val(sMethodName);
                $("#ifrm_selectCard").val(selectCard);
                $("#ifrm_pointDmode").val(pointDmode);
        
                document.ifrm.submit();
        
                layer_open('fdpayWin');	//"FD_PAY_FRAME" 프레임을 가지고 있는 DIV 영역의 ID를 입력(sample 이용 시 : id="fdpayWin")
            }
        
        
            //레이어 팝업 호출 시 처리
            function layer_open(el){
                wrapWindowByMask();			//레이어 팝업 활성화 시 하단 MASKING 처리를 위한 함수
        
                var fdlayer = $('#' + el);	//레이어의 id를 fdlayer변수에 저장
                fdlayer.fadeIn();			//레이어 실행
        
                // 화면의 중앙에 레이어를 띄운다.
                fdlayer.css('margin-top' , '-'+fdlayer.outerHeight()/2+'px');
                fdlayer.css('margin-left', '-'+fdlayer.outerWidth()/2+'px');
                fdlayer.center();
        
                var lastPayMethod = $('#lastPayMethod').val();
        
                if (lastPayMethod == 'payco') {  //페이코의 경우 팝업 사이즈 변경
                    fdlayer.css('width'  , '750px');
                    fdlayer.css('height' , '700px');
                    fdlayer.css('left'   , '45%');
                    $('#FD_PAY_FRAME').width('728px');
                    $('#FD_PAY_FRAME').height('630px');
                } else {
                    fdlayer.css('width'  , '');
                    fdlayer.css('height' , '');
                    fdlayer.css('left'   , '50%');
                    $('#FD_PAY_FRAME').width('560px');
                    $('#FD_PAY_FRAME').height('600px');
                }
        
                fdlayer.find('a.closeBtn').off().on('click', function(e){
                    fdlayer.fadeOut();			//'Close'버튼을 클릭하면 레이어가 사라진다.
                    e.preventDefault();
                    document.getElementById("mask").style.display = "none";	//레이어 팝업 비활성화 시 하단 MASKING 표시 해제
                    FD_PAY_FRAME.location.href = "/on/oh/ohz/PayBooking/blank.do";	//빈 페이지로 프레임 영역 변경
        
                    var lastPayMethod = $('#lastPayMethod').val();
                    cancelMbxSellCpInfo(lastPayMethod);
                });
            }
        
        
            //레이어 팝업 하단 영역 마스킹 처리(레이어 팝업 호출 시 사용)
            function wrapWindowByMask(){
                //화면의 높이와 너비를 구한다.
                var maskHeight = $(document).height();
                var maskWidth  = $(window).width();
        
                //마스크의 높이와 너비를 화면 것으로 만들어 전체 화면을 채운다.
                $('#mask').css({'width':maskWidth,'height':maskHeight});
        
                //애니메이션 효과
                $('#mask').fadeIn(1000);
                $('#mask').fadeTo("slow",0.6);
            }
        
        
            //최종결제
            function fdkAuthResult(rtncode, rtnmsg, fdtid) {
                if (rtncode != '0000') {	//오류시 alert 메시지 팝업 후 레이어 닫기
                    gfn_alertMsgBox(rtnmsg);
                    $('#fdpayWin').find('a.closeBtn').click();
                    return false;
                }
                var transNo         = $("#transNo").val();
                var cashBillYn      = $('#cashBillYn').val();
                var cashrecIssueCd  = $('#cashrecIssueCd').val();
                var bizmDivCd       = $('input[name="bizmDivCd"]').val();
                var cashBillPhoneNo = $('#cashBillPhoneNo').val();
                var cashrecPubAmt   = $('#cashBillAmt').text().replaceAll(',', '');
        
                var paramData = {transNo:transNo, Code:rtncode, Msg:rtnmsg , FDTid:fdtid, cashBillYn:cashBillYn,
                                cashrecIssueCd:cashrecIssueCd, bizmDivCd:bizmDivCd, cashBillPhoneNo:cashBillPhoneNo, cashrecPubAmt:cashrecPubAmt };
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/execBookingPayment.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
                        if (data.statCd != "0") {
                            
                            data.msg = data.msg || '';
                            var prefix = data.msg.split(':');
                            if(data.msg.indexOf('결제키 기간경과')>=0){
                                gfn_alertMsgBox(prefix[0] + ' : 잔액 재조회 후 이용 바랍니다.(결제키 기간경과)');
                            }else if(data.msg.indexOf('결제불가 상품권 존재')>=0){
                                gfn_alertMsgBox(prefix[0] + ' : 상품권 정보를 재확인 바랍니다.(결제불가 상품권 존재)');
                            }else if(data.msg.indexOf('상품권잔액부족')>=0){
                                gfn_alertMsgBox(prefix[0] + ' : 상품권 정보를 재확인 바랍니다.(상품권 잔액부족)');
                            }else{
                                gfn_alertMsgBox(data.msg);
                            }
        
                            //경우에 따라서 back 등 결정 필요
                            $('#fdpayWin').find('a.closeBtn').click();
                            return;
                        }
        
                        //예매 완료 페이지 이동
                        goCompleteBooking();
        
                        //alert("결제 완료~~ 페이지 이동~~!!!");
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
                        $('#fdpayWin').find('a.closeBtn').click();
                    }
                });
            }
        
        
            //예매 완료 페이지 이동
            function goCompleteBooking() {
                $("#completeYn").val("Y");
                $("#completeTransNo").val($("#transNo").val());
                $("#completeRiaMemberYn").val(parent.riaMemberYn);
                $("#completeRiaBirthday").val(parent.riaParamBirthday);
                $("#completeForm").attr("action", "/booking/payment-successcomplete");
                $("#completeForm").attr("target", "_parent");
                $("#completeForm").submit();
            }
        
        
            jQuery.fn.center = function () {
                this.css("position","absolute");
                this.css("top", Math.max(0, (($(window).height() - $(this).outerHeight()) / 2) + $(window).scrollTop()) + 330 + "px");
                return this;
            }
        
            //========================================================================================
            //fdk 결제 영역
            //========================================================================================
        </script><script src="https://www.megabox.co.kr/static/pc/js/ui.common.js?v=1596085265163"></script><script src="https://www.megabox.co.kr/static/pc/js/front.js?v=1596085265163"></script></head>
    <body class="body-iframe">
        <form name="payForm" id="payForm" method="post">
            <input type="hidden" name="playSchdlNo" id="playSchdlNo" value="2007301202030">
            <input type="hidden" name="seatOccupText" id="seatOccupText" value="00100801,TKA,7000,MBX,GERN_ZONE,GERN_CLS,1">
            <input type="hidden" name="totalAmt" id="totalAmt" value="7000">
            <input type="hidden" name="transNo" id="transNo" value="12022007300094798715">
            <input type="hidden" name="cashBillYn" id="cashBillYn" value="">
            <input type="hidden" name="cashrecIssueCd" id="cashrecIssueCd" value="">
        
            <input type="hidden" name="lastPayMethod" id="lastPayMethod" value="credit">
            <input type="hidden" name="preDisc" id="preDisc" value="">
            <input type="hidden" name="discType" id="discType" value="">
            <input type="hidden" name="tellerFee" id="tellerFee" value="">
            <input type="hidden" name="completeYn" id="completeYn" value="">
            <input type="hidden" name="prepareYn" id="prepareYn" value="Y">
            <input type="hidden" name="prepareFavorYn" id="prepareFavorYn" value="Y">
            <input type="hidden" name="goBackYn" id="goBackYn" value="">
        </form>
        <form name="completeForm" id="completeForm" method="post">
            <input type="hidden" name="completeTransNo" id="completeTransNo">
            <input type="hidden" name="completeRiaMemberYn" id="completeRiaMemberYn">
            <input type="hidden" name="completeRiaBirthday" id="completeRiaBirthday">
        </form>
        <form name="ifrm" method="POST" target="FD_PAY_FRAME" action="/on/oh/ohz/PayBooking/applyCreditCard.do">
            <input type="hidden" name="transNo" id="ifrm_transNo">
            <input type="hidden" name="useAmt" id="ifrm_useAmt">
            <input type="hidden" name="methodName" id="ifrm_methodName">
            <input type="hidden" name="selectCard" id="ifrm_selectCard">
            <input type="hidden" name="pointDmode" id="ifrm_pointDmode">
        </form>﻿
        
        
        <input type="hidden" name="dowCd" id="dowCd">
        <input type="hidden" name="brchNo" id="brchNo" value="1202">
        <!-- 레이어 팝업 처리 시 화면 영역 시작 -->
        <div id="mask"></div>
        <div id="fdpayWin" class="fdLayer">
            <div class="fdContainer">
                <div class="pop-conts">
                    <iframe id="FD_PAY_FRAME" name="FD_PAY_FRAME" title="결제팝업창" frameborder="1" width="560" height="600" style="background-color:#FFFFFF;overflow: hidden;" scrolling="no"></iframe>
                    <div class="fdBtn">
                        <a href="#" class="closeBtn" title="Close">Close</a>
                    </div>
                </div>
            </div>
        </div>
        <!-- 레이어 팝업 처리 시 화면 영역 끝 -->
        
        
        <div class="inner-wrap" style="padding-top:40px; padding-bottom:100px;">
            <!-- quick-reserve -->
            <div class="quick-reserve">
        
                <h2 class="tit">빠른예매<!-- 빠른예매 --></h2>
        
                
        
        
        
        
        
        
        <script type="text/javascript">
        var requestPayAt = "Y";
        
        $(function(){
            //RIA의 경우
            if(parent.sellChnlCd != ""){
                $('.inner-wrap')
                    .css('padding-bottom','')
                    .css('padding-top','');	//하단 상단 공백 제거
        //         $('#btnLangChg').hide();    //언어전환 버튼숨김
        
                //로그인 되었으면
                if(parent.riaLoginAt == "Y"){
                    $('.cti-area input[name=riaName]').attr('value',parent.riaParamName);	//고객명
                    $('.cti-area input[name=riaMobileNo]').attr('value',parent.riaParamMobileNo);	//고객전화번호
                    $('.cti-area input[name=riaBirthday]').attr('value',parent.riaParamBirthday);	//고객생년월일
                    $('.cti-area input[name=riaMemberYn]').attr('value',parent.riaMemberYn == "Y" ? "회원" : "비회원");	//회원여부
        
                    $('.cti-area input[name=riaName]').attr("readonly",true);		//고객명
                    $('.cti-area input[name=riaMobileNo]').attr("readonly",true);	//고객전화번호
                    $('.cti-area input[name=riaBirthday]').attr("readonly",true);	//고객생년월일
        
                    $('.cti-area input[name=riaMemberYn]').attr("readonly",true);	//회원여부
        
                    $('.cti-area button').attr('login-at',"Y");
        
                    //결제화면이 아니면
                    if("N" == requestPayAt){
                        $('.cti-area button').html('재인증');
                    }
                }
                //로그인 되지 않았으면
                else {
                    $('.cti-area input[name=riaName]').attr('value',parent.riaParamName);	//고객명
                    $('.cti-area input[name=riaMobileNo]').attr('value',parent.riaParamMobileNo);	//고객전화번호
                    $('.cti-area input[name=riaBirthday]').attr('value',parent.riaParamBirthday);	//고객생년월일
                    $('.cti-area input[name=riaMemberYn]').attr('value','');	//회원여부
        
                    $('.cti-area input[name=riaName]').attr("readonly",false);		//고객명
                    $('.cti-area input[name=riaMobileNo]').attr("readonly",false);	//고객전화번호
                    $('.cti-area input[name=riaBirthday]').attr("readonly",false);	//고객생년월일
        
                    $('.cti-area input[name=riaMemberYn]').attr("readonly",true);	//회원여부
        
                    $('.cti-area button').attr('login-at',"N");	//회원여부
                      //결제화면이 아니면
                    if("N" == requestPayAt){
                        $('.cti-area button').html('인증요청');
                    }
                }
        
                //드림센터의 경우
                if(parent.sellChnlCd == "TELLER"){
                    $('.cti-area').show();	//cti 로그인창 표시
                }
                else {
                    $('.cti-area').hide();	//cti 로그인창 표시
                }
        
        
                //회원정보 확인을 위한 초기 파라메타 셋팅
        
                //파라메타 셋팅후
                //회원여부확인				부모창
                //나머지 화면 disable 처리	부모창
        
            }
            else {
                $('.quick-reserve-ad-area').show();	//광고영역 표시
        //         $('#btnLangChg').show();	//언어전환 버튼표시 사용안함 20200106 김민영
            }
        
            /* RIA 재인증 버튼 클릭 */
            $('.cti-area button').on("click", function(){
        
                //입력값 검증
                if($('.cti-area button').attr('login-at') == "N"){
        
        // 			if($(".cti-area input[name=riaName]").val().length == 0){
        // 				gfn_alertMsgBoxSize('이름은  필수 입력 항목 입니다.',400,250);	//{0} 필수 입력 항목 입니다.
        // 				return;
        // 			}
        
                    if(!fn_validateDateYn($(".cti-area input[name=riaBirthday]").val())){
                        gfn_alertMsgBoxSize('생년월일을 정확히 입력해주세요.',400,250);	//생년월일을 정확히 입력해주세요.
                        return;
                    }
        
                    if($(".cti-area input[name=riaMobileNo]").val().length < 10){
                        gfn_alertMsgBoxSize('휴대폰번호를 정확히 입력해주세요.',400,250);	//휴대폰번호를 정확히 입력해주세요.
                        return;
                    }
        
                    if($(".cti-area input[name=riaMobileNo]").val().substr(0,2) != "01"){
                        gfn_alertMsgBoxSize('휴대폰번호를 정확히 입력해주세요.',400,250);	//휴대폰번호를 정확히 입력해주세요.
                        return;
                    }
                }
                parent.fn_setRiaLoginToggle( [$('.cti-area button').attr('login-at')
                                             ,$(".cti-area input[name=riaName]").val()
                                             ,$(".cti-area input[name=riaBirthday]").val()
                                             ,$(".cti-area input[name=riaMobileNo]").val()]
                                            );
            });
        
        
            /* 이름 숫자를 제외한 입력 여부판단 */
            $(".cti-area input[name=riaName]").on("keyup", function(e){
                var partton = /[^ㄱ-힣a-zA-Z]/g;
                if(partton.test($(this).val())) {
                    var value = $(this).val().replace(/[^ㄱ-힣a-zA-Z]/g,"");
                    $(this).val(value);
                }
             });
            $(".cti-area input[name=riaName]").focusout(function(){
                var partton = /[^ㄱ-힣a-zA-Z]/g;
                if(partton.test($(this).val())) {
                    var value = $(this).val().replace(/[^ㄱ-힣a-zA-Z]/g,"");
                    $(this).val(value);
                }
            });
        
            /* 생년월일 숫자만 입력 여부판단 */
            $(".cti-area input[name=riaBirthday]").on("keyup", function(e){
                $(this).val($(this).val().replace(/[^0-9]/g,""));
            });
            $(".cti-area input[name=riaBirthday]").focusout(function(){
                $(this).val($(this).val().replace(/[^0-9]/g,""));
            });
        
            /* 휴대폰번호 숫자만 입력 여부판단 */
            $(".cti-area input[name=riaMobileNo]").on("keyup", function(e){
                $(this).val($(this).val().replace(/[^0-9]/g,""));
            });
            $(".cti-area input[name=riaMobileNo]").focusout(function(){
                $(this).val($(this).val().replace(/[^0-9]/g,""));
            });
        });
        
        
        /*날짜 형태 확인*/
        function fn_validateDateYn(param) {
            try
            {
                var yearFront = "";
                var year = "";
                var month = "";
                var day = "";
        
                param = param.replace(/-/g,'');
        
                // 자리수가 맞지않을때
                if( isNaN(param) || param.length < 6 || param.length == 7) {
                    return false;
                }
        
                if(param.length == 6){
                    year = Number(param.substring(0, 2));
                    month = Number(param.substring(2, 4));
                    day = Number(param.substring(4, 6));
                }
                else if (param.length == 8){
                    var date = new Date();
                    yearFront = Number(param.substring(0, 4));
                    year = Number(param.substring(2, 4));
                    month = Number(param.substring(4, 6));
                    day = Number(param.substring(6, 8));
        
                    if(yearFront > date.getFullYear()){
                        return false;
                    }
                }
                var dd = day / 0;
        
                if( month<1 || month>12 ) {
                    return false;
                }
        
                var maxDaysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
                var maxDay = maxDaysInMonth[month-1];
        
                // 윤년 체크
                if( month==2 && ( year%4==0 && year%100!=0 || year%400==0 ) ) {
                    maxDay = 29;
                }
        
                if( day<=0 || day>maxDay ) {
                    return false;
                }
                return true;
        
            } catch (err) {
                return false;
            }
        }
        
        </script>
        <!-- cti 일때만 출력 -->
        <div class="cti-area" style="display:none">
            <p>이름</p>
            <input maxlength="20" name="riaName" type="text" title="이름 출력" class="input-text a-c w120px" placeholder="이름" value="">
        
            <p>생년월일</p>
            <input maxlength="8" name="riaBirthday" type="text" title="생년월일 출력" class="input-text a-c w150px" placeholder="6자리 또는 8자리" value="">
        
            <p>휴대폰번호</p>
            <input maxlength="11" name="riaMobileNo" type="text" title="휴대폰번호 출력" class="input-text a-c w150px" placeholder="- 없이 입력" value="">
        
            <p>회원</p>
            <input name="riaMemberYn" type="text" title="회원여부 출력" class="input-text a-c w100px" value="" readyonly="readyonly">
        
            
                
            
        </div>
        
                <!-- seat-select-section -->
                <div class="seat-select-section">
                    <!-- seat-section -->
                    <div class="seat-section h-auto">
        
                        <div class="tit-util">
                            <h3 class="tit small">관람권 및 할인적용<!-- 관람권 및 할인적용--></h3>
        
                            <div class="right">
                                <button type="button" class="button gray-line small" id="btn_booking_init"><i class="iconset ico-reset-small"></i>초기화<!-- 초기화 --></button>
                            </div>
                        </div>
        
                        <!-- discout-setting -->
                        
                            <div class="discout-setting">
                                <div class="discout-list">
                                    <ul>
                                        <li>
                                            <a href="#mega_point" class="tit" id="grp_mega_point" name="grp_mega_dc" title="메가박스 포인트/쿠폰">
                                                메가박스 포인트/쿠폰<!-- 메가박스 포인트/관람권 -->
                                                <!-- <span class="text">멤버십 포인트는 월~금(주말 및 공휴일 제외) 평일에만 사용 가능합니다. </span> -->
                                                <i class="iconset ico-btn-more-arr"></i>
                                            </a>
        
                                            <div id="mega_point" class="cont-down">
                                                <div class="coupon-box">
                                                     <div class="item col-1">
                                                        <a href="#layer_memp" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_memp" id="btn_pay_memp" title="메가박스 멤버십 포인트">
                                                            <span class="txt">메가박스 멤버십 포인트 <!-- 메가박스 멤버십 포인트 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_memp" method="memp">취소 <!-- 취소 --></button>
                                                    </div>
                                                    <div class="item col-1">
                                                        <a href="#layer_dcoupon" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_dcoupon" id="btn_pay_dcoupon" title="메가박스 할인쿠폰">
                                                            <span class="txt">메가박스 할인쿠폰 <!-- 메가박스 할인쿠폰 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_dcoupon" method="dcoupon">취소 <!-- 취소 --></button>
                                                    </div>
                                                    <div class="item col-1">
                                                        <a href="#layer_vip_coupon" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_vipCpon" id="btn_pay_vipCpon" title="메가박스 VIP영화쿠폰">
                                                            <span class="txt">메가박스 VIP영화쿠폰<!-- 메가박스 VIP영화쿠폰 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_vipCpon" method="vipCpon">취소 <!-- 취소 --></button>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
        
                                        <li>
                                            <a href="#mobile_coupon" class="tit" id="grp_mobile_point" name="grp_mega_dc" title="관람권/모바일상품권">관람권/모바일상품권 <!-- 제휴 모바일 쿠폰 --> <i class="iconset ico-btn-more-arr"></i></a>
                                            <div id="mobile_coupon" class="cont-down">
                                                <div class="coupon-box">
                                                    <div class="item col-1">
                                                        <a href="#layer_movie_megabox_coupon" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_mcoupon" id="btn_pay_mcoupon" title="메가박스 관람권">
                                                            <span class="txt">메가박스 관람권 <!-- 메가박스 관람권 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_mcoupon" method="mcoupon">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    <div class="item col-1">
                                                        <a href="#layer_store_change" w-data="600" h-data="560" class="btn-modal-open" name="btn_pay_scoupon" id="btn_pay_scoupon" title="스토어교환권">
                                                            <span class="txt">스토어교환권 <!-- 스토어교환권 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_scoupon" method="scoupon">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    <div class="item col-1">
                                                        <a href="#layer_gifticon" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_gfcon" id="btn_pay_gfcon" title="기프티콘">
                                                            <span class="txt">기프티콘 <!-- 기프티콘 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_gfcon" method="gfcon">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    <div class="item col-1">
                                                        <a href="#layer_giftishow" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_gfshow" id="btn_pay_gfshow" title="기프티쇼">
                                                            <span class="txt">기프티쇼 <!-- 기프티쇼 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_gfshow" method="gfshow">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    <div class="item col-1">
                                                        <a href="#layer_inumber" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_inumber" id="btn_pay_inumber" title="아이넘버">
                                                            <span class="txt">아이넘버 <!-- 아이넘버 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_inumber" method="inumber">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    <div class="item col-1">
                                                        <a href="#layer_gmarket" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_gmarket" id="btn_pay_gmarket" title="G마켓 예매권">
                                                            <span class="txt">G마켓 예매권 <!-- G마켓 예매권 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_gmarket" method="gmarket">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    <div class="item col-1">
                                                        <a href="#layer_smartcon" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_smcon" id="btn_pay_smcon" title="스마트콘">
                                                            <span class="txt">스마트콘 <!-- 스마트콘 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_smcon" method="smcon">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    <div class="item col-1">
                                                        <a href="#layer_alliance" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_pcoupon" id="btn_pay_pcoupon" title="제휴예매권">
                                                            <span class="txt">제휴예매권 <!-- 제휴예매권 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_pcoupon" method="pcoupon">취소 <!-- 취소 --></button>
                                                    </div>
                                                    
                                                    <div class="item col-1">
                                                        <a href="#layer_happgift" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_happgift" id="btn_pay_happgift" title="해피머니 모바일 문화상품권">
                                                            <span class="txt">해피머니 모바일 문화상품권 <!-- 해피머니 - 해피머니상품권 --></span>
                                                        </a>
                                                        <button type="button" class="btn-cancel" id="btn_cancel_happgift" method="happgift">취소 <!-- 취소 --></button>
                                                    </div>
                                                    
                                                    
                                                    <div class="item col-1">
                                                        <a href="#layer_donutbook" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_donut" id="btn_pay_donut" title="도넛북">
                                                            <span class="txt">도넛북 <!-- 도넛북 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_donut" method="donut">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    <div class="item col-1">
                                                        <a href="#layer_friends" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_friends" id="btn_pay_friends" title="스타카드/프렌즈 멤버십">
                                                            <span class="txt">스타카드/프렌즈 멤버십 <!-- 스타카드/프렌즈 멤버십 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_friends" method="friends">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    <div class="item col-1">
                                                        <a href="#layer_annus_card" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_annus" id="btn_pay_annus" title="메가박스 아너스카드">
                                                            <span class="txt">메가박스 아너스카드 <!-- 메가박스 아너스카드 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_annus" method="annus">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                </div>
                                            </div>
                                        </li>
        
                                        <li>
                                            <a href="#point_coupon" class="tit" id="grp_point_coupon" name="grp_mega_dc" title="제휴포인트">제휴포인트 <!-- 포인트/할인쿠폰 --> <i class="iconset ico-btn-more-arr"></i></a>
                                            <div id="point_coupon" class="cont-down">
                                                <div class="coupon-box">
                                                    <div class="item col-1">
                                                        <a href="#layer_skt" w-data="600" h-data="550" class="btn-modal-open disabled" name="btn_pay_skt" id="btn_pay_skt" title="SKT 멤버십">
                                                            <span class="txt">SKT 멤버십 <!-- SKT 멤버십 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_skt" method="skt">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    <div class="item col-1">
                                                        <a href="#layer_okcashbag" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_okcb" id="btn_pay_okcb" title="OK 캐쉬백">
                                                            <span class="txt">OK 캐쉬백 <!-- OK 캐쉬백 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_okcb" method="okcb">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    <div class="item col-1">
                                                        <a href="#layer_gs_point" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_gsnp" id="btn_pay_gsnp" title="GS&amp;POINT">
                                                            <span class="txt">GS&amp;POINT <!-- GS&amp;POINT --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_gsnp" method="gsnp">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    <div class="item col-1">
                                                        <a href="#layer_oilbank" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_hyoil" id="btn_pay_hyoil" title="현대오일뱅크">
                                                            <span class="txt">현대오일뱅크 <!-- 현대오일뱅크 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_hyoil" method="hyoil">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    <div class="item col-1">
                                                        <a href="#layer_happypoint" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_happ" id="btn_pay_happ" title="해피포인트">
                                                            <span class="txt">해피포인트 <!-- 해피포인트 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_happ" method="happ">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    <div class="item col-1">
                                                        <a href="#layer_bluemembers" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_hbluep" id="btn_pay_hbluep" title="블루멤버스 포인트">
                                                            <span class="txt">블루멤버스 포인트 <!-- 블루멤버스 포인트 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_hbluep" method="hbluep">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    <div class="item col-1">
                                                        <a href="#layer_jmembership" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_joongang" id="btn_pay_joongang" title="중앙멤버십">
                                                            <span class="txt">중앙멤버십 <!-- 중앙멤버십 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_joongang" method="joongang">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    <div class="item col-1">
                                                        <a href="#layer_hyundai_m_point" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_hydm" id="btn_pay_hydm" title="현대 M 포인트 카드">
                                                            <span class="txt">현대 M 포인트 카드 <!-- 현대 M 포인트 카드 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_hydm" method="hydm">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                    
                                                    <div class="item col-1">
                                                        <a href="#layer_happcash" w-data="600" h-data="550" class="btn-modal-open" name="btn_pay_happcash" id="btn_pay_happcash" title="해피머니상품권 해피캐시">
                                                            <span class="txt">해피머니상품권 해피캐시</span><!-- 해피머니 - 해피캐시 -->
                                                        </a>
                                                        <button type="button" class="btn-cancel" id="btn_cancel_happcash" method="happcash">취소</button><!-- 취소 -->
                                                    </div>
                                                    
                                                    
                                                    <div class="item col-1">
                                                        <a href="#layer_mnuri" w-data="600" h-data="550" class="btn-modal-open disabled" name="btn_pay_culturenuri" id="btn_pay_culturenuri" title="문화누리카드">
                                                            <span class="txt">문화누리카드 <!-- 문화누리카드 --></span>
                                                        </a>
        
                                                        <button type="button" class="btn-cancel" id="btn_cancel_culturenuri" method="culturenuri">취소 <!-- 취소 --></button>
                                                    </div>
        
                                                </div>
                                            </div>
                                        </li>
        
                                    </ul>
                                </div>
                            </div>
                        
                        
                        <!--// discout-setting -->
                        
                        <div class="tit-util mt40">
                            <h3 class="tit small">결제수단선택 <!-- 결제수단선택 --></h3>
        
                            <div class="right">
                                <input type="checkbox" id="same_use_payment">
                                <label for="same_use_payment" id="label_use_payment">다음에도 이 결제수단 사용 <!-- 다음에도 이 결제수단 사용 --></label>
                            </div>
                        </div>
        
                        <!--
                            체크 표시 on 클래스 추가
        
                            <button type="button">
        
                            <button type="button" class="on">
                        -->
                        <div class="select-payment">
        
                            <div class="radio-group">
                                <span class="bg-chk small">
                                    <input type="radio" name="radio_payment" id="rdo_pay_credit" value="credit"> <label for="rdo_pay_credit">신용/체크카드 <!-- 신용/체크카드 --></label>
                                </span>
                                <span class="bg-chk small">
                                    <input type="radio" name="radio_payment" id="rdo_pay_mobile" value="mobile"> <label for="rdo_pay_mobile">휴대폰 결제 <!-- 휴대폰 소액결제 --></label>
                                </span>
                                <span class="bg-chk small">
                                    <input type="radio" name="radio_payment" id="rdo_pay_kakaopay" value="kakaopay"> <label for="rdo_pay_kakaopay" class="kakaopay">카카오페이 <!-- 카카오페이 결제 --></label>
                                </span>
                                <span class="bg-chk small">
                                    <input type="radio" name="radio_payment" id="rdo_pay_payco" value="payco"> <label for="rdo_pay_payco" class="payco">페이코 <!-- 페이코 결제 --></label>
                                </span>
                            </div>
        
                            <div class="select-payment-card">
                                <label for="card_select">카드사 선택 <!-- 카드사 선택 --></label>
                                <div class="dropdown bootstrap-select v1 small bs3"><select id="card_select" title="카드사 선택" class="selectpicker v1 small" tabindex="-98"><option class="bs-title-option" value=""></option>
                                    <option value="00" selected="">카드선택</option><!-- 전체카드   -->
                                    <option value="01">비씨카드</option><!-- 비씨카드   -->
                                    <option value="07">국민카드</option><!-- 국민카드   -->
                                    <option value="02">신한카드</option><!-- 신한카드   -->
                                    <option value="03">삼성카드</option><!-- 삼성카드   -->
                                    <option value="05">롯데카드</option><!-- 롯데카드   -->
                                    <option value="12">농협카드</option><!-- 농협카드   -->
                                    <option value="27">하나카드</option><!-- 하나카드   -->
                                    <option value="04">현대카드</option><!-- 현대카드   -->
                                    <option value="13">씨티카드</option><!-- 씨티카드   -->
                                    <option value="22">제주카드</option><!-- 제주카드   -->
                                    <option value="14">우리카드</option><!-- 우리카드   -->
                                    <option value="11">수협카드</option><!-- 수협카드   -->
                                    <option value="24">전북카드</option><!-- 전북카드   -->
                                    <option value="23">광주카드</option><!-- 광주카드   -->
                                    <option value="17">신협카드</option><!-- 신협카드   -->
                                    <option value="90">카카오뱅크</option><!-- 카카오뱅크 -->
                                    <option value="91">케이뱅크</option><!-- 케이뱅크   -->
                                    
                                    <option value="B0">우체국카드</option><!-- 우체국 카드   -->
                                    <option value="B1">토스  카드</option><!-- 토스  카드  -->
                                    <option value="B2">SC제일은행 비씨카드</option><!-- SC제일은행 비씨카드   -->
                                    <option value="S0">SC제일은행 삼성카드</option><!-- SC제일은행 삼성카드   -->
                                    <option value="B3">IBK기업은행 카드</option><!-- IBK기업은행 카드  -->
                                </select><button type="button" class="btn dropdown-toggle btn-default" data-toggle="dropdown" role="button" data-id="card_select" title="카드선택"><div class="filter-option"><div class="filter-option-inner"><div class="filter-option-inner-inner">카드선택</div></div> </div><span class="bs-caret"><span class="caret"></span></span></button><div class="dropdown-menu open" role="combobox"><div class="inner open" role="listbox" aria-expanded="false" tabindex="-1"><ul class="dropdown-menu inner "></ul></div></div></div>
        
                                <input type="radio" name="rdo_card_select" id="app_card" class="ml20" checked="" value="01" style="display: none;">
                                <label for="app_card" id="lab_app_card" style="display: none;">앱카드 <!-- ISP, APP --></label>
        
                                <input type="radio" name="rdo_card_select" id="general_card" class="ml20" value="00" style="display: none;">
                                <label for="general_card" id="lab_general_card" style="display: none;">일반결제 <!-- 일반결제 --></label>
        
                                <input type="radio" name="rdo_card_select" id="sepecial_card" value="02" style="display:none;">
                                <label for="sepecial_card" id="lab_sepecial_card" style="display:none;">포인트사용 <!-- 삼성카드 포인트 사용 --></label>
                            </div>
        
                            <!-- 2020.02.07 수단별 알림 문구 추가 -->
                            <div class="select-mobile-info" style="display:none">
                                <ul class="dash-list">
                                    <li>결제하신 금액은 익월 휴대폰 요금에 합산되어 청구되며, 휴대폰 결제한도는 통산사별 월 누적 이용 제한에 따라 적용됩니다.</li>
                                    <li>매월 말일 23시30분 ~ 익월 00시 10분까지(40분간)는 시스템 점검시간으로 이용이 어려울 수 있습니다.</li>
                                    <li>휴대폰 결제와 관련된 추가 안내는 FAQ를 참조해주세요.</li>
                                </ul>
                            </div>
        
                            <div class="select-kakao-info" style="display:none">
                                <ul class="dash-list">
                                    <li>BC카드, 시티카드, 우리카드, 새마을카드 등은 카드사 사정으로 사용이 제한되오니 타 카드 사용 또는 신용/체크카드 결제 도구에서 사용해주시기 바랍니다.</li>
                                </ul>
                            </div>
        
                            <div class="select-payco-info" style="display:none">
                                <ul class="dash-list">
                                    <li>BC카드, 시티카드, 우리카드, 새마을카드 등은 카드사 사정으로 사용이 제한되오니 타 카드 사용 또는 신용/체크카드 결제 도구에서 사용해주시기 바랍니다.</li>
                                </ul>
                            </div>
        
                        </div>
                    </div>
                    <!--// seat-section -->
        
                    <!-- seat-result -->
                    <div class="seat-result">
                        <div class="wrap">
        
                            <div class="tit-area type2">
                                <!--
                                    관람 등급 표시
                                    <span class="movie-grade small age-all">전체 관람가</span>
                                    <span class="movie-grade small age-12">12세 이상 관람가</span>
                                    <span class="movie-grade small age-15">15세 이상 관람가</span>
                                    <span class="movie-grade small age-19">청소년 관람 불가</span>
                                    <span class="movie-grade small age-no">미정</span>
                                -->
                                <span class="movie-grade small age-15" id="admisClassNm">15세이상관람가</span>
        
                                <p class="tit" id="movieNm">강철비2: 정상회담</p>
                                <p class="cate" id="playKindNm">2D</p>
                                <p class="theater" id="brchNm">신촌/5관</p>
                                <p class="date"><span id="playDe">2020.07.30</span><em id="dowNm">(목)</em> <span class="time" id="playTime"><i class="iconset ico-clock-white"></i>10:10~12:32</span></p>
                            </div>
                            <div class="price-process">
                                <div class="box"><div class="data"><span class="tit">성인 <em>1</em></span><span class="price">7,000</span></div>
                                    <!--
                                    <div class="data">
                                        <span class="tit">일반 <em>1</em></span>
                                        <span class="price">20,000</span>
                                    </div>
        
                                    <div class="data">
                                        <span class="tit">어린이 <em>2</em></span>
                                        <span class="price">6,000</span>
                                    </div>
                                    -->
                                    <div class="all">
                                        <span class="tit">금액 <!-- 금액 --></span>
                                        <span class="price"><em>7,000</em> <span>원 <!-- 원 --></span></span>
                                    </div>
                                </div>
        
                                <div class="box discout-box">
        
                                    <div class="all">
                                        <span class="tit">할인적용 <!-- 할인적용 --></span>
                                        <span class="price"><em>0</em> 원 <!-- 원 --></span>
                                    </div>
                                </div>
                            </div>
        
                            <div class="pay-area">
                                <div class="add-thing">
                                    <p class="tit">추가차액 <!-- 추가금액 --></p>
        
                                    <div class="money">0</div>
                                </div>
                                <div class="pay">
                                    <p class="tit">최종결제금액 <!-- 최종결제금액 --></p>
        
                                    <div class="money">
                                        <em>7,000</em>
                                        <span>원 <!-- 원 --></span>
                                    </div>
                                </div>
                                <div class="payment-thing">
                                    <span class="tit">결제수단 <!-- 결제수단 --></span>
                                    <span class="thing">신용/체크카드 </span>
                                </div>
                            </div>
        
                            <div class="btn-group">
                                <a href="#" class="button" id="btn_booking_back" title="이전">이전 <!-- 이전 --></a>
                                
                                    
                                    
                                    
                                        <a href="#" w-data="600" h-data="400" class="button active btn-modal-open" id="btn_booking_pay" title="결제">결제</a>
                                        
                                        
                                    
                                
                            </div>
                        </div>
                    </div>
                    <!--// seat-result -->
        
                </div>
                <!--// seat-select-section -->
        
            </div>
            <!--// quick-reserve -->
        </div>
        
        
            <!-- 레이어 : 메가박스 VIP영화쿠폰 -->
            
        
        
        
        
        
        
        <script type="text/javascript">
            var vipCponList = new Array();
        
            //초기화 공통 sMethodName.init
            function vipCpon_init() {
                //조회내역 초기화
                //$('#layer_vip_coupon .table-wrap > table > tbody> tr').remove();
                $('#layer_vip_coupon .table-wrap > .scroll > table > tbody> tr').remove();
            }
        
            $(function() {
                //VIP 쿠폰 적용
                $('#btn_apply_vipCpon').on('click', function() {
                    applyVipCpon();
                });
        
                //VIP 쿠폰 적용취소
                $('#btn_cancel_apply_vipCpon').on('click', function() {
                    var sMethodName = "vipCpon";
                    cancelMbxSellCpInfo(sMethodName);
        
                    //닫기버튼 클릭
                       $('#layer_vip_coupon .close-layer').click();
                });
            });
        
            //vip 쿠폰 존재여부
            function getInitVipcponCnt() {
                //return $('#layer_vip_coupon .table-wrap > table > tbody> tr').length;
                return $('#layer_vip_coupon .table-wrap > .scroll > table > tbody> tr').length;
            }
        
            //vip 쿠폰 초기화
            function setInitVipcpon() {
                //$('#layer_vip_coupon .table-wrap > table > tbody> tr').remove();
                $('#layer_vip_coupon .table-wrap > .scroll > table > tbody> tr').remove();
            }
        
            //vip 쿠폰 조회
            function searchVipCpon() {
                //초기화
                setInitVipcpon();
                var transNo       = $("#transNo").val();
                var paramData     = {transNo:transNo};
        
                $('#layer_vip_coupon .table-wrap > .scroll > table > tbody> tr').remove();
                vipCponList = new Array();
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/searchVipCpon.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
                        //쿠폰 전역변수 세팅
                        vipCponList = data.cponList;
                        //쿠폰 목록 세팅
                        setVipCponList(vipCponList);
        
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
                    }
                });
            }
        
            //vip 쿠폰 목록 세팅
            function setVipCponList(cponList) {
                var cponListText = "";
                for(var i=0;i<cponList.length;i++) {
                    var expoNo  = cponList[i].cponNo.substring(0,4)
                    +"-"+cponList[i].cponNo.substring(4,8)
                    +"-"+cponList[i].cponNo.substring(8,12)
                    +"-****";
        
                    cponListText = '<tr> ';
                    cponListText += '	<td class="a-l"> ';
                    cponListText += '		<strong>'+cponList[i].cponNm+'</strong><p class="inner-code">'+expoNo+'</p>';
                    cponListText += '	</td> ';
                    cponListText += '	<td>'+cponList[i].validStartDe.maskDate()+'~'+cponList[i].validEndDe.maskDate()+'</td> ';
                    cponListText += '	<td><input type="checkbox" title="쿠폰 사용" name="chkVipCpon" idx="'+i+'"/></td> ';
                    cponListText += '</tr> ';
        
                    //$('#layer_vip_coupon .table-wrap > table > tbody').append(cponListText);
                    $('#layer_vip_coupon .table-wrap > .scroll > table > tbody').append(cponListText);
                    //체크박스 이벤트 생성
                    setChkVipCponEvent();
                }
            }
        
            //체크박스 이벤트
            function setChkVipCponEvent() {
                $(":checkbox[name='chkVipCpon']").off().on('click', function() {
        
                    if (!$(this).prop('checked')) {
                        return;
                    }
                    var transNo    = $("#transNo").val();
                    var cponDivCd  = vipCponList[$(this).attr('idx')].cponDivCd;
                    var cponNo     = vipCponList[$(this).attr('idx')].cponNo;
                    var methodName = "vipCpon";
                    var paramData  = {transNo:transNo, cponDivCd:cponDivCd, cponNo:cponNo, methodName:methodName};
                    var idx        = $(this).attr('idx');
        
                    $.ajax({
                        url: "/on/oh/ohz/PayBooking/applyAbleCponChk.do",
                        type: "POST",
                        contentType: "application/json;charset=UTF-8",
                        dataType: "json",
                        data: JSON.stringify(paramData),
                        success: function (data, textStatus, jqXHR) {
                            //console.log(data);
                            if (!msgBookingLoginChk(data)) {
                                return;
                            }
                        },
                        error: function(xhr,status,error){
                            var err = JSON.parse(xhr.responseText);
                            //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                            errBookingChk(err.msg);
        
                            //추후 order 변경 등 고려 foreach 로 처리
                            $(":checkbox[name='chkVipCpon']").each(function() {
                                if ($(this).attr('idx') == idx) {
                                    $(this).prop('checked', false);
                                }
                            });
                        }
                    });
        
                });
            }
        
            //vip 쿠폰 적용
            function applyVipCpon() {
                var chkCnt = $(":checkbox[name='chkVipCpon']:checked").length;
        
                if ( chkCnt == 0 ) {
                    gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
                    return;
                }
        
                var transNo   = $("#transNo").val();
                var paramCpon = new Array();
        
                $(":checkbox[name='chkVipCpon']:checked").each(function(idx) {
                    vipCponList[$(this).attr('idx')].transNo = transNo;
                    paramCpon.push(vipCponList[$(this).attr('idx')]);
                });
        
                ////console.log(paramCpon);
        
                var paramData = {transNo:transNo, cponList:paramCpon};
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/applyVipCpon.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
        
                        //할인내역 갱신
                        setMovieDcInfo(data.policyList);
        
                        $('#btn_cancel_vipCpon').show(); //취소버튼
                        $('#btn_cancel_apply_vipCpon').show(); //적용취소버튼
        
        
                        //닫기버튼 클릭
                        $('#layer_vip_coupon .close-layer').click();
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
                    }
                });
            }
        
        </script>
        <!-- 레이어 : 메가박스 VIP영화쿠폰 -->
        <section id="layer_vip_coupon" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
            <div class="wrap">
                <header class="layer-header">
                    <h3 class="tit">메가박스 VIP영화쿠폰<!-- 메가박스 VIP영화쿠폰 --></h3>
                </header>
        
                <div class="layer-con">
                    <div class="reset mb10">
                        사용할 쿠폰을 선택해주세요.<!-- 보유중인 VIP 영화쿠폰을 선택해주세요. -->
                    </div>
        
                    <div class="table-wrap divide">
                        <table class="board-list line">
                            <caption>VIP영화쿠폰을 쿠폰, 유효기간, 사용여부 항목을 가진 메가박스 VIP영화쿠폰 목록의 제목 표<!-- 메가박스 VIP영화쿠폰을 쿠폰, 유효기간, 사용여부 항목을 가진 메가박스 VIP영화쿠폰 목록의 제목 표 --></caption>
                            <colgroup>
                                <col>
                                <col style="width:200px;">
                                <col style="width:56px;">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th scope="col">쿠폰 <!-- 쿠폰 --></th>
                                    <th scope="col">유효기간 <!-- 유효기간 --></th>
                                    <th scope="col">사용 <!-- 사용 --></th>
                                </tr>
                            </thead>
                        </table>
        
                        <!--
                            상황에 따라 스크롤 높이값이 달라지기 때문에 인라인으로 넣어줘야 함
                         -->
                        <div class="scroll" style="min-height:340px; max-height:340px;">
                            <table class="board-list line">
                                <caption>메가박스 VIP영화쿠폰을 쿠폰, 유효기간, 사용여부 항목을 가진 메가박스 VIP영화쿠폰 목록의 내용 표<!-- 메가박스 VIP영화쿠폰을 쿠폰, 유효기간, 사용여부 항목을 가진 메가박스 VIP영화쿠폰 목록의 내용 표 --></caption>
                                <colgroup>
                                    <col>
                                    <col style="width:200px;">
                                    <col style="width:56px;">
                                </colgroup>
                                <tbody>
                                    <!-- <tr>
                                        <td class="a-l">
                                            <strong>관람권명</strong><br />
                                            1234-5678-1234-****
                                        </td>
                                        <td>2019-01-08~2019-01-31</td>
                                        <td><input type="checkbox" title="쿠폰 사용" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">
                                            <strong>부티크프라이빗 관람권</strong><br />
                                            1234-5678-1234-****
                                        </td>
                                        <td>2019-01-08~2019-01-31</td>
                                        <td><input type="checkbox" title="쿠폰 사용" /></td>
                                    </tr> -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!--
                    <div class="box-border v1 use-guide mt15">
                        <p class="tit">이용안내</p>
        
                        <ul class="dot-list">
                            <li>등록된 관람권은 나의메가박스에서 확인 및 삭제하실 수 있습니다.</li>
                        </ul>
                    </div>
                     -->
                </div>
        
                <div class="btn-group-fixed">
                    <button type="button" class="button small close-layer">닫기 <!-- 닫기 --></button>
                    <button type="button" class="button small purple" id="btn_cancel_apply_vipCpon" style="display:none;">적용취소 <!-- 적용취소 --></button>
                    <button type="button" class="button small purple" id="btn_apply_vipCpon">적용 <!-- 적용 --></button>
                </div>
        
                <button type="button" class="btn-modal-close">레이어 닫기 <!-- 레이어 닫기 --></button>
            </div>
        </section>
        <!--// 레이어 : 메가박스 VIP영화쿠폰 -->
        
        
            <!--// 레이어 : 메가박스 VIP영화쿠폰 -->
        
            <!-- 레이어 : 메가박스 관람권 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var mcouponChgList = new Array();
        
        //초기화 공통 sMethodName.init
        function mcoupon_init() {
            setInitMcouponChg();
            mcouponChgList = new Array();
            $('#mcouponNo').val('');
            $('#mcouponCertNo').val('');
        }
        
        $(function() {
            //영화관람권 문자만 사용
            //$("#scouponNo").megaBoxNumberCheck();
            $("#mcouponCertNo").megaBoxNumberCheck();
        
            //교환권 등록버튼 클릭
            $('#btn_reg_mcoupon').on('click', function() {
                registMcoupon();
            });
        
            //적용버튼 클릭
            $('#btn_apply_mcoupon').on('click', function() {
                applyMcouponChg();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_mcoupon').on('click', function() {
                var sMethodName = "mcoupon";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                   $('#layer_movie_megabox_coupon .close-layer').click();
            });
        
            //닫기버튼 클릭
            $('#btn_close_mcoupon, #btn_close_modal_mcoupon').on('click', function() {
                $('#mcouponNo').val('');
                $('#mcouponCertNo').val('');
            });
        });
        
        //영화관람권 존재여부
        function getInitMcouponChgCnt() {
            //return $('#layer_movie_megabox_coupon .table-wrap > table > tbody> tr').length;
            return $('#layer_movie_megabox_coupon .table-wrap > .scroll > table > tbody> tr').length;
        }
        
        //영화관람권 초기화
        function setInitMcouponChg() {
            //$('#layer_movie_megabox_coupon .table-wrap > table > tbody> tr').remove();
            $('#layer_movie_megabox_coupon .table-wrap > .scroll > table > tbody> tr').remove();
        }
        
        //영화관람권 등록
        function registMcoupon() {
            //초기화
            var transNo     = $("#transNo").val();
            var mcouponNo   = $("#mcouponNo").val();
            var mcouponCertNo = $("#mcouponCertNo").val();
        
            //영화관람권 자릿수 체크
            if (mcouponNo.length != 12) {
                gfn_alertMsgBox('메가박스 관람권 번호 12자리를  입력하세요.');	//영화관람권 12자리를 입력하세요
                $("#mcouponNo").focus();
                return;
            }
        
            //인증번호
            if (mcouponCertNo.length != 4) {
                gfn_alertMsgBox('인증번호 번호 4자리를  입력하세요.');	//인증번호 4자리를 입력하세요
                $("#mcouponNo").focus();
                return;
            }
        
            //기 조회여부 체크
            for(var i=0;i<mcouponChgList.length;i++) {
                if (mcouponNo.substring(0, 12) == mcouponChgList[i].cmbndNo) {
                    gfn_alertMsgBox('이미 조회 되었습니다.');
                    return;
                }
            }
            var scouponNo  = mcouponNo + mcouponCertNo;
            var paramData  = {scouponNo:scouponNo, transNo:transNo, cmbnd_type:'mcoupo' };
            $.ajax({
                url: "/on/oh/ohz/PayBooking/registVcCmbnd.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    if (data.resultStatus == 'Y') {
                        addMcouponChg(mcouponNo.substring(0, 12));
                    } else {
                        if (data.resultMsg != null && data.resultMsg != undefined) {
                            gfn_alertMsgBox(data.resultMsg);
                        } else {
                            gfn_alertMsgBox('기명처리 불가한 교환권입니다.');
                        }
                    }
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        
        }
        
        //영화관람권 추가
        function addMcouponChg(mcouponNo) {
            //초기화
            var transNo     = $("#transNo").val();
            var paramData  = {transNo:transNo, cmbndNo:mcouponNo };
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/searchMovieCpon.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //쿠폰 전역변수 세팅
                    var vcCmbndList = data.vcCmbndList[0];
        
                    mcouponChgList.push(vcCmbndList);
                    var i = mcouponChgList.length-1;
        
                    var expoNo  = mcouponChgList[i].cmbndNo.substring(0,4)
                    +"-"+mcouponChgList[i].cmbndNo.substring(4,8)
                    +"-"+mcouponChgList[i].cmbndNo.substring(8,12)
                    +"-****";
        
                    cponListText = '<tr> ';
                    cponListText += '	<td class="a-l">'+mcouponChgList[i].cmbndExpoNm+'<p class="inner-code">'+expoNo+'</p></td> ';
                    cponListText += '	<td class="a-l"> ';
                    //cponListText += '		총(0/1) | 주간(0/1) | 월간(0/1)<br /> '; 현재 영어에서 제한횟수 관리가 되고 있지 않음. 추후 추가 필요
                    cponListText += '		'+String(mcouponChgList[i].validStartDe).maskDate()+'~'+String(mcouponChgList[i].validExprDe).maskDate()+' ';
                    cponListText += '	</td> ';
                    cponListText += '	<td><input type="checkbox" title="메가박스 관람권" name="chkMCpon" idx="'+i+'" cponno="'+mcouponChgList[i].cmbndNo+'"/></td> ';
                    cponListText += '</tr> ';
        
                    //$('#layer_movie_megabox_coupon .table-wrap > table > tbody').append(cponListText);
                    $('#layer_movie_megabox_coupon .table-wrap > .scroll > table > tbody').append(cponListText);
        
                    $('#mcouponNo').val('');
                    $('#mcouponCertNo').val('');
        
                    setChkMcouponEvent();
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        
        
        //영화관람권 조회
        function searchMcouponChg() {
            //초기화
            var transNo    = $("#transNo").val();
            var paramData  = {transNo:transNo };
            mcouponChgList = new Array();
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/searchMovieCpon.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //쿠폰 전역변수 세팅
                    var vcCmbndList = data.vcCmbndList;
                    for(var i=0;i<vcCmbndList.length;i++){
                        mcouponChgList.push(vcCmbndList[i]);
                    }
        
                    //쿠폰 목록 세팅
                    setMcouponChg(mcouponChgList);
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        
        
        //영화관람권 목록 세팅
        function setMcouponChg(cponList) {
            setInitMcouponChg();
            var cponListText = "";
            for(var i=0;i<cponList.length;i++) {
                var expoNo  = cponList[i].cmbndNo.substring(0,4)
                        +"-"+cponList[i].cmbndNo.substring(4,8)
                        +"-"+cponList[i].cmbndNo.substring(8,12)
                        +"-****";
        
                cponListText = '<tr> ';
                cponListText += '	<td class="a-l">'+cponList[i].cmbndExpoNm+'<p class="inner-code">'+expoNo+'</p></td> ';
                cponListText += '	<td class="a-l"> ';
                //cponListText += '		총(0/1) | 주간(0/1) | 월간(0/1)<br /> '; 현재 영어에서 제한횟수 관리가 되고 있지 않음. 추후 추가 필요
                cponListText += '		'+String(cponList[i].validStartDe).maskDate()+'~'+String(cponList[i].validExprDe).maskDate()+' ';
                cponListText += '	</td> ';
                cponListText += '	<td><input type="checkbox" title="스토어권 사용" name="chkMCpon" idx="'+i+'" cponno="'+cponList[i].cmbndNo+'"/></td> ';
                cponListText += '</tr> ';
        
                //$('#layer_movie_megabox_coupon .table-wrap > table > tbody').append(cponListText);
                $('#layer_movie_megabox_coupon .table-wrap > .scroll > table > tbody').append(cponListText);
        
                setChkMcouponEvent();
            }
        }
        
        //체크박스 이벤트
        function setChkMcouponEvent() {
            $(":checkbox[name='chkMCpon']").off().on('click', function() {
        
                if (!$(this).prop('checked')) {
                    return;
                }
                var transNo    = $("#transNo").val();
                var cmbndNo    = mcouponChgList[$(this).attr('idx')].cmbndNo;
                var methodName = "mcoupon";
                var paramData  = {transNo:transNo, cmbndNo:cmbndNo, methodName:methodName};
                var idx        = $(this).attr('idx');
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/applyAbleVcmdChk.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
        
                        //추후 order 변경 등 고려 foreach 로 처리
                        $(":checkbox[name='chkMCpon']").each(function() {
                            if ($(this).attr('idx') == idx) {
                                $(this).prop('checked', false);
                            }
                        });
                    }
                });
        
            });
        }
        
        
        //영화관람권 적용
        function applyMcouponChg() {
            var chkCnt = $(":checkbox[name='chkMCpon']:checked").length;
        
            if ( chkCnt == 0 ) {
                gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
                return;
            }
        
            var transNo     = $("#transNo").val();
            var playSchdlNo = $("#playSchdlNo").val();
            var paramCpon   = new Array();
        
            $(":checkbox[name='chkMCpon']:checked").each(function(idx) {
                mcouponChgList[$(this).attr('idx')].transNo = transNo;
                paramCpon.push(mcouponChgList[$(this).attr('idx')]);
            });
        
            var paramData = {transNo:transNo, cponList:paramCpon, playSchdlNo:playSchdlNo};
            $.ajax({
                url: "/on/oh/ohz/PayBooking/applyMovieCpon.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //예매화면 할인내역 갱신
                    setMovieDcInfo(data.policyList);
        
                    $('#btn_cancel_mcoupon').show(); //취소버튼
                    $('#btn_cancel_apply_mcoupon').show(); //적용취소버튼
        
                    //닫기버튼 클릭
                    $('#layer_movie_megabox_coupon .close-layer').click();
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        
        </script>
        
        
        <!-- 레이어 : 메가박스 관람권 -->
        <section id="layer_movie_megabox_coupon" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
            <div class="wrap">
                <header class="layer-header">
                    <h3 class="tit">메가박스 관람권<!-- 메가박스 관람권 --></h3>
                </header>
        
                <div class="layer-con">
                    <div class="reset mb10">
                        보유하신 관람권은 등록 후 사용하실 수 있습니다.<br>사용할 관람권을 등록 또는 선택해주세요.
                        <!-- 보유하신 관람권은 등록 후 사용하실 수 있으며 등록된 관람권은<br />
                        온라인에서만 사용 가능합니다. 사용할 관람권 또는 쿠폰을 선택해주세요. -->
                    </div>
        
                    <div class="popup-gray mid-info-box">
                        <div class="pop-search-area">
                            <p class="sh-txt reset mr08"><span class="label">관람권번호<!-- 관람권번호 --></span></p>
        
                            <div class="sh-input">
                                <input type="text" placeholder="관람권번호 12자리" title="메가박스 관람권 번호 입력" class="input-text w150px" id="mcouponNo" maxlength="12">
                                <input type="text" placeholder="인증번호 4자리" title="메가박스 관람권 인증번호 입력" class="input-text w120px ml05" id="mcouponCertNo" maxlength="4">
                            </div>
        
                            <div class="sh-btn gray">
                                <a href="#layer_movie_megabox_coupon_regi" w-data="600" h-data="320" class="button small gray btn-modal-open" id="btn_reg_mcoupon" title="관람권등록">관람권등록<!-- 관람권등록 --></a>
                            </div>
                        </div>
                    </div>
        
                    <div class="table-wrap divide">
                        <table class="board-list line">
                            <caption>관람권, 유효기간, 사용여부 항목을 가진 영화관람권 목록의 제목 표<!-- 관람권, 유효기간, 사용여부 항목을 가진 영화관람권 목록의 제목 표 --></caption>
                            <colgroup>
                                <col>
                                <col style="width:200px;">
                                <col style="width:56px;">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th scope="col">관람권<!-- 관람권 --></th>
                                    <th scope="col">유효기간<!-- 유효기간 --></th>
                                    <th scope="col">사용<!-- 사용 --></th>
                                </tr>
                            </thead>
                        </table>
        
                        <!--
                            상황에 따라 스크롤 높이값이 달라지기 때문에 인라인으로 넣어줘야 함
                         -->
                        <div class="scroll" style="min-height:129px; max-height:129px;">
                            <table class="board-list line">
                                <caption>관람권, 유효기간, 사용여부 항목을 가진 영화관람권 목록의 내용 표<!-- 관람권, 유효기간, 사용여부 항목을 가진 영화관람권 목록의 내용 표 --></caption>
                                <colgroup>
                                    <col>
                                    <col style="width:200px;">
                                    <col style="width:56px;">
                                </colgroup>
                                <tbody>
                                    <!-- <tr>
                                        <td class="a-l">
                                            <strong>관람권명</strong><br />
                                            1234-5678-1234-****
                                        </td>
                                        <td>2019-01-08~2019-01-31</td>
                                        <td>
                                            <input type="checkbox" title="사용" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">
                                            <strong>부티크프라이빗 관람권</strong><br />
                                            1234-5678-1234-****
                                        </td>
                                        <td>2019-01-08~2019-01-31</td>
                                        <td>
                                            <input type="checkbox" title="사용" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">
                                            <strong>부티크프라이빗 관람권</strong><br />
                                            1234-5678-1234-****
                                        </td>
                                        <td>2019-01-08~2019-01-31</td>
                                        <td>
                                            <input type="checkbox" title="사용" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">
                                            <strong>부티크프라이빗 관람권</strong><br />
                                            1234-5678-1234-****
                                        </td>
                                        <td>2019-01-08~2019-01-31</td>
                                        <td>
                                            <input type="checkbox" title="사용" />
                                        </td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">
                                            <strong>부티크프라이빗 관람권</strong><br />
                                            1234-5678-1234-****
                                        </td>
                                        <td>2019-01-08~2019-01-31</td>
                                        <td>
                                            <input type="checkbox" title="사용" />
                                        </td>
                                    </tr> -->
                                </tbody>
                            </table>
                        </div>
                    </div>
        
                    <div class="box-border v1 use-guide mt15">
                        <p class="tit">이용안내<!-- 이용안내 --></p>
        
                        <ul class="dot-list">
                            <li>온라인에 등록된 관람권은 극장 매표소에서는 사용이 불가합니다.<!-- 등록된 관람권은 나의메가박스에서 확인 및 삭제하실 수 있습니다. --></li>
                            <li>등록된 관람권은 나의메가박스에서 확인하실 수 있습니다.<!-- 등록된 관람권은 나의메가박스에서 확인 및 삭제하실 수 있습니다. --></li>
                        </ul>
                    </div>
                </div>
                <div class="btn-group-fixed">
                    <button type="button" class="button small close-layer" id="btn_close_mcoupon">닫기<!-- 닫기 --></button>
                    <button type="button" class="button small purple" id="btn_cancel_apply_mcoupon" style="display:none;">적용취소<!-- 적용취소 --></button>
                    <button type="button" class="button small purple" id="btn_apply_mcoupon">적용<!-- 적용 --></button>
                </div>
        
                <button type="button" class="btn-modal-close" id="btn_close_modal_mcoupon">레이어 닫기<!-- 레이어 닫기 --></button>
            </div>
        </section>
        <!--// 레이어 : 메가박스 관람권 -->
        
            <!--// 레이어 : 메가박스 관람권 -->
        
            <!-- 레이어 : 메가박스 멤버십 포인트 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var mempNormalMemberChgInfo = new Object();	//memp normal
        var arrSelSeatUniqNo = null;
        
        //초기화 공통 sMethodName.init
        function memp_init() {  //전체초기화
            setInitMempPoint();
            mempNormalMemberChgInfo = new Object();
        }
        
        $(function() {
            // 포인트 체크박스
            $(document).on('click', ':input:checkbox', function(e){
                var totPoint = 0;
                var totCnt = 0;
                arrSelSeatUniqNo = new Array();
        
                $('[id^="memp_chk_point_"]').each(function() {
                    if($(this).prop('checked')) {
                        totPoint = totPoint + $(this).val().toInt();
                        totCnt++;
        
                        var objSelSeat = new Object();
                        var seatUniqNo = $(this).attr('seatUniqNo');
        
                        objSelSeat['seatUniqNo'] = seatUniqNo;
                        arrSelSeatUniqNo.push(objSelSeat);
                    }
                });
        
                $('#mempUseTotalPoint').text(totPoint.format());
                $('#mempUseTotalPointCnt').text(totCnt.format());
            });
        
            //멤버십 포인트 적용
            $('#btn_apply_memp').on('click', function() {
                applyMempPoint();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_memp').on('click', function() {
                var sMethodName = "memp";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                 $('#layer_memp .close-layer').click();
            });
        });
        
        
        //멤버십 포인트 초기화
        function setInitMempPoint() {
            var checkListText = "";
        
            $('.usable-point').find('em').text("0"); // 사용가능 전체 포인트
            $('#mempOldPoint').text("0"); // 구포인트
            $('#mempNewPoint').text("0"); // 신포인트
            $('#mempUseTotalPoint').text("0"); // 적용된 총 포인트
            $('#mempUseTotalPointCnt').text("0") // 적용된 총 매수
        
            $('.chk-wrap').empty();
            for(var i=0; i<8; i++) {
                checkListText =  "<div class=\"block\"></div>";
                $('.chk-wrap').append(checkListText);
            }
        }
        
        //멤버십 포인트 조회
        function searchMempPoint() {
            var transNo   = $("#transNo").val();
        
            memp_init(); // 초기화
        
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            /*
            //if ($('#btn_cancel_apply_memp').is(':visible')) {
            if ($('#btn_cancel_apply_memp').css('display') != "none") {
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.'); //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
        
                $('#btn_pay_memp').addClass("no-event");
                return;
            }
            $('#btn_pay_memp').removeClass("no-event");
            */
        
            var paramData  = {transNo:transNo};
            //console.log("transNo :" + transNo);
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/searchMemberPoint.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //멤버십 포인트 전역변수 세팅
                  mempNormalMemberChgInfo = data.memShipInfo;
        
                  //멤버십 포인트 목록 세팅
                  setMempPointChg(mempNormalMemberChgInfo);
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
            });
        }
        
        //멤버십 포인트 목록 세팅
        function setMempPointChg(pointInfo) {
            // 임시데이타 테스트옹
            /*
            pointInfo = {
                    oldRestPoint : 5000,
                    restPoint : 20000,
                    comboList : [{useCnt:1, useAmt:8000, seatUniqNo:'00201301'},
                                   {useCnt:2, useAmt:8000, seatUniqNo:'00201001'},
                                 {useCnt:3, useAmt:8000, seatUniqNo:'00201101'},
                                  {useCnt:4, useAmt:8000, seatUniqNo:'00201201'}]
            }
            */
        
            // 구포인트가 없을 경우 포인트 구분정보 보여주지 않음
            if (pointInfo.oldRestPoint == 0) {
                $('.point-div').hide();
            }
            // 구포인트는 평일만 사용가능(주말,공휴일인 경우 화면상 diabled), 1:일요일, 7:토요일, 8:공휴일
            if ($('#dowCd').text() == "1" || $('#dowCd').text() == "7" || $('#dowCd').text() == "8") {
                $('#divOldPoint').addClass('disabled');
            }
        
            $('.usable-point').find('em').text(pointInfo.useAbleAmt.format()); // 사용가능 전체 포인트
            $('#mempOldPoint').text(pointInfo.oldRestPoint.format()); // 구포인트
            $('#mempNewPoint').text(pointInfo.restPoint.format()); // 신포인트
            $('.chk-wrap').empty();
        
            var pointCheckListCnt = pointInfo.comboList.length;
        
            for(var i=0; i<8; i++) {
                if (pointCheckListCnt >= (i+1)) {
                    var checkInfo = pointInfo.comboList[i];
                    var appendHtml = "";
        
                    appendHtml += "<div class=\"block\">";
                    appendHtml += "<span class=\"bg\">";
                    appendHtml += "		<input type=\"checkbox\" id=\"memp_chk_point_" + (i+1) + "\" seatUniqNo=\"" + checkInfo.seatUniqNo + "\" value=\"" + checkInfo.useAmt + "\"/> ";
                    appendHtml += "     <label for=\"memp_chk_point_" + (i+1) + "\">" + checkInfo.useCnt + " (" + checkInfo.useAmt.format() + " P)</label>";
                    appendHtml += "</span>";
                    appendHtml += "</div>";
        
                    $('.chk-wrap').append(appendHtml);
                } else {
                    $('.chk-wrap').append("<div class=\"block\"></div>");
                }
            }
        }
        
        //멤버십 포인트 적용
        function applyMempPoint() {
            var transNo = $("#transNo").val();
            //var  useCnt = '4',oldRestPoint = '0',restPoint = '62100';	//멤버십
            //var selSeat = [{seatUniqNo:'00201301'}, {seatUniqNo:'00201001'}, {seatUniqNo:'00201101'}, {seatUniqNo:'00201201'}];
            var useAmt = $('#mempUseTotalPoint').text().replaceAll(",","");
            var useCnt = $('#mempUseTotalPointCnt').text();
            var oldRestPoint = mempNormalMemberChgInfo.oldRestPoint;
            var restPoint = mempNormalMemberChgInfo.restPoint;
            var selSeat = arrSelSeatUniqNo;
        
        
            if ( useAmt.nvlNum(0) == 0 ) {
                gfn_alertMsgBox('할인 적용할 매수를 선택하세요.'); //할인 적용할 매수를 선택하세요.
                return;
            }
        
            var paramData = { oldRestPoint:oldRestPoint,restPoint:restPoint, transNo:transNo, useCnt:useCnt, selSeat:selSeat};
            //console.log(paramData);
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/applyMemberShip.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //할인내역 갱신
                  setMovieDcInfo(data.policyList);
        
                  $('#btn_cancel_memp').show(); //취소버튼
                  $('#btn_cancel_apply_memp').show(); //적용취소버튼
        
                  //닫기버튼 클릭
                  $('#layer_memp .close-layer').click();
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
            });
        }
        </script>
        
        <!-- 레이어 : 메가박스 멤버십 포인트 -->
        <section id="layer_memp" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
            <div class="wrap">
                <header class="layer-header">
                    <h3 class="tit">메가박스 멤버십 포인트<!-- 메가박스 멤버십 포인트 --></h3>
                </header>
        
                <div class="layer-con">
                    <!-- layer-membership-point -->
                    <div class="layer-membership-point">
                        <ul class="dot-list">
                            <li>회원님께서 보유하고 있는 포인트 중 사용 가능한 포인트입니다.<!-- 회원님께서 보유하고 있는 포인트 중 사용 가능한 포인트입니다. --></li>
                            <li>구포인트는 월~금(공휴일 제외) / 신포인트는 요일 상관없이 사용 가능합니다.<!-- 신포인트는 주말 및 공휴일 사용이 가능합니다. --></li>
                            <li>포인트 적립 및 사용 내역은 나의 메가박스 &gt; 멤버십 포인트에서 확인하세요.<!-- 포인트 적립 및 사용 내역 나의메가박스 &gt; 멤버십 포인트에서 확인하세요. --></li>
                        </ul>
        
                        <div class="usable-point">
                            <i class="iconset ico-point"></i> 사용 가능한 멤버십 포인트<!-- 사용 가능한 멤버십 포인트 --> <span><em>0</em> P</span>
                        </div>
        
                        <!-- point-div -->
                        <div class="point-div">
                            <!--
                                비 활성화 처럼 보이게
                                <div class="block disabled">
                             -->
                            <div class="block" id="divOldPoint">
                                <p class="txt">구 포인트<!-- 구 포인트 --></p>
        
                                <a href="#tooltip01_01" class="tooltip hover" title="구포인트 사용안내">
                                    <span><i class="iconset ico-tooltip-gray-outline"></i></span>
                                    <div class="ir" data-width="240">
        
                                        <p class="reset">
                                            <strong>구포인트 사용안내<!-- 구포인트 사용안내 --></strong>
                                        </p>
        
                                        <p class="reset mt05">
                                            구포인트는 상영일 기준 2020.02.04 이전에 적립된 포인트를 대상으로 하며 주말 및 공휴일을 제외한 평일에만 사용이 가능합니다.<!-- 구포인트는 2019.00.00 이전에<br />
                                            적립된 포인트를 대상으로 하며<br />
                                            주말 및 공휴일을 제외한 평일에만<br />
                                            사용이 가능합니다. -->
                                        </p>
                                    </div>
                                </a>
        
                                <p class="point"><span id="mempOldPoint">0</span> P</p>
                            </div>
        
                            <div class="block" id="divNewPoint">
                                <p class="txt">신 포인트<!-- 신 포인트 --></p>
        
                                <a href="#tooltip01_02" class="tooltip hover" title="신포인트 사용안내">
                                    <span><i class="iconset ico-tooltip-gray-outline"></i></span>
                                    <div class="ir" data-width="240">
        
                                        <p class="reset">
                                            <strong>신포인트 사용안내<!-- 신포인트 사용안내 --></strong>
                                        </p>
        
                                        <p class="reset mt05">
                                            신포인트는 상영일 기준 2020.02.04 부터 적립된 포인트를 대상으로 하며 요일에 무관하게 사용가능합니다.
                                            <!-- 신포인트는 2019.00.00 이후에<br />
                                            적립된 포인트를 대상으로 합니다. -->
                                        </p>
                                    </div>
                                </a>
        
                                <p class="point"><span id="mempNewPoint">0</span> P (주말사용 가능<!-- 주말사용 가능 -->)</p>
                            </div>
                        </div>
                        <!--// point-div -->
        
                        <!-- chk-point -->
                        <div class="chk-point">
                            <div class="chk-wrap">
                                <!--
                                <div class="block">
                                    <span class="bg">
                                        <input type="checkbox" name="memp_chk_point_1" id="memp_chk_point_1" /> <label for="memp_chk_point_1">1 (8,000 P)</label>
                                    </span>
                                </div>
                                -->
                            </div>
        
                            <div class="total-point">
                                총<!-- 총 --> <span id="mempUseTotalPoint">0</span> P / <span id="mempUseTotalPointCnt">0</span> 매<!-- 매 -->
                            </div>
                        </div>
                        <!--// chk-point -->
                    </div>
                    <!--// layer-membership-point -->
                </div>
        
                <div class="btn-group-fixed">
                    <button type="button" class="button small close-layer">닫기<!-- 닫기 --></button>
                    <button type="button" class="button small purple" id="btn_cancel_apply_memp" style="display:none;">적용취소<!-- 적용취소 --></button>
                    <button type="button" class="button small purple" id="btn_apply_memp">적용<!-- 적용 --></button>
                </div>
        
                <button type="button" class="btn-modal-close">레이어 닫기<!-- 레이어 닫기 --></button>
            </div>
        </section>
        <!--// 레이어 : 메가박스 멤버십 포인트 -->
        
            <!--// 레이어 : 메가박스 멤버십 포인트 -->
        
            <!-- 레이어 : 스토어교환권 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var storeChgList = new Array();
        
        //초기화 공통 sMethodName.init
        function scoupon_init() {
            setInitStoreChg();
            storeChgList = new Array();
            $('#scouponNo').val('');
        }
        
        $(function() {
            //스토어 교환권 문자만 사용
            //$("#scouponNo").megaBoxNumberCheck();
        
            //교환권 등록버튼 클릭
            $('#btn_reg_scoupon').on('click', function() {
                registStore();
            });
        
            //적용버튼 클릭
            $('#btn_apply_scoupon').on('click', function() {
                applyStoreChg();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_scoupon').on('click', function() {
                var sMethodName = "scoupon";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                   $('#layer_store_change .close-layer').click();
            });
        
            //닫기버튼 클릭
            $('#btn_close_scoupon, #btn_close_modal_scoupon').on('click', function() {
                $('#scouponNo').val('');
            });
        });
        
        //스토어교환권 존재여부
        function getInitStoreChgCnt() {
            //return $('#layer_store_change .table-wrap > table > tbody> tr').length;
            return $('#layer_store_change .table-wrap > .scroll > table > tbody> tr').length;
        }
        
        //스토어교환권 초기화
        function setInitStoreChg() {
            //$('#layer_store_change .table-wrap > table > tbody> tr').remove();
            $('#layer_store_change .table-wrap > .scroll > table > tbody> tr').remove();
        }
        
        //스토어교환권 등록
        function registStore() {
            //초기화
            var transNo     = $("#transNo").val();
            var scouponNo   = $("#scouponNo").val();
        
            //스토어교환권 자릿수 체크
            if (scouponNo.length != 16) {
                gfn_alertMsgBox('스토어교환권 번호 16자리를  입력하세요.');	//스토어교환권 16자리를 입력하세요
                $("#scouponNo").focus();
                return;
            }
        
            //기 조회여부 체크
            for(var i=0;i<storeChgList.length;i++) {
                if (scouponNo.substring(0, 16) == storeChgList[i].cmbndNo) {
                    gfn_alertMsgBox('이미 조회 되었습니다.');
                    return;
                }
            }
        
            var paramData  = {scouponNo:scouponNo, transNo:transNo, cmbnd_type:'store' };
            $.ajax({
                url: "/on/oh/ohz/PayBooking/registVcCmbnd.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    if (data.resultStatus == 'Y') {
                        addStoreChg(scouponNo.substring(0, 16));
                    } else {
                        if (data.resultMsg != null && data.resultMsg != undefined) {
                            gfn_alertMsgBox(data.resultMsg);
                        } else {
                            gfn_alertMsgBox('기명처리 불가한 교환권입니다.');
                        }
                    }
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        
        }
        
        //스토어교환권 추가
        function addStoreChg(scouponNo) {
            //초기화
            var transNo     = $("#transNo").val();
            var paramData  = {transNo:transNo, cmbndNo:scouponNo };
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/searchVcCmbnd.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //쿠폰 전역변수 세팅
                    var vcCmbndList = data.vcCmbndList[0];
        
                    storeChgList.push(vcCmbndList);
                    var i = storeChgList.length-1;
        
        
                    var expoNo  = storeChgList[i].cmbndNo.substring(0,4)
                    +"-"+storeChgList[i].cmbndNo.substring(4,8)
                    +"-"+storeChgList[i].cmbndNo.substring(8,12)
                    +"-****";
        
                    cponListText = '<tr> ';
                    cponListText += '	<td class="a-l">'+storeChgList[i].cmbndExpoNm+'<p class="inner-code">'+expoNo+'</p></td> ';
                    cponListText += '	<td class="a-l"> ';
                    //cponListText += '		총(0/1) | 주간(0/1) | 월간(0/1)<br /> '; 현재 영어에서 제한횟수 관리가 되고 있지 않음. 추후 추가 필요
                    cponListText += '		'+String(storeChgList[i].validStartDe).maskDate()+'~'+String(storeChgList[i].validExprDe).maskDate()+' ';
                    cponListText += '	</td> ';
                    cponListText += '	<td><input type="checkbox" title="" name="chkSCpon" idx="'+i+'" cponno="'+storeChgList[i].cmbndNo+'"/></td> '; //MSG 스토어권 사용
                    cponListText += '</tr> ';
        
                    //$('#layer_store_change .table-wrap > table > tbody').append(cponListText);
                    $('#layer_store_change .table-wrap > .scroll > table > tbody').append(cponListText);
        
                    $('#scouponNo').val('');
        
                    setChkStoreEvent();
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        
        
        //스토어교환권 조회
        function searchStoreChg() {
            //초기화
            var transNo     = $("#transNo").val();
            var paramData  = {transNo:transNo };
        
            $('#layer_store_change .table-wrap > .scroll > table > tbody> tr').remove();
            storeChgList = new Array();
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/searchVcCmbnd.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //쿠폰 전역변수 세팅
                    var vcCmbndList = data.vcCmbndList;
                    for(var i=0;i<vcCmbndList.length;i++){
                        storeChgList.push(vcCmbndList[i]);
                    }
        
                    //쿠폰 목록 세팅
                    setStoreChg(storeChgList);
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        
        
        //스토어교환권 목록 세팅
        function setStoreChg(cponList) {
            setInitStoreChg();
            var cponListText = "";
            for(var i=0;i<cponList.length;i++) {
                var expoNo  = cponList[i].cmbndNo.substring(0,4)
                                +"-"+cponList[i].cmbndNo.substring(4,8)
                                +"-"+cponList[i].cmbndNo.substring(8,12)
                                +"-****";
        
                cponListText = '<tr> ';
                cponListText += '	<td class="a-l">'+cponList[i].cmbndExpoNm+'<p class="inner-code">'+expoNo+'</p></td> ';
                cponListText += '	<td class="a-l"> ';
                //cponListText += '		총(0/1) | 주간(0/1) | 월간(0/1)<br /> '; 현재 영어에서 제한횟수 관리가 되고 있지 않음. 추후 추가 필요
                cponListText += '		'+String(cponList[i].validStartDe).maskDate()+'~'+String(cponList[i].validExprDe).maskDate()+' ';
                cponListText += '	</td> ';
                cponListText += '	<td><input type="checkbox" title="" name="chkSCpon" idx="'+i+'" cponno="'+cponList[i].cmbndNo+'"/></td> '; //MSG 스토어권 사용
                cponListText += '</tr> ';
        
                //$('#layer_store_change .table-wrap > table > tbody').append(cponListText);
                $('#layer_store_change .table-wrap > .scroll > table > tbody').append(cponListText);
        
                setChkStoreEvent();
            }
        }
        
        
        //체크박스 이벤트
        function setChkStoreEvent() {
            $(":checkbox[name='chkSCpon']").off().on('click', function() {
        
                if (!$(this).prop('checked')) {
                    return;
                }
                var transNo    = $("#transNo").val();
                var cmbndNo    = storeChgList[$(this).attr('idx')].cmbndNo;
                var methodName = "scoupon";
                var paramData  = {transNo:transNo, cmbndNo:cmbndNo, methodName:methodName};
                var idx        = $(this).attr('idx');
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/applyAbleVcmdChk.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
        
                        //추후 order 변경 등 고려 foreach 로 처리
                        $(":checkbox[name='chkSCpon']").each(function() {
                            if ($(this).attr('idx') == idx) {
                                $(this).prop('checked', false);
                            }
                        });
                    }
                });
        
            });
        }
        
        
        //스토어교환권 적용
        function applyStoreChg() {
            var chkCnt = $(":checkbox[name='chkSCpon']:checked").length;
        
            if ( chkCnt == 0 ) {
                gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
                return;
            }
        
            var transNo     = $("#transNo").val();
            var playSchdlNo = $("#playSchdlNo").val();
            var paramCpon   = new Array();
        
            $(":checkbox[name='chkSCpon']:checked").each(function(idx) {
                storeChgList[$(this).attr('idx')].transNo = transNo;
                paramCpon.push(storeChgList[$(this).attr('idx')]);
            });
        
            var paramData = {transNo:transNo, cponList:paramCpon, playSchdlNo:playSchdlNo};
            $.ajax({
                url: "/on/oh/ohz/PayBooking/applyVcCmbnd.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //예매화면 할인내역 갱신
                    setMovieDcInfo(data.policyList);
        
                    $('#btn_cancel_scoupon').show(); //취소버튼
                    $('#btn_cancel_apply_scoupon').show(); //적용취소버튼
        
                    //닫기버튼 클릭
                    $('#layer_store_change .close-layer').click();
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        
        </script>
        
        <!-- 레이어 : 스토어교환권 -->
        <section id="layer_store_change" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
            <div class="wrap">
                <header class="layer-header">
                    <h3 class="tit">스토어교환권<!-- 스토어교환권 --></h3>
                </header>
        
                <div class="layer-con">
                    <div class="popup-gray v1 mt0">
                        <div class="pop-search-area">
                            <p class="sh-txt reset"><span class="label">교환권번호<!-- 교환권번호 --></span></p>
        
                            <div class="sh-input ml08"><input type="text" title="스토어교환권 번호입력" class="input-text w200px" id="scouponNo" name="scouponNo" maxlength="16"></div><!-- 스토어교환권 번호입력 -->
        
                            <div class="sh-btn gray">
                                <button type="button" class="button small gray" id="btn_reg_scoupon">교환권등록<!-- 교환권등록 --></button>
                            </div>
                        </div>
                    </div>
        
                    <div class="table-wrap divide mt15">
                        <table class="board-list line">
                            <caption>교환권 정보, 사용내역/유효기간, 사용 항목을 가진 스토어교환권 제목표<!-- 교환권 정보, 사용내역/유효기간, 사용 항목을 가진 스토어교환권 제목표 --></caption>
                            <colgroup>
                                <col style="width:220px;">
                                <col>
                                <col style="width:60px;">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th scope="col">교환권 정보<!-- 교환권 정보 --></th>
                                    <th scope="col">사용내역/유효기간<!-- 사용내역/유효기간 --></th>
                                    <th scope="col">사용<!-- 사용 --></th>
                                </tr>
                            </thead>
                        </table>
        
                        <!--
                            상황에 따라 스크롤 높이값이 달라지기 때문에 인라인으로 넣어줘야 함
                         -->
                        <div class="scroll" style="min-height:299px; max-height:299px;">
                            <table class="board-list line">
                                <caption>교환권 정보, 사용내역/유효기간, 사용 항목을 가진 스토어교환권 내용표<!-- 교환권 정보, 사용내역/유효기간, 사용 항목을 가진 스토어교환권 내용표 --></caption>
                                <colgroup>
                                    <col style="width:220px;">
                                    <col>
                                    <col style="width:60px;">
                                </colgroup>
                                <tbody>
                                    <!-- <tr>
                                        <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                        <td class="a-c">
                                            총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                            / 2019.03.25~2021.03.24<br />
                                            주말에만 사용 가능
                                        </td>
                                        <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                        <td class="a-c">
                                            총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                            / 2019.03.25~2021.03.24<br />
                                            주말에만 사용 가능
                                        </td>
                                        <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                        <td class="a-c">
                                            총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                            / 2019.03.25~2021.03.24<br />
                                            주말에만 사용 가능
                                        </td>
                                        <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                        <td class="a-c">
                                            총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                            / 2019.03.25~2021.03.24<br />
                                            주말에만 사용 가능
                                        </td>
                                        <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                        <td class="a-c">
                                            총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                            / 2019.03.25~2021.03.24<br />
                                            주말에만 사용 가능
                                        </td>
                                        <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                        <td class="a-c">
                                            총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                            / 2019.03.25~2021.03.24<br />
                                            주말에만 사용 가능
                                        </td>
                                        <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                        <td class="a-c">
                                            총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                            / 2019.03.25~2021.03.24<br />
                                            주말에만 사용 가능
                                        </td>
                                        <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                        <td class="a-c">
                                            총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                            / 2019.03.25~2021.03.24<br />
                                            주말에만 사용 가능
                                        </td>
                                        <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                        <td class="a-c">
                                            총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                            / 2019.03.25~2021.03.24<br />
                                            주말에만 사용 가능
                                        </td>
                                        <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">러브콤보패키지 러브콤보교환권</td>
                                        <td class="a-c">
                                            총(0/1) | 주간(0/1) | 월간(0/1)<br />
                                            / 2019.03.25~2021.03.24<br />
                                            주말에만 사용 가능
                                        </td>
                                        <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                    </tr> -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
        
                <div class="btn-group-fixed">
                    <button type="button" class="button small close-layer" id="btn_close_scoupon">닫기<!-- 닫기 --></button>
                    <button type="button" class="button small purple" id="btn_cancel_apply_scoupon" style="display:none;">적용취소<!-- 적용취소 --></button>
                    <button type="button" class="button small purple" id="btn_apply_scoupon">적용<!-- 적용 --></button>
                </div>
        
                <button type="button" class="btn-modal-close" id="btn_close_modal_scoupon">레이어 닫기<!-- 레이어 닫기 --></button>
            </div>
        </section>
        <!-- 레이어 : 스토어교환권 -->
        
            <!--// 레이어 : 스토어교환권 -->
        
            <!-- 레이어 : 기프티콘 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var giftConChgList = new Array();
        
        //초기화 공통 sMethodName.init
        function gfcon_init() {  //기프티콘 전체초기화
            setInitGiftCon();
            giftConChgList = new Array();
            $('#gfconCardNum').val('');
        }
        
        $(function() {
        
            //숫자만 입력가능
            $("#gfconCardNum").megaBoxNumberCheck();
        
            //조회버튼 클릭
            $('#btn_select_gfcon').on('click', function() {
                searchGiftCon();
            });
        
            //기프티콘 적용
            $('#btn_apply_gfcon').on('click', function() {
                applyGiftCon();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_gfcon').on('click', function() {
                var sMethodName = "gfcon";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                $('#layer_gifticon .close-layer').click();
            });
        
        
            //기프티콘 닫기
            $('#btn_close_gfcon, #btn_close_modal_gfcon').on('click', function() {
                $('#gfconCardNum').val('');
            });
        });
        
        
        //기프티콘 초기화
        function setInitGiftCon() {
            //$('#layer_gifticon .table-wrap > table > tbody> tr').remove();
            $('#layer_gifticon .table-wrap > .scroll > table > tbody> tr').remove();
        }
        
        //기프티콘 조회
        function searchGiftCon() {
            var transNo    = $("#transNo").val();
            var cardNo     = $("#gfconCardNum").val();
            var paramData  = {transNo:transNo, cardNo:cardNo};
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_gfcon').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo == "") {
                gfn_alertMsgBox('쿠폰 번호를 입력하세요.');
                return;
            }
        
            //기 조회여부 체크
            for(var i=0;i<giftConChgList.length;i++) {
                if (cardNo == giftConChgList[i].cardNo) {
                    gfn_alertMsgBox('이미 조회 되었습니다.');
                    return;
                }
            }
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/searchGiftCon.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //쿠폰 전역변수 세팅
                    var giftConList = data.giftConList;
                    for(var i=0;i<giftConList.length;i++){
                        var sameYn = false;
                        //이중조회 방지
                        for(var j=0;j<giftConChgList.length;j++){
                            if (giftConChgList[j].cardNo == giftConList[i].cardNo) {
                                sameYn = true;
                                break;
                            }
                        }
                        if (!sameYn) {
                            giftConChgList.push(giftConList[i]);
                        }
                    }
        
                    //쿠폰 목록 세팅
                    setGiftConChg(giftConChgList);
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }	  , beforeSend : function() {
                    $('#btn_select_gfcon').prop("disabled", true);
                    $('#btn_select_gfcon').addClass('disabled');
                  }
                  , complete : function() {
                    setTimeout(function(){
                           $('#btn_select_gfcon').removeClass('disabled');
                           $('#btn_select_gfcon').prop("disabled", false);
                    },1500);
                  }
            });
        }
        
        //기프티콘 쿠폰 목록 세팅
        function setGiftConChg(cponList) {
            setInitGiftCon();
            var cponListText = "";
            for(var i=0;i<cponList.length;i++) {
                cponListText =  '<tr> ';
                cponListText += '	<td class="a-l">'+cponList[i].cponName+'</td>  ';
                cponListText += '	<td>'+cponList[i].cardNo+'</td>  ';
                cponListText += '	<td><input type="checkbox" title="기프티콘 사용여부 체크" name="chkGiftConChg" idx="'+i+'"/></td>  '; //msg_기프티콘 사용여부 체크
                cponListText += '</tr>  ';
        
                //$('#layer_gifticon .table-wrap > table > tbody').append(cponListText);
                $('#layer_gifticon .table-wrap > .scroll > table > tbody').append(cponListText);
                $('#gfconCardNum').val('');
                setChkGiftConEvent();
            }
        }
        
        //체크박스 이벤트
        function setChkGiftConEvent() {
            $(":checkbox[name='chkGiftConChg']").off().on('click', function() {
        
                if (!$(this).prop('checked')) {
                    return;
                }
                var transNo    = $("#transNo").val();
                var cmbndNo    = giftConChgList[$(this).attr('idx')].cmbndNo;
                var idntfcNo   = giftConChgList[$(this).attr('idx')].cardNo;
                var methodName = "gfcon";
                var paramData  = {transNo:transNo, cmbndNo:cmbndNo, methodName:methodName, idntfcNo:idntfcNo};
                var idx        = $(this).attr('idx');
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/applyAbleVcmdChk.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
        
                        //추후 order 변경 등 고려 foreach 로 처리
                        $(":checkbox[name='chkGiftConChg']").each(function() {
                            if ($(this).attr('idx') == idx) {
                                $(this).prop('checked', false);
                            }
                        });
                    }
                });
        
            });
        }
        
        //기프티콘 쿠폰 적용
        function applyGiftCon() {
            var chkCnt = $(":checkbox[name='chkGiftConChg']:checked").length;
        
            if ( chkCnt == 0 ) {
                gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
                return;
            }
        
            var transNo   = $("#transNo").val();
            var paramCpon = new Array();
        
            $(":checkbox[name='chkGiftConChg']:checked").each(function(idx) {
                giftConChgList[$(this).attr('idx')].transNo = transNo;
                paramCpon.push(giftConChgList[$(this).attr('idx')]);
            });
        
            ////console.log(paramCpon);
        
            var paramData = {transNo:transNo, cponList:paramCpon};
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/applyGiftCon.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //할인내역 갱신
                    setMovieDcInfo(data.policyList);
        
                    $('#btn_cancel_gfcon').show(); //취소버튼
                    $('#btn_cancel_apply_gfcon').show(); //적용취소버튼
        
                    //닫기버튼 클릭
                    $('#layer_gifticon .close-layer').click();
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        </script>
        <!-- 레이어 : 기프티콘 -->
        <section id="layer_gifticon" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
            <div class="wrap">
                <header class="layer-header">
                    <h3 class="tit">기프티콘<!-- 기프티콘 --></h3>
                </header>
        
                <div class="layer-con">
                    <div class="popup-gray mid-info-box mt0">
                        <div class="pop-search-area">
                            <p class="sh-txt reset mr08"><span class="label">예매권번호<!-- 예매권번호 --></span></p>
        
                            <div class="sh-input"><input type="text" title="기프티콘 예매권 번호입력" class="input-text w200px" id="gfconCardNum" maxlength="20"></div> <!-- 기프티콘 예매권 번호입력 -->
        
                            <div class="sh-btn gray">
                                <button type="button" class="button small gray" id="btn_select_gfcon">조회<!-- 조회 --></button>
                            </div>
                        </div>
                    </div>
        
                    <div class="table-wrap divide">
                        <table class="board-list line">
                            <caption>기프티콘 예매권 명, 예매권번호, 사용여부 항목을 가진 기프티콘 목록의 제목 표<!-- 기프티콘 예매권 명, 예매권번호, 사용여부 항목을 가진 기프티콘 목록의 제목 표 --></caption>
                            <colgroup>
                                <col>
                                <col style="width:150px;">
                                <col style="width:60px;">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th scope="col">예매권 명<!-- 예매권 명 --></th>
                                    <th scope="col">예매권번호<!-- 예매권번호 --></th>
                                    <th scope="col">사용<!-- 사용 --></th>
                                </tr>
                            </thead>
                        </table>
        
                        <!--
                            상황에 따라 스크롤 높이값이 달라지기 때문에 인라인으로 넣어줘야 함
                         -->
                        <div class="scroll" style="min-height:281px; max-height:281px;">
                            <table class="board-list line">
                                <caption>예매권 명, 예매권번호, 사용여부 항목을 가진 기프티콘 목록의 내용 표<!-- 예매권 명, 예매권번호, 사용여부 항목을 가진 기프티콘 목록의 내용 표 --></caption>
                                <colgroup>
                                    <col>
                                    <col style="width:150px;">
                                    <col style="width:60px;">
                                </colgroup>
                                <tbody>
                                    <!-- <tr>
                                        <td class="a-l">아이넘버 1인권</td>
                                        <td>123456789012</td>
                                        <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">글자글자글자 글자글자글자</td>
                                        <td>123456789012</td>
                                        <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">아이넘버 1인권</td>
                                        <td>123456789012</td>
                                        <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">글자글자글자 글자글자글자</td>
                                        <td>123456789012</td>
                                        <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">아이넘버 1인권</td>
                                        <td>123456789012</td>
                                        <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">글자글자글자 글자글자글자</td>
                                        <td>123456789012</td>
                                        <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">아이넘버 1인권</td>
                                        <td>123456789012</td>
                                        <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l">글자글자글자 글자글자글자</td>
                                        <td>123456789012</td>
                                        <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                    </tr> -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
        
                <div class="btn-group-fixed">
                    <button type="button" class="button small close-layer" id="btn_close_gfcon">닫기<!-- 닫기 --></button>
                    <button type="button" class="button small purple" id="btn_cancel_apply_gfcon" style="display:none;">적용취소<!-- 적용취소 --></button>
                    <button type="button" class="button small purple" id="btn_apply_gfcon">적용<!-- 적용 --></button>
                </div>
        
                <button type="button" class="btn-modal-close" id="btn_close_modal_gfcon">레이어 닫기<!-- 레이어 닫기 --></button>
            </div>
        </section>
        <!--// 레이어 : 기프티콘 -->
        
            <!--// 레이어 : 기프티콘 -->
        
            <!-- 레이어 : 기프티쇼 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var giftShowChgList = new Array();
        
        //초기화 공통 sMethodName.init
        function gfshow_init() {  //기프티쇼 전체초기화
            setInitGiftShow();
            giftShowChgList = new Array();
            $('#gfshowCardNum').val('');
        }
        
        $(function() {
        
            //숫자만 입력가능
            $("#gfshowCardNum").megaBoxNumberCheck();
        
            //조회버튼 클릭
            $('#btn_select_gfshow').on('click', function() {
                searchGiftShow();
            });
        
            //기프티쇼 적용
            $('#btn_apply_gfshow').on('click', function() {
                applyGiftShow();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_gfshow').on('click', function() {
                var sMethodName = "gfshow";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                $('#layer_giftishow .close-layer').click();
            });
        
            //기프티쇼 닫기
            $('#btn_close_gfshow, #btn_close_modal_gfshow').on('click', function() {
                $('#gfshowCardNum').val('');
            });
        
        });
        
        
        //기프티쇼 초기화
        function setInitGiftShow() {
            //$('#layer_giftishow .table-wrap > table > tbody> tr').remove();
            $('#layer_giftishow .table-wrap > .scroll > table > tbody> tr').remove();
        }
        
        //기프티쇼 조회
        function searchGiftShow() {
            var transNo    = $("#transNo").val();
            var cardNo     = $("#gfshowCardNum").val();
            var paramData  = {transNo:transNo, cardNo:cardNo};
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_gfshow').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo == "") {
                gfn_alertMsgBox('쿠폰 번호를 입력하세요.');
                return;
            }
        
            //기 조회여부 체크
            for(var i=0;i<giftShowChgList.length;i++) {
                if (cardNo == giftShowChgList[i].cardNo) {
                    gfn_alertMsgBox('이미 조회 되었습니다.');
                    return;
                }
            }
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/searchGiftShow.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //쿠폰 전역변수 세팅
                    var giftShowList = data.giftShowList;
                    //기프티쇼 list 적용
                    for(var i=0;i<giftShowList.length;i++){
                        var sameYn = false;
                        //이중조회 방지
                        for(var j=0;j<giftShowChgList.length;j++){
                            if (giftShowChgList[j].cardNo == giftShowList[i].cardNo) {
                                sameYn = true;
                                break;
                            }
                        }
                        if (!sameYn) {
                            giftShowChgList.push(giftShowList[i]);
                        }
                    }
        
                    //쿠폰 목록 세팅
                    setGiftShowChg(giftShowChgList);
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
                , beforeSend : function() {
                    $('#btn_select_gfshow').prop("disabled", true);
                    $('#btn_select_gfshow').addClass('disabled');
                }
                , complete : function() {
                    setTimeout(function(){
                           $('#btn_select_gfshow').removeClass('disabled');
                           $('#btn_select_gfshow').prop("disabled", false);
                    },1500);
                }
            });
        }
        
        //기프티쇼 쿠폰 목록 세팅
        function setGiftShowChg(cponList) {
            setInitGiftShow();
            var cponListText = "";
            for(var i=0;i<cponList.length;i++) {
                cponListText =  '<tr> ';
                cponListText += '	<td class="a-l">'+cponList[i].cponName+'</td>  ';
                cponListText += '	<td>'+cponList[i].cardNo+'</td>  ';
                cponListText += '	<td><input type="checkbox" title="기프티쇼 사용여부 체크" name="chkGiftShowChg" idx="'+i+'"/></td>  '; // msg_기프티쇼 사용여부 체크
                cponListText += '</tr>  ';
        
                //$('#layer_giftishow .table-wrap > table > tbody').append(cponListText);
                $('#layer_giftishow .table-wrap > .scroll > table > tbody').append(cponListText);
                $("#gfshowCardNum").val('');
                setChkGiftShowEvent();
            }
        }
        
        //체크박스 이벤트
        function setChkGiftShowEvent() {
            $(":checkbox[name='chkGiftShowChg']").off().on('click', function() {
        
                if (!$(this).prop('checked')) {
                    return;
                }
                var transNo    = $("#transNo").val();
                var cmbndNo    = giftShowChgList[$(this).attr('idx')].cmbndNo;
                var idntfcNo   = giftShowChgList[$(this).attr('idx')].cardNo;
                var methodName = "gfshow";
                var paramData  = {transNo:transNo, cmbndNo:cmbndNo, methodName:methodName, idntfcNo:idntfcNo};
                var idx        = $(this).attr('idx');
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/applyAbleVcmdChk.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
        
                        //추후 order 변경 등 고려 foreach 로 처리
                        $(":checkbox[name='chkGiftShowChg']").each(function() {
                            if ($(this).attr('idx') == idx) {
                                $(this).prop('checked', false);
                            }
                        });
                    }
                });
        
            });
        }
        
        
        //기프티쇼 쿠폰 적용
        function applyGiftShow() {
            var chkCnt = $(":checkbox[name='chkGiftShowChg']:checked").length;
        
            if ( chkCnt == 0 ) {
                gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
                return;
            }
        
            var transNo   = $("#transNo").val();
            var paramCpon = new Array();
        
            $(":checkbox[name='chkGiftShowChg']:checked").each(function(idx) {
                giftShowChgList[$(this).attr('idx')].transNo = transNo;
                paramCpon.push(giftShowChgList[$(this).attr('idx')]);
            });
        
            ////console.log(paramCpon);
        
            var paramData = {transNo:transNo, cponList:paramCpon};
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/applyGiftShow.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //할인내역 갱신
                    setMovieDcInfo(data.policyList);
        
                    $('#btn_cancel_gfshow').show(); //취소버튼
                    $('#btn_cancel_apply_gfshow').show(); //적용취소버튼
        
                    //닫기버튼 클릭
                    $('#layer_giftishow .close-layer').click();
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        </script>
            <!-- 레이어 : 기프티쇼 -->
            <section id="layer_giftishow" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">기프티쇼<!-- 기프티쇼 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="popup-gray mid-info-box mt0">
                            <div class="pop-search-area">
                                <p class="sh-txt reset mr08"><span class="label">예매권번호<!-- 예매권번호 --></span></p>
        
                                <div class="sh-input"><input type="text" title="기프티쇼 예매권 번호입력" class="input-text w200px" id="gfshowCardNum" maxlength=""></div> <!-- 기프티쇼 예매권 번호입력 -->
        
                                <div class="sh-btn gray">
                                    <button type="button" class="button small gray" id="btn_select_gfshow">조회<!-- 조회 --></button>
                                </div>
                            </div>
                        </div>
        
                        <div class="table-wrap divide">
                            <table class="board-list line">
                                <caption>기프티쇼 예매권 명, 예매권번호, 사용여부 항목을 가진 기프티쇼 목록의 제목 표<!-- 기프티쇼 예매권 명, 예매권번호, 사용여부 항목을 가진 기프티쇼 목록의 제목 표 --></caption>
                                <colgroup>
                                    <col>
                                    <col style="width:150px;">
                                    <col style="width:60px;">
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th scope="col">예매권 명<!-- 예매권 명 --></th>
                                        <th scope="col">예매권번호<!-- 예매권번호 --></th>
                                        <th scope="col">사용<!-- 사용 --></th>
                                    </tr>
                                </thead>
                            </table>
        
                            <div class="scroll" style="min-height:281px; max-height:281px;">
                                <table class="board-list line">
                                    <caption>예매권 명, 예매권번호, 사용여부 항목을 가진 기프티쇼 목록의 내용 표<!-- 예매권 명, 예매권번호, 사용여부 항목을 가진 기프티쇼 목록의 내용 표 --></caption>
                                    <colgroup>
                                        <col>
                                        <col style="width:150px;">
                                        <col style="width:60px;">
                                    </colgroup>
                                    <tbody>
                                        <!-- <tr>
                                            <td class="a-l">아이넘버 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">아이넘버 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">아이넘버 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">아이넘버 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr> -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer" id="btn_close_gfshow">닫기<!-- 닫기 --></button>
                        <button type="button" class="button small purple" id="btn_cancel_apply_gfshow" style="display:none;">적용취소<!-- 적용취소 --></button>
                        <button type="button" class="button small purple" id="btn_apply_gfshow">적용<!-- 적용 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close" id="btn_close_modal_gfshow">레이어 닫기<!-- 레이어 닫기 --></button>
                </div>
            </section>
            <!--// 레이어 : 기프티쇼 -->
            <!--// 레이어 : 기프티쇼 -->
        
            <!-- 레이어 : G마켓 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var gmarketChgList = new Array();
        
        //초기화 공통 sMethodName.init
        function gmarket_init() {  //스마트콘 전체초기화
            setInitGmarket();
            gmarketChgList = new Array();
            $('#gmarketCardNum').val('');
        }
        
        $(function() {
        
            //숫자만 gmarketCardNum
            $("#gmarketCardNum").megaBoxNumberCheck();
        
            //조회버튼 클릭
            $('#btn_select_gmarket').on('click', function() {
                searchGmarket();
            });
        
            //G마켓 적용
            $('#btn_apply_gmarket').on('click', function() {
                applyGmarket();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_gmarket').on('click', function() {
                var sMethodName = "gmarket";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                $('#layer_gmarket .close-layer').click();
            });
        
            //G마켓 닫기
            $('#btn_close_gmarket, #btn_close_modal_gmarket').on('click', function() {
                $('#gmarketCardNum').val('');
            });
        });
        
        
        //G마켓 초기화
        function setInitGmarket() {
            //$('#layer_gmarket .table-wrap > table > tbody> tr').remove();
            $('#layer_gmarket .table-wrap > .scroll > table > tbody> tr').remove();
        }
        
        //G마켓 조회
        function searchGmarket() {
            var transNo    = $("#transNo").val();
            var cardNo     = $("#gmarketCardNum").val();
            var paramData  = {transNo:transNo, cardNo:cardNo};
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_gmarket').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo == "") {
                gfn_alertMsgBox('쿠폰 번호를 입력하세요.');
                return;
            }
        
            //기 조회여부 체크
            for(var i=0;i<gmarketChgList.length;i++) {
                if (cardNo == gmarketChgList[i].cardNo) {
                    gfn_alertMsgBox('이미 조회 되었습니다.');
                    return;
                }
            }
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/searchGmarket.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //쿠폰 전역변수 세팅
                    var gmarketList = data.gmarketList;
                    //기프티쇼 list 적용
                    for(var i=0;i<gmarketList.length;i++){
                        var sameYn = false;
                        //이중조회 방지
                        for(var j=0;j<gmarketChgList.length;j++){
                            if (gmarketChgList[j].cardNo == gmarketList[i].cardNo) {
                                sameYn = true;
                                break;
                            }
                        }
                        if (!sameYn) {
                            gmarketChgList.push(gmarketList[i]);
                        }
                    }
        
                    //쿠폰 목록 세팅
                    setGmarketChg(gmarketChgList);
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
                , beforeSend : function() {
                    $('#btn_select_gmarket').prop("disabled", true);
                    $('#btn_select_gmarket').addClass('disabled');
                }
                , complete : function() {
                    setTimeout(function(){
                           $('#btn_select_gmarket').removeClass('disabled');
                           $('#btn_select_gmarket').prop("disabled", false);
                    },1500);
                }
            });
        }
        
        //스마트콘 쿠폰 목록 세팅
        function setGmarketChg(cponList) {
            setInitGmarket();
            var cponListText = "";
            for(var i=0;i<cponList.length;i++) {
                cponListText =  '<tr> ';
                cponListText += '	<td class="a-l">'+cponList[i].cponName+'</td>  ';
                cponListText += '	<td>'+cponList[i].cardNo+'</td>  ';
                cponListText += '	<td><input type="checkbox" title="G마켓 사용여부 체크" name="chkGmarketChg" idx="'+i+'"/></td>  '; //G마켓 사용여부 체크
                cponListText += '</tr>  ';
        
                //$('#layer_gmarket .table-wrap > table > tbody').append(cponListText);
                $('#layer_gmarket .table-wrap > .scroll > table > tbody').append(cponListText);
                $("#gmarketCardNum").val('');
                setChkGiftShowEvent();
            }
        }
        
        //체크박스 이벤트
        function setChkGiftShowEvent() {
            $(":checkbox[name='chkGmarketChg']").off().on('click', function() {
        
                if (!$(this).prop('checked')) {
                    return;
                }
                var transNo    = $("#transNo").val();
                var cmbndNo    = gmarketChgList[$(this).attr('idx')].cmbndNo;
                var idntfcNo   = gmarketChgList[$(this).attr('idx')].cardNo;
                var methodName = "gmarket";
                var paramData  = {transNo:transNo, cmbndNo:cmbndNo, methodName:methodName, idntfcNo:idntfcNo};
                var idx        = $(this).attr('idx');
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/applyAbleVcmdChk.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
        
                        //추후 order 변경 등 고려 foreach 로 처리
                        $(":checkbox[name='chkGmarketChg']").each(function() {
                            if ($(this).attr('idx') == idx) {
                                $(this).prop('checked', false);
                            }
                        });
                    }
                });
        
            });
        }
        
        //스마트콘 쿠폰 적용
        function applyGmarket() {
            var chkCnt = $(":checkbox[name='chkGmarketChg']:checked").length;
        
            if ( chkCnt == 0 ) {
                gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
                return;
            }
        
            var transNo   = $("#transNo").val();
            var paramCpon = new Array();
        
            $(":checkbox[name='chkGmarketChg']:checked").each(function(idx) {
                gmarketChgList[$(this).attr('idx')].transNo = transNo;
                paramCpon.push(gmarketChgList[$(this).attr('idx')]);
            });
        
            ////console.log(paramCpon);
        
            var paramData = {transNo:transNo, cponList:paramCpon};
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/applyGmarket.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //할인내역 갱신
                    setMovieDcInfo(data.policyList);
        
                    $('#btn_cancel_gmarket').show(); //취소버튼
                    $('#btn_cancel_apply_gmarket').show(); //적용취소버튼
        
                    //닫기버튼 클릭
                    $('#layer_gmarket .close-layer').click();
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        </script>
            <!-- 레이어 : G마켓 -->
            <section id="layer_gmarket" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">G마켓예매권<!-- G마켓예매권 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="popup-gray mid-info-box mt0">
                            <div class="pop-search-area">
                                <p class="sh-txt reset mr08"><span class="label">예매권번호<!-- 예매권번호 --></span></p>
        
                                <div class="sh-input"><input type="text" title="G마켓 예매권 번호입력" class="input-text w200px" id="gmarketCardNum" maxlength="20"></div> <!-- G마켓 예매권 번호입력 -->
        
                                <div class="sh-btn gray">
                                    <button type="button" class="button small gray" id="btn_select_gmarket">조회<!-- 조회 --></button>
                                </div>
                            </div>
                        </div>
        
                        <div class="table-wrap divide">
                            <table class="board-list line">
                                <caption>G마켓 예매권 명, 예매권번호, 사용여부 항목을 가진 G마켓 예매권 목록의 제목 표<!-- G마켓 예매권 명, 예매권번호, 사용여부 항목을 가진 G마켓 예매권 목록의 제목 표 --></caption>
                                <colgroup>
                                    <col>
                                    <col style="width:150px;">
                                    <col style="width:60px;">
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th scope="col">예매권 명<!-- 예매권 명 --></th>
                                        <th scope="col">예매권번호<!-- 예매권번호 --></th>
                                        <th scope="col">사용<!-- 사용 --></th>
                                    </tr>
                                </thead>
                            </table>
        
                            <div class="scroll" style="min-height:281px; max-height:281px;">
                                <table class="board-list line">
                                    <caption>G마켓 예매권 명, 예매권번호, 사용여부 항목을 가진 G마켓 예매권 목록의 내용 표<!-- G마켓 예매권 명, 예매권번호, 사용여부 항목을 가진 G마켓 예매권 목록의 내용 표 --></caption>
                                    <colgroup>
                                        <col>
                                        <col style="width:150px;">
                                        <col style="width:60px;">
                                    </colgroup>
                                    <tbody>
                                        <!-- <tr>
                                            <td class="a-l">아이넘버 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">아이넘버 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">아이넘버 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">아이넘버 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">아이넘버 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr> -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer" id="btn_close_gmarket">닫기<!-- 닫기 --></button>
                        <button type="button" class="button small purple" id="btn_cancel_apply_gmarket" style="display:none;">적용취소<!-- 적용취소 --></button>
                        <button type="button" class="button small purple" id="btn_apply_gmarket">적용<!-- 적용 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close" id="btn_close_modal_gmarket">레이어 닫기<!-- 레이어 닫기 --></button>
                </div>
            </section>
            <!--// 레이어 : G마켓 -->
            <!--// 레이어 : G마켓 -->
        
            <!-- 레이어 : 아이넘버 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var iNumberChgList = new Array();
        
        //초기화 공통 sMethodName.init
        function inumber_init() {  //아이넘버 전체초기화
            setInitINumber();
            iNumberChgList = new Array();
            $('#inumberCardNum').val('');
        }
        
        $(function() {
        
            //숫자만 입력가능
            $("#inumberCardNum").megaBoxNumberCheck();
        
            //조회버튼 클릭
            $('#btn_select_inumber').on('click', function() {
                searchINumber();
            });
        
            //아이넘버 적용
            $('#btn_apply_inumber').on('click', function() {
                applyINumber();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_inumber').on('click', function() {
                var sMethodName = "inumber";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                $('#layer_inumber .close-layer').click();
            });
        
            //아이넘버 닫기
            $('#btn_close_inumber, #btn_close_modal_inumber').on('click', function() {
                $('#inumberCardNum').val('');
            });
        
        });
        
        
        //아이넘버 초기화
        function setInitINumber() {
            //$('#layer_inumber .table-wrap > table > tbody> tr').remove();
            $('#layer_inumber .table-wrap > .scroll > table  > tbody> tr').remove();
        }
        
        //아이넘버 조회
        function searchINumber() {
            var transNo    = $("#transNo").val();
            var cardNo     = $("#inumberCardNum").val();
            var paramData  = {transNo:transNo, cardNo:cardNo};
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_inumber').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo == "") {
                gfn_alertMsgBox('쿠폰 번호를 입력하세요.');
                return;
            }
        
            //기 조회여부 체크
            for(var i=0;i<iNumberChgList.length;i++) {
                if (cardNo == iNumberChgList[i].cardNo) {
                    gfn_alertMsgBox('이미 조회 되었습니다.');
                    return;
                }
            }
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/searchInumber.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //쿠폰 전역변수 세팅
                    var iNumberList = data.iNumberList;
                    //기프티쇼 list 적용
                    for(var i=0;i<iNumberList.length;i++){
                        var sameYn = false;
                        //이중조회 방지
                        for(var j=0;j<iNumberChgList.length;j++){
                            if (iNumberChgList[j].cardNo == iNumberList[i].cardNo) {
                                sameYn = true;
                                break;
                            }
                        }
                        if (!sameYn) {
                            iNumberChgList.push(iNumberList[i]);
                        }
                    }
        
                    //쿠폰 목록 세팅
                    setINumberChg(iNumberChgList);
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
                , beforeSend : function() {
                    $('#btn_select_inumber').prop("disabled", true);
                    $('#btn_select_inumber').addClass('disabled');
                }
                , complete : function() {
                    setTimeout(function(){
                           $('#btn_select_inumber').removeClass('disabled');
                           $('#btn_select_inumber').prop("disabled", false);
                    },1500);
                }
            });
        }
        
        //아이넘버 쿠폰 목록 세팅
        function setINumberChg(cponList) {
            setInitINumber();
            var cponListText = "";
            for(var i=0;i<cponList.length;i++) {
                cponListText =  '<tr> ';
                cponListText += '	<td class="a-l">'+cponList[i].cponName+'</td>  ';
                cponListText += '	<td>'+cponList[i].cardNo+'</td>  ';
                cponListText += '	<td><input type="checkbox" title="아이넘버 사용여부 체크" name="chkINumberChg" idx="'+i+'"/></td>  '; //msg_아이넘버 사용여부 체크
                cponListText += '</tr>  ';
        
                //$('#layer_inumber .table-wrap > table > tbody').append(cponListText);
                $('#layer_inumber .table-wrap > .scroll > table > tbody').append(cponListText);
                $('#inumberCardNum').val('');
                setChkINumberEvent();
            }
        }
        
        //체크박스 이벤트
        function setChkINumberEvent() {
            $(":checkbox[name='chkINumberChg']").off().on('click', function() {
        
                if (!$(this).prop('checked')) {
                    return;
                }
                var transNo    = $("#transNo").val();
                var cmbndNo    = iNumberChgList[$(this).attr('idx')].cmbndNo;
                var idntfcNo   = iNumberChgList[$(this).attr('idx')].cardNo;
                var methodName = "inumber";
                var paramData  = {transNo:transNo, cmbndNo:cmbndNo, methodName:methodName, idntfcNo:idntfcNo};
                var idx        = $(this).attr('idx');
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/applyAbleVcmdChk.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
        
                        //추후 order 변경 등 고려 foreach 로 처리
                        $(":checkbox[name='chkINumberChg']").each(function() {
                            if ($(this).attr('idx') == idx) {
                                $(this).prop('checked', false);
                            }
                        });
                    }
                });
        
            });
        }
        
        //아이넘버 쿠폰 적용
        function applyINumber() {
            var chkCnt = $(":checkbox[name='chkINumberChg']:checked").length;
        
            if ( chkCnt == 0 ) {
                gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
                return;
            }
        
            var transNo   = $("#transNo").val();
            var paramCpon = new Array();
        
            $(":checkbox[name='chkINumberChg']:checked").each(function(idx) {
                iNumberChgList[$(this).attr('idx')].transNo = transNo;
                paramCpon.push(iNumberChgList[$(this).attr('idx')]);
            });
        
            ////console.log(paramCpon);
        
            var paramData = {transNo:transNo, cponList:paramCpon};
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/applyInumber.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //할인내역 갱신
                    setMovieDcInfo(data.policyList);
        
                    $('#btn_cancel_inumber').show(); //취소버튼
                    $('#btn_cancel_apply_inumber').show(); //적용취소버튼
        
                    //닫기버튼 클릭
                    $('#layer_inumber .close-layer').click();
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        </script>
            <!-- 레이어 : 아이넘버 -->
            <section id="layer_inumber" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">아이넘버<!-- 아이넘버 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="popup-gray mid-info-box mt0">
                            <div class="pop-search-area">
                                <p class="sh-txt reset mr08"><span class="label">예매권번호<!-- 예매권번호 --></span></p>
        
                                <div class="sh-input"><input type="text" title="아이넘버 예매권 번호입력" class="input-text w200px" id="inumberCardNum" maxlength="20"></div> <!-- 아이넘버 예매권 번호입력 -->
        
                                <div class="sh-btn gray">
                                    <button type="button" class="button small gray" id="btn_select_inumber">조회<!-- 조회 --></button>
                                </div>
                            </div>
                        </div>
        
                        <div class="table-wrap">
                            <table class="board-list line">
                                <caption>아이넘버 예매권 명, 예매권번호, 사용여부 항목을 가진 아이넘버 예매권 목록의 제목 표<!-- 아이넘버 예매권 명, 예매권번호, 사용여부 항목을 가진 아이넘버 예매권 목록의 제목 표 --></caption>
                                <colgroup>
                                    <col>
                                    <col style="width:150px;">
                                    <col style="width:60px;">
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th scope="col">예매권 명<!-- 예매권 명 --></th>
                                        <th scope="col">예매권번호<!-- 예매권번호 --></th>
                                        <th scope="col">사용<!-- 사용 --></th>
                                    </tr>
                                </thead>
                            </table>
        
                            <div class="scroll" style="max-height:281px;">
                                <table class="board-list line">
                                    <caption>아이넘버 예매권 명, 예매권번호, 사용여부 항목을 가진 아이넘버 예매권 목록의 내용 표<!-- 아이넘버 예매권 명, 예매권번호, 사용여부 항목을 가진 아이넘버 예매권 목록의 내용 표 --></caption>
                                    <colgroup>
                                        <col>
                                        <col style="width:150px;">
                                        <col style="width:60px;">
                                    </colgroup>
                                    <tbody>
                                        <!-- <tr>
                                            <td class="a-l">아이넘버 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">아이넘버 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">아이넘버 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">아이넘버 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="아이넘버 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr> -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer" id="btn_close_inumber">닫기<!-- 닫기 --></button>
                        <button type="button" class="button small purple" id="btn_cancel_apply_inumber" style="display:none;">적용취소<!-- 적용취소 --></button>
                        <button type="button" class="button small purple" id="btn_apply_inumber">적용<!-- 적용 --></button>
                    </div>
                    <button type="button" class="btn-modal-close" id="btn_close_modal_inumber">레이어 닫기<!-- 레이어 닫기 --></button>
                </div>
            </section>
            <!-- // 레이어 : 아이넘버 -->
        
            <!-- // 레이어 : 아이넘버 -->
        
            <!-- 레이어 : 도넛북 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var donutChgList = new Array();
        
        //초기화 공통 sMethodName.init
        function donut_init() {  //도넛북 전체초기화
            setInitDonut();
            donutChgList = new Array();
            $('#donutCardNum').val('');
        }
        
        $(function() {
        
            //숫자만 입력가능
            $("#donutCardNum").megaBoxNumberCheck();
        
            //조회버튼 클릭
            $('#btn_select_donut').on('click', function() {
                searchDonut();
            });
        
            //도넛북 적용
            $('#btn_apply_donut').on('click', function() {
                applyDonut();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_donut').on('click', function() {
                var sMethodName = "donut";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                $('#layer_donutbook .close-layer').click();
            });
        
            //도넛북 닫기
            $('#btn_close_donut, #btn_close_modal_donut').on('click', function() {
                $('#donutCardNum').val('');
            });
        
        });
        
        
        //도넛북 초기화
        function setInitDonut() {
            //$('#layer_donutbook .table-wrap > table > tbody> tr').remove();
            $('#layer_donutbook .table-wrap > .scroll > table > tbody> tr').remove();
        }
        
        //도넛북 조회
        function searchDonut() {
            var transNo    = $("#transNo").val();
            var cardNo     = $("#donutCardNum").val();
            var paramData  = {transNo:transNo, cardNo:cardNo};
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_donut').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo == "") {
                gfn_alertMsgBox('쿠폰 번호를 입력하세요.');
                return;
            }
        
            //기 조회여부 체크
            for(var i=0;i<donutChgList.length;i++) {
                if (cardNo == donutChgList[i].cardNo) {
                    gfn_alertMsgBox('이미 조회 되었습니다.');
                    return;
                }
            }
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/searchDounutBook.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //쿠폰 전역변수 세팅
                    var donutBookList = data.donutBookList;
                    //기프티쇼 list 적용
                    for(var i=0;i<donutBookList.length;i++){
                        var sameYn = false;
                        //이중조회 방지
                        for(var j=0;j<donutChgList.length;j++){
                            if (donutChgList[j].cardNo == donutBookList[i].cardNo) {
                                sameYn = true;
                                break;
                            }
                        }
                        if (!sameYn) {
                            donutChgList.push(donutBookList[i]);
                        }
                    }
        
                    //쿠폰 목록 세팅
                    setDonutChg(donutChgList);
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
                , beforeSend : function() {
                    $('#btn_select_donut').prop("disabled", true);
                    $('#btn_select_donut').addClass('disabled');
                }
                , complete : function() {
                    setTimeout(function(){
                           $('#btn_select_donut').removeClass('disabled');
                           $('#btn_select_donut').prop("disabled", false);
                    },1500);
                }
            });
        }
        
        //도넛북 쿠폰 목록 세팅
        function setDonutChg(cponList) {
            setInitDonut();
            var cponListText = "";
            for(var i=0;i<cponList.length;i++) {
                cponListText =  '<tr> ';
                cponListText += '	<td class="a-l">'+cponList[i].cponName+'</td>  ';
                cponListText += '	<td>'+cponList[i].cardNo+'</td>  ';
                cponListText += '	<td><input type="checkbox" title="도넛북 사용여부 체크" name="chkDonutChg" idx="'+i+'"/></td>  '; //msg_도넛북 사용여부 체크
                cponListText += '</tr>  ';
        
                //$('#layer_donutbook .table-wrap > table > tbody').append(cponListText);
                $('#layer_donutbook .table-wrap > .scroll > table > tbody').append(cponListText);
                $('#donutCardNum').val('');
        
                setChkDonutEvent();
            }
        }
        
        //체크박스 이벤트
        function setChkDonutEvent() {
            $(":checkbox[name='chkDonutChg']").off().on('click', function() {
        
                if (!$(this).prop('checked')) {
                    return;
                }
                var transNo    = $("#transNo").val();
                var cmbndNo    = donutChgList[$(this).attr('idx')].cmbndNo;
                var idntfcNo   = donutChgList[$(this).attr('idx')].cardNo;
                var methodName = "donut";
                var paramData  = {transNo:transNo, cmbndNo:cmbndNo, methodName:methodName, idntfcNo:idntfcNo};
                var idx        = $(this).attr('idx');
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/applyAbleVcmdChk.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
        
                        //추후 order 변경 등 고려 foreach 로 처리
                        $(":checkbox[name='chkDonutChg']").each(function() {
                            if ($(this).attr('idx') == idx) {
                                $(this).prop('checked', false);
                            }
                        });
                    }
                });
        
            });
        }
        
        //도넛북 쿠폰 적용
        function applyDonut() {
            var chkCnt = $(":checkbox[name='chkDonutChg']:checked").length;
        
            if ( chkCnt == 0 ) {
                gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
                return;
            }
        
            var transNo   = $("#transNo").val();
            var paramCpon = new Array();
        
            $(":checkbox[name='chkDonutChg']:checked").each(function(idx) {
                donutChgList[$(this).attr('idx')].transNo = transNo;
                paramCpon.push(donutChgList[$(this).attr('idx')]);
            });
        
            ////console.log(paramCpon);
        
            var paramData = {transNo:transNo, cponList:paramCpon};
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/applyDounutBook.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //할인내역 갱신
                    setMovieDcInfo(data.policyList);
        
                    $('#btn_cancel_donut').show(); //취소버튼
                    $('#btn_cancel_apply_donut').show(); //적용취소버튼
        
                    //닫기버튼 클릭
                    $('#layer_donutbook .close-layer').click();
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        </script>
            <!-- 레이어 : 도넛북 -->
            <section id="layer_donutbook" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">도넛북<!-- 도넛북 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="popup-gray mid-info-box mt0">
                            <div class="pop-search-area">
                                <p class="sh-txt reset mr08"><span class="label">예매권번호<!-- 예매권번호 --></span></p>
        
                                <div class="sh-input"><input type="text" title="도넛북 예매권 번호입력" class="input-text w200px" id="donutCardNum" maxlength="20"></div> <!-- 도넛북 예매권 번호입력 -->
        
                                <div class="sh-btn gray">
                                    <button type="button" class="button small gray" id="btn_select_donut">조회<!-- 조회 --></button>
                                </div>
                            </div>
                        </div>
        
                        <div class="table-wrap divide">
                            <table class="board-list line">
                                <caption>예매권 명, 예매권번호, 사용 항목을 가진 도넛북 예매권 목록의 제목 표<!-- 예매권 명, 예매권번호, 사용 항목을 가진 도넛북 예매권 목록의 제목 표 --></caption>
                                <colgroup>
                                    <col>
                                    <col style="width:150px;">
                                    <col style="width:60px;">
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th scope="col">예매권 명<!-- 예매권 명 --></th>
                                        <th scope="col">예매권번호<!-- 예매권번호 --></th>
                                        <th scope="col">사용<!-- 사용 --></th>
                                    </tr>
                                </thead>
                            </table>
        
                            <div class="scroll" style="min-height:281px; max-height:281px;">
                                <table class="board-list line">
                                    <caption>예매권 명, 예매권번호, 사용 항목을 가진 도넛북 예매권 목록의 내용 표<!-- 예매권 명, 예매권번호, 사용 항목을 가진 도넛북 예매권 목록의 내용 표 --></caption>
                                    <colgroup>
                                        <col>
                                        <col style="width:150px;">
                                        <col style="width:60px;">
                                    </colgroup>
                                    <tbody>
                                        <!-- <tr>
                                            <td class="a-l">도넛북 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="도넛북 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">도넛북 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="도넛북 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">도넛북 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="도넛북 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">도넛북 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="도넛북 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr> -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
        
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer" id="btn_close_donut">닫기<!-- 닫기 --></button>
                        <button type="button" class="button small purple" id="btn_cancel_apply_donut" style="display:none;">적용취소<!-- 적용취소 --></button>
                        <button type="button" class="button small purple" id="btn_apply_donut">적용<!-- 적용 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close" id="btn_close_modal_donut">레이어 닫기<!-- 레이어 닫기 --></button>
                </div>
            </section>
            <!-- // 레이어 : 도넛북 -->
            <!-- // 레이어 : 도넛북 -->
        
            <!-- 레이어 : 스마트콘 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var smConChgList = new Array();
        
        //초기화 공통 sMethodName.init
        function smcon_init() {  //스마트콘 전체초기화
            setInitSmCon();
            smConChgList = new Array();
            $('#smConCardNum').val('');
        }
        
        $(function() {
        
            //숫자만 입력가능
            $("#smConCardNum").megaBoxNumberCheck();
        
            //조회버튼 클릭
            $('#btn_select_smcon').on('click', function() {
                searchSmCon();
            });
        
            //스마트콘 적용
            $('#btn_apply_smcon').on('click', function() {
                applySmCon();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_smcon').on('click', function() {
                var sMethodName = "smcon";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                $('#layer_smartcon .close-layer').click();
            });
        
            //스마트콘 닫기
            $('#btn_close_smcon, #btn_close_modal_smcon').on('click', function() {
                $('#smConCardNum').val('');
            });
        });
        
        
        //스마트콘 초기화
        function setInitSmCon() {
            //$('#layer_smartcon .table-wrap > table > tbody> tr').remove();
            $('#layer_smartcon .table-wrap > .scroll > table > tbody> tr').remove();
        }
        
        //스마트콘 조회
        function searchSmCon() {
            var transNo    = $("#transNo").val();
            var cardNo     = $("#smConCardNum").val();
            var paramData  = {transNo:transNo, cardNo:cardNo};
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_smcon').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo == "") {
                gfn_alertMsgBox('쿠폰 번호를 입력하세요.');
                return;
            }
        
            //기 조회여부 체크
            for(var i=0;i<smConChgList.length;i++) {
                if (cardNo == smConChgList[i].cardNo) {
                    gfn_alertMsgBox('이미 조회 되었습니다.');
                    return;
                }
            }
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/searchSmartCon.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //쿠폰 전역변수 세팅
                    var smartConList = data.smartConList;
                    //기프티쇼 list 적용
                    for(var i=0;i<smartConList.length;i++){
                        var sameYn = false;
                        //이중조회 방지
                        for(var j=0;j<smConChgList.length;j++){
                            if (smConChgList[j].cardNo == smartConList[i].cardNo) {
                                sameYn = true;
                                break;
                            }
                        }
                        if (!sameYn) {
                            smConChgList.push(smartConList[i]);
                        }
                    }
        
                    //쿠폰 목록 세팅
                    setSmConChg(smConChgList);
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
                , beforeSend : function() {
                    $('#btn_select_smcon').prop("disabled", true);
                    $('#btn_select_smcon').addClass('disabled');
                }
                , complete : function() {
                    setTimeout(function(){
                           $('#btn_select_smcon').removeClass('disabled');
                           $('#btn_select_smcon').prop("disabled", false);
                    },1500);
                }
            });
        }
        
        //스마트콘 쿠폰 목록 세팅
        function setSmConChg(cponList) {
            setInitSmCon();
            var cponListText = "";
            for(var i=0;i<cponList.length;i++) {
                cponListText =  '<tr> ';
                cponListText += '	<td class="a-l">'+cponList[i].cponName+'</td>  ';
                cponListText += '	<td>'+cponList[i].cardNo+'</td>  ';
                cponListText += '	<td><input type="checkbox" title="스마트콘 사용여부 체크" name="chkSmConChg" idx="'+i+'"/></td>  '; // msg_스마트콘 사용여부 체크
                cponListText += '</tr>  ';
        
                //$('#layer_smartcon .table-wrap > table > tbody').append(cponListText);
                $('#layer_smartcon .table-wrap > .scroll > table > tbody').append(cponListText);
                $('#smConCardNum').val('');
        
                setChkSmConEvent();
            }
        }
        
        //체크박스 이벤트
        function setChkSmConEvent() {
            $(":checkbox[name='chkSmConChg']").off().on('click', function() {
        
                if (!$(this).prop('checked')) {
                    return;
                }
                var transNo    = $("#transNo").val();
                var cmbndNo    = smConChgList[$(this).attr('idx')].cmbndNo;
                var idntfcNo   = smConChgList[$(this).attr('idx')].cardNo;
                var methodName = "smcon";
                var paramData  = {transNo:transNo, cmbndNo:cmbndNo, methodName:methodName, idntfcNo:idntfcNo};
                var idx        = $(this).attr('idx');
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/applyAbleVcmdChk.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
        
                        //추후 order 변경 등 고려 foreach 로 처리
                        $(":checkbox[name='chkSmConChg']").each(function() {
                            if ($(this).attr('idx') == idx) {
                                $(this).prop('checked', false);
                            }
                        });
                    }
                });
        
            });
        }
        
        //스마트콘 쿠폰 적용
        function applySmCon() {
            var chkCnt = $(":checkbox[name='chkSmConChg']:checked").length;
        
            if ( chkCnt == 0 ) {
                gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
                return;
            }
        
            var transNo   = $("#transNo").val();
            var paramCpon = new Array();
        
            $(":checkbox[name='chkSmConChg']:checked").each(function(idx) {
                smConChgList[$(this).attr('idx')].transNo = transNo;
                paramCpon.push(smConChgList[$(this).attr('idx')]);
            });
        
            ////console.log(paramCpon);
        
            var paramData = {transNo:transNo, cponList:paramCpon};
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/applySmartCon.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //할인내역 갱신
                    setMovieDcInfo(data.policyList);
        
                    $('#btn_cancel_smcon').show(); //취소버튼
                    $('#btn_cancel_apply_smcon').show(); //적용취소버튼
        
                    //닫기버튼 클릭
                    $('#layer_smartcon .close-layer').click();
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        </script>
            <!-- 레이어 : 스마트콘 -->
            <section id="layer_smartcon" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">스마트콘<!-- 스마트콘 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="popup-gray mid-info-box mt0">
                            <div class="pop-search-area">
                                <p class="sh-txt reset mr08"><span class="label">예매권번호<!-- 예매권번호 --></span></p>
        
                                <div class="sh-input"><input type="text" title="스마트콘 예매권 번호입력" class="input-text w200px" id="smConCardNum" maxlength="20"></div> <!-- 스마트콘 예매권 번호입력 -->
        
                                <div class="sh-btn gray">
                                    <button type="button" class="button small gray" id="btn_select_smcon">조회<!-- 조회 --></button>
                                </div>
                            </div>
                        </div>
        
                        <div class="table-wrap divide">
                            <table class="board-list line">
                                <caption>예매권 명, 예매권번호, 사용 항목을 가진 스마트콘 예매권 목록의 제목 표<!-- 예매권 명, 예매권번호, 사용 항목을 가진 스마트콘 예매권 목록의 제목 표 --></caption>
                                <colgroup>
                                    <col>
                                    <col style="width:150px;">
                                    <col style="width:60px;">
                                </colgroup>
                                <thead>
                                    <tr>
                                        <th scope="col">예매권 명<!-- 예매권 명 --></th>
                                        <th scope="col">예매권번호<!-- 예매권번호 --></th>
                                        <th scope="col">사용<!-- 사용 --></th>
                                    </tr>
                                </thead>
                            </table>
        
                            <div class="scroll" style="min-height:281px; max-height:281px;">
                                <table class="board-list line">
                                    <caption>예매권 명, 예매권번호, 사용 항목을 가진 스마트콘 예매권 목록의 내용 표<!-- 예매권 명, 예매권번호, 사용 항목을 가진 스마트콘 예매권 목록의 내용 표 --></caption>
                                    <colgroup>
                                        <col>
                                        <col style="width:150px;">
                                        <col style="width:60px;">
                                    </colgroup>
                                    <tbody>
                                        <!-- <tr>
                                            <td class="a-l">스마트콘 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="스마트콘 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">스마트콘 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="스마트콘 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">스마트콘 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="스마트콘 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">스마트콘 1인권</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="스마트콘 1인권 사용여부 체크" /></td>
                                        </tr>
                                        <tr>
                                            <td class="a-l">글자글자글자 글자글자글자</td>
                                            <td>123456789012</td>
                                            <td><input type="checkbox" title="글자글자글자 글자글자글자 사용여부 체크" /></td>
                                        </tr> -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer" id="btn_close_smcon">닫기<!-- 닫기 --></button>
                        <button type="button" class="button small purple" id="btn_cancel_apply_smcon" style="display:none;">적용취소<!-- 적용취소 --></button>
                        <button type="button" class="button small purple" id="btn_apply_smcon">적용<!-- 적용 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close" id="btn_close_modal_smcon">레이어 닫기<!-- 레이어 닫기 --></button>
                </div>
            </section>
            <!-- // 레이어 : 스마트콘 -->
        
            <!-- // 레이어 : 스마트콘 -->
        
            <!-- 레이어 : 제휴예매권 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var pcouponChgList = new Array();
        
        //초기화 공통 sMethodName.init
        function pcoupon_init() {
            setInitPcouponChg();
            pcouponChgList = new Array();
            $('#pcouponNo').val('');
        }
        
        $(function() {
            //제휴 예매권 문자만 사용
            $("#pcouponNo").megaBoxNumberCheck();
        
            //조회버튼 클릭
            $('#btn_select_pcoupon').on('click', function() {
                searchPcouponChg();
            });
        
            //적용버튼 클릭
            $('#btn_apply_pcoupon').on('click', function() {
                applyPcouponChg();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_pcoupon').on('click', function() {
                var sMethodName = "pcoupon";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                $('#layer_alliance .close-layer').click();
            });
        
            //쿠폰 번호 엔터키
            $("#pcouponNo").keydown(function(key) {
                if (key.keyCode == 13) {
                    searchPcouponChg();
                }
            });
        
            //닫기버튼 클릭
            $('#btn_close_pcoupon, #btn_close_modal_pcoupon').on('click', function() {
                $('#pcouponNo').val('');
            });
        
        });
        
        //제휴예매권 존재여부
        function getInitPcouponChgCnt() {
            //return $('#layer_alliance .table-wrap > table > tbody> tr').length;
            return $('#layer_alliance .table-wrap > .scroll > table > tbody> tr').length;
        }
        
        //제휴예매권 초기화
        function setInitPcouponChg() {
            //$('#layer_alliance .table-wrap > table > tbody> tr').remove();
            $('#layer_alliance .table-wrap > .scroll > table > tbody> tr').remove();
        }
        
        //제휴예매권 조회
        function searchPcouponChg() {
            //초기화
            var transNo     = $("#transNo").val();
            var pcouponNo   = $("#pcouponNo").val();
            var playSchdlNo = $("#playSchdlNo").val();
        
            var paramData  = {transNo:transNo,playSchdlNo:playSchdlNo,cmbndNo:pcouponNo };
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_pcoupon').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (pcouponNo == "") {
                //gfn_alertMsgBox('쿠폰 번호를 입력하세요.');
                gfn_alertMsgBox('쿠폰 번호를 입력하세요.');
                //$("#pcouponNo").focus();
                return;
            }
        
            //기 조회여부 체크
            for(var i=0;i<pcouponChgList.length;i++) {
                if (pcouponNo == pcouponChgList[i].cmbndNo) {
                    gfn_alertMsgBox('이미 조회 되었습니다.');
                    return;
                }
            }
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/searchPartnerCpon.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //쿠폰 전역변수 세팅
                    var vcCmbndList = data.vcCmbndList;
                    for(var i=0;i<vcCmbndList.length;i++){
                        pcouponChgList.push(vcCmbndList[i]);
                    }
        
                    //쿠폰 목록 세팅
                    setPcouponChg(pcouponChgList);
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
                , beforeSend : function() {
                    $('#btn_select_pcoupon').prop("disabled", true);
                    $('#btn_select_pcoupon').addClass('disabled');
                }
                , complete : function() {
                    setTimeout(function(){
                           $('#btn_select_pcoupon').removeClass('disabled');
                           $('#btn_select_pcoupon').prop("disabled", false);
                    },1500);
                }
            });
        }
        
        //제휴예매권 목록 세팅
        function setPcouponChg(cponList) {
            setInitPcouponChg();
            var cponListText = "";
            for(var i=0;i<cponList.length;i++) {
                cponListText  = '	<tr>  ';
                cponListText += '		<td class="a-l">'+cponList[i].cmbndExpoNm+'</td> ';
                cponListText += '		<td>'+String(cponList[i].validStartDe).maskDate()+'~'+String(cponList[i].validExprDe).maskDate()+'</td> ';
                cponListText += '		<td>'+cponList[i].seatCnt+'</td> ';
                cponListText += '		<td><input type="checkbox" title="제휴예매권 사용" name="chkPCpon" idx="'+i+'" cponno="'+cponList[i].cmbndNo+'"/></td> '; //msg_제휴예매권 사용
                cponListText += '	</tr> ';
        
                //$('#layer_alliance .table-wrap > table > tbody').append(cponListText);
                $('#layer_alliance .table-wrap > .scroll > table > tbody').append(cponListText);
                $("#pcouponNo").val('');
        
                setChkPcouponEvent();
            }
        }
        
        
        //체크박스 이벤트
        function setChkPcouponEvent() {
            $(":checkbox[name='chkPCpon']").off().on('click', function() {
        
                if (!$(this).prop('checked')) {
                    return;
                }
                var transNo    = $("#transNo").val();
                var cmbndNo    = pcouponChgList[$(this).attr('idx')].cmbndNo;
                var methodName = "pcoupon";
                var paramData  = {transNo:transNo, cmbndNo:cmbndNo, methodName:methodName};
                var idx        = $(this).attr('idx');
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/applyAbleVcmdChk.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
        
                        //추후 order 변경 등 고려 foreach 로 처리
                        $(":checkbox[name='chkPCpon']").each(function() {
                            if ($(this).attr('idx') == idx) {
                                $(this).prop('checked', false);
                            }
                        });
                    }
                });
        
            });
        }
        
        
        //제휴예매권 적용
        function applyPcouponChg() {
            var chkCnt = $(":checkbox[name='chkPCpon']:checked").length;
        
            if ( chkCnt == 0 ) {
                gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
                return;
            }
        
            var transNo     = $("#transNo").val();
            var playSchdlNo = $("#playSchdlNo").val();
            var paramCpon   = new Array();
        
            $(":checkbox[name='chkPCpon']:checked").each(function(idx) {
                pcouponChgList[$(this).attr('idx')].transNo = transNo;
                paramCpon.push(pcouponChgList[$(this).attr('idx')]);
            });
        
            var paramData = {transNo:transNo, cponList:paramCpon, playSchdlNo:playSchdlNo};
            $.ajax({
                url: "/on/oh/ohz/PayBooking/applyPartnerCpon.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //예매화면 할인내역 갱신
                    setMovieDcInfo(data.policyList);
        
                    $('#btn_cancel_pcoupon').show(); //취소버튼
                    $('#btn_cancel_apply_pcoupon').show(); //적용취소버튼
        
                    //닫기버튼 클릭
                    $('#layer_alliance .close-layer').click();
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        
        </script>
        
        
        <!-- 레이어 : 제휴예매권 -->
        <section id="layer_alliance" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
            <div class="wrap">
                <header class="layer-header">
                    <h3 class="tit">제휴예매권<!-- 제휴예매권 --></h3>
                </header>
        
                <div class="layer-con">
                    <div class="popup-gray mid-info-box mt0">
                        <div class="pop-search-area">
                            <p class="sh-txt reset mr08"><span class="label">쿠폰번호<!-- 쿠폰번호 --></span></p>
        
                            <div class="sh-input"><input type="text" title="제휴예매권 쿠폰 번호입력" class="input-text w200px" id="pcouponNo" maxlength="16"></div> <!-- 제휴예매권 쿠폰 번호입력 -->
        
                            <div class="sh-btn gray">
                                <button type="button" class="button small gray" id="btn_select_pcoupon">조회<!-- 조회 --></button>
                            </div>
                        </div>
                    </div>
        
                    <div class="table-wrap divide">
                        <table class="board-list line">
                            <caption>쿠폰정보, 시용내역/유효기간, 인원, 사용 항목을 가진 제휴예매권 목록의 제목 표<!-- 쿠폰정보, 시용내역/유효기간, 인원, 사용 항목을 가진 제휴예매권 목록의 제목 표 --></caption>
                            <colgroup>
                                <col style="width:200px;">
                                <col>
                                <col style="width:100px;">
                                <col style="width:100px;">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th scope="col">쿠폰 정보<!-- 쿠폰 정보 --></th>
                                    <th scope="col">사용내역/유효기간<!-- 사용내역/유효기간 --></th>
                                    <th scope="col">인원<!-- 인원 --></th>
                                    <th scope="col">사용<!-- 사용 --></th>
                                </tr>
                            </thead>
                        </table>
        
                        <div class="scroll" style="min-height:281px; max-height:281px;">
                            <table class="board-list line">
                                <caption>쿠폰정보, 시용내역/유효기간, 인원, 사용 항목을 가진 제휴예매권 목록의 내용 표<!-- 쿠폰정보, 시용내역/유효기간, 인원, 사용 항목을 가진 제휴예매권 목록의 내용 표 --></caption>
                                <colgroup>
                                    <col style="width:200px;">
                                    <col>
                                    <col style="width:100px;">
                                    <col style="width:100px;">
                                </colgroup>
                                <tbody>
                                    <!-- <tr>
                                        <td class="a-l"></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l"></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l"></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l"></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l"></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l"></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l"></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l"></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td class="a-l"></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr> -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
        
                <div class="btn-group-fixed">
                    <button type="button" class="button small close-layer" id="btn_close_pcoupon">닫기<!-- 닫기 --></button>
                    <button type="button" class="button small purple" id="btn_cancel_apply_pcoupon" style="display:none;">적용취소<!-- 적용취소 --></button>
                    <button type="button" class="button small purple" id="btn_apply_pcoupon">적용<!-- 적용 --></button>
                </div>
        
                <button type="button" class="btn-modal-close" id="btn_close_modal_pcoupon">레이어 닫기<!-- 레이어 닫기 --></button>
            </div>
        </section>
        <!-- // 레이어 : 제휴예매권 -->
        
            <!-- // 레이어 : 제휴예매권 -->
        
            <!-- 레이어 : 메가박스 프렌즈 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var friendsChgInfo = new Object();
        
        //초기화 공통 sMethodName.init
        function friends_init() {  //메가박스 프렌즈 전체초기화'
        
            setInitFriends();
            friendsChgInfo = new Object();
        
            $('#friendsCardNum').val('');
            $('#friendsCardNum_hid').val('');
            $('#tdFriendsDayLmt').html('');
            $('#tdFriendsMonthLmt').html('');
            $('#tdTdayBokdAbleAt').html('');
            $('#tdMovieDupUseAt').html('');
        }
        
        $(function() {
            //숫자만 입력가능
            $('#friendsCardNum').megaBoxCardNumberCheck();
        
            //조회버튼 클릭
            $('#btn_select_friends').on('click', function() {
                searchFriends();
            });
        
            //프렌즈 적용
            $('#btn_apply_friends').on('click', function() {
                applyFriends();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_friends').on('click', function() {
                var sMethodName = "friends";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                $('#layer_friends .close-layer').click();
            });
        
            //닫기버튼 클릭
            $('#btn_close_friends, #btn_close_modal_friends').on('click', function() {
                if (!$('#btn_cancel_apply_friends').is(':visible')) {
                    friends_init();
                }
            });
        });
        
        //메가박스 프렌즈 포인트 초기화
        function setInitFriends() {
            $('#layer_friends select').html('<option value="0">매수할인선택</option>');
        }
        
        //메가박스 프렌즈 조회
        function searchFriends() {
            var transNo = $('#transNo').val();
            var cardNo  = $('#friendsCardNum_hid').val();
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_friends').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo == '') {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            var paramData = { cardNo:cardNo, transNo:transNo };
        
            $.ajax({
                url         : '/on/oh/ohz/PayBooking/searchFriendsMemShip.do',
                type        : 'POST',
                contentType : 'application/json;charset=UTF-8',
                dataType    : 'json',
                data        : JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //쿠폰 전역변수 세팅
                    friendsChgInfo = data.friendsInfo;
        
                    //쿠폰 목록 세팅
                    setFriendsChg(friendsChgInfo);
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
                , beforeSend : function() {
                    $('#btn_select_friends').prop("disabled", true);
                    $('#btn_select_friends').addClass('disabled');
                }
                , complete : function() {
                    setTimeout(function(){
                           $('#btn_select_friends').removeClass('disabled');
                           $('#btn_select_friends').prop("disabled", false);
                    },1500);
                }
            });
        }
        
        //메가박스 프렌즈 목록 세팅
        function setFriendsChg(friendsInfo) {
        
            var useAmt01 = 0;
            var useAmt02 = 0;
        
            setInitFriends();
        
            $.each(friendsInfo.personComboList, function(i, param) {
                useAmt01 += param.useAmt;
                $('#selFriends01').append('<option value="'+param.useCnt+'">'+param.useCnt+'매'+' (-'+String(useAmt01).maskNumber()+')</option>');
            });
        
            $.each(friendsInfo.partnerComboList, function(i, param) {
                useAmt02 += param.useAmt;
                $('#selFriends02').append('<option value="'+param.useCnt+'">'+param.useCnt+'매'+' (-'+String(useAmt02).maskNumber()+')</option>');
            });
        
            if (friendsInfo.tktDayUseNmrsLmt == "999") {
                $('#tdFriendsDayLmt').html('무제한');
            } else {
                $('#tdFriendsDayLmt').html(friendsInfo.tktDayUseNmrsLmt);
            }
        
            if (friendsInfo.tktMonthUseNmrsLmt == "999") {
                $('#tdFriendsMonthLmt').html('무제한');
            } else {
                $('#tdFriendsMonthLmt').html(friendsInfo.tktMonthUseNmrsLmt);
            }
        
            if (friendsInfo.movieDupUseAt == "Y") {	//영화중복	--가능 --불가
                $('#tdMovieDupUseAt').html('가능');	//가능
            } else {
                $('#tdMovieDupUseAt').html('불가');	//불가
            }
        
            if (friendsInfo.tdayBokdAbleAt == "Y") {	//당일예매	--당일+후일 --당일
                $('#tdTdayBokdAbleAt').html('당일');	//당일
            } else {
                $('#tdTdayBokdAbleAt').html('당일+후일');	//당일+후일
            }
        }
        
        //메가박스 프렌즈 적용
        function applyFriends() {
        
            var transNo    = $('#transNo').val();
            var cardNo     = $('#friendsCardNum_hid').val();
            var personCnt  = $('#selFriends01 option:selected').val();
            var partnerCnt = $('#selFriends02 option:selected').val();
            var mmnyDcPolicNo = friendsChgInfo.mmnyDcPolicNo;
        
        
            if (personCnt == 0) {
                //본인관람가에 적용할 매수를 선택하세요.
                gfn_alertMsgBox('본인관람가에 적용할 매수를 선택하세요.');
                return;
            }
        
            if (cardNo == '') {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            var paramData = { cardNo:cardNo,transNo:transNo, personCnt:personCnt, partnerCnt:partnerCnt, mmnyDcPolicNo:mmnyDcPolicNo };
        
            $.ajax({
                url        : '/on/oh/ohz/PayBooking/applyFriendsMemShip.do',
                type       : 'POST',
                contentType: 'application/json;charset=UTF-8',
                dataType   : 'json',
                data       : JSON.stringify(paramData),
                success    : function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //할인내역 갱신
                    setMovieDcInfo(data.policyList);
        
                    $('#btn_cancel_friends').show(); //취소버튼
                    $('#btn_cancel_apply_friends').show(); //적용취소버튼
        
                    //닫기버튼 클릭
                    $('#layer_friends .close-layer').click();
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        </script>
        
        <!-- 레이어 : 메가박스 프렌즈 -->
        <input type="hidden" id="friendsCardNum_hid">
        <section id="layer_friends" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
            <div class="wrap">
                <header class="layer-header">
                    <h3 class="tit">메가박스 프렌즈<!-- 메가박스 프렌즈 --></h3>
                </header>
        
                <div class="layer-con">
                    <div class="popup-gray mid-info-box mt0">
                        <div class="pop-search-area">
                            <p class="sh-txt reset mr08"><span class="label">카드번호<!-- 카드번호 --></span></p>
        
                            <div class="sh-input">
                                <input type="text" title="메가박스 프랜즈 카드번호 입력" class="input-text w200px" id="friendsCardNum" maxlength="16">
                            </div>
        
                            <div class="sh-btn gray">
                                <button type="button" class="button small gray" id="btn_select_friends">조회<!-- 조회 --></button>
                            </div>
                        </div>
                    </div>
        
                    <div class="table-wrap device">
                        <table class="board-form">
                            <caption>메가박스 프랜즈 멤버십을 본인 관람가, 동반자 관람단가, 월 제한수, 일 제한수, 주말가능, 관람가능일 순서로 입력하는 표<!-- 메가박스 프랜즈 멤버십을 본인 관람가, 동반자 관람단가, 월 제한수, 일 제한수, 주말가능, 관람가능일 순서로 입력하는 표 --></caption>
                            <colgroup>
                                <col style="width:125px;">
                                <col>
                                <col style="width:125px;">
                                <col>
                            </colgroup>
                            <tbody>
                                <tr>
                                    <th scope="row"><label for="selFriends01">본인 관람가<!-- 본인 관람가 --></label></th>
                                    <td colspan="3">
                                        <select id="selFriends01" class="w150px x-small">
                                            <option>매수할인선택<!-- 매수할인선택 --></option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row"><label for="selFriends02">동반자 관람단가<!-- 동반자 관람단가 --></label></th>
                                    <td colspan="3">
                                        <select id="selFriends02" class="w150px x-small">
                                            <option>매수할인선택<!-- 매수할인선택 --></option>
                                        </select>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row">월 제한수<!-- 월 제한수 --></th>
                                    <td id="tdFriendsMonthLmt"></td>
                                    <th scope="row">일 제한수<!-- 일 제한수 --></th>
                                    <td id="tdFriendsDayLmt"></td>
                                </tr>
                                <tr>
                                    <th scope="row">당일예매<!-- 당일예매 --></th>
                                    <td id="tdTdayBokdAbleAt"></td>
                                    <th scope="row">영화중복<!-- 영화중복 --></th>
                                    <td id="tdMovieDupUseAt"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
        
                <div class="btn-group-fixed">
                    <button type="button" class="button small close-layer" id="btn_close_friends">닫기<!-- 닫기 --></button>
                    <button type="button" class="button small purple" id="btn_cancel_apply_friends" style="display:none;">적용취소<!-- 적용취소 --></button>
                    <button type="button" class="button small purple" id="btn_apply_friends">적용<!-- 적용 --></button>
                </div>
        
                <button type="button" class="btn-modal-close" id="btn_close_modal_friends">레이어 닫기<!-- 레이어 닫기 --></button>
            </div>
        </section>
        <!--// 레이어 : 메가박스 프렌즈 -->
        
            <!--// 레이어 : 메가박스 프렌즈 -->
        
            <!-- 레이어 : 메가박스 아너스카드 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var annusChgInfo = new Object();
        
        //초기화 공통 sMethodName.init
        function annus_init() {  //아너스카드 전체초기화
            setInitAnnus();
            annusChgInfo = new Object();
        
            $('#annusCardNum').val('');
            $('#annusCardNum_hid').val('');
            $('#annusUseAbleAmt').text('0');
        }
        
        $(function() {
            //숫자만 입력가능
            $('#annusCardNum').megaBoxCardNumberCheck();
        
            //조회버튼 클릭
            $('#btn_select_annus').on('click', function() {
                searchAnnus();
            });
        
            //아너스카드 적용
            $('#btn_apply_annus').on('click', function() {
                applyAnnus();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_annus').on('click', function() {
                var sMethodName = "annus";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                 $('#layer_annus_card .close-layer').click();
            });
        
            //닫기버튼 클릭
            $('#btn_close_annus, #btn_close_modal_annus').on('click', function() {
                if (!$('#btn_cancel_apply_annus').is(':visible')) {
                    annus_init();
                }
            });
        });
        
        
        //아너스카드 초기화
        function setInitAnnus() {
            $('#selAnnus > option').remove();
            $('#selAnnus').append('<option value="0">선택</option>');
        }
        
        //아너스카드 조회
        function searchAnnus() {
            var transNo    = $("#transNo").val();
            var cardNo     = $("#annusCardNum_hid").val();
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_annus').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo == "" || cardNo.length < 10) {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            var paramData  = {transNo:transNo, cardNo:cardNo};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/searchAnnus.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //쿠폰 전역변수 세팅
                  annusChgInfo = data.annusInfo;
        
                  //쿠폰 목록 세팅
                  setAnnusChg(annusChgInfo);
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
              , beforeSend : function() {
                  $('#btn_select_annus').prop("disabled", true);
                  $('#btn_select_annus').addClass('disabled');
                }
                , complete : function() {
                  setTimeout(function(){
                         $('#btn_select_annus').removeClass('disabled');
                         $('#btn_select_annus').prop("disabled", false);
                  },1500);
                }
            });
        }
        
        //아너스카드 목록 세팅
        function setAnnusChg(cponInfo) {
            setInitAnnus();
            var cponListText = "";
        
            $('#annusUseAbleAmt').text(String(cponInfo.useAbleAmt).maskNumber());
        
            var cponList = cponInfo.comboList;
            var useAmt   = 0;
            for(var i=0;i<cponList.length;i++) {
                useAmt += cponList[i].useAmt;
                  cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
                $('#selAnnus').append(cponListText);
            }
        }
        
        //아너스카드 적용
        function applyAnnus() {
        
            var transNo  = $("#transNo").val();
            var cardNo   = $("#annusCardNum_hid").val();
            var useCnt   = $('#selAnnus option:selected').val();
        
            if ( useCnt == 0 ) {
                //할인 적용할 매수를 선택하세요.
                gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
                return;
            }
        
            if (cardNo == "" || cardNo.length < 10) {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            var paramData  = {transNo:transNo, cardNo:cardNo, useCnt:useCnt};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/applyAnnus.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //할인내역 갱신
                  setMovieDcInfo(data.policyList);
        
                  $('#btn_cancel_annus').show(); //취소버튼
                  $('#btn_cancel_apply_annus').show(); //적용취소버튼
        
                  //닫기버튼 클릭
                  $('#layer_annus_card .close-layer').click();
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
            });
        }
        </script>
        
            <!-- 레이어 : 아너스카드 -->
            <input type="hidden" id="annusCardNum_hid">
            <section id="layer_annus_card" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">메가박스 아너스카드 <!-- 메가박스 아너스카드 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="popup-gray mid-info-box mt0">
                            <div class="pop-search-area">
                                <p class="sh-txt reset mr08"><span class="label">카드번호 <!-- 카드번호 --></span></p>
        
                                <div class="sh-input">
                                    <input type="text" title="메가박스 아너스카드 카드번호 입력 <!-- 메가박스 아너스카드 카드번호 입력 -->" class="input-text w200px" id="annusCardNum" maxlength="20">
                                </div>
        
                                <div class="sh-btn gray">
                                    <button type="button" class="button small gray" id="btn_select_annus">조회 <!-- 조회 --></button>
                                </div>
                            </div>
                        </div>
        
                        <div class="table-wrap">
                            <table class="board-form">
                                <caption>메가박스 아너스카드를 본인 관람가, 동반자 관람단가, 월 제한수, 일 제한수, 주말가능, 관람가능일, 잔여금액 순서로 입력하는 표 <!-- 메가박스 아너스카드를 본인 관람가, 동반자 관람단가, 월 제한수, 일 제한수, 주말가능, 관람가능일, 잔여금액 순서로 입력하는 표 --></caption>
                                <colgroup>
                                    <col style="width:125px;">
                                    <col>
                                    <col style="width:125px;">
                                    <col>
                                </colgroup>
                                <tbody>
                                    <tr>
                                        <th scope="row"><label for="selAnnus">적용매수 <!-- 본인 관람가 --></label></th>
                                        <td colspan="3">
                                            <select id="selAnnus" class="w150px x-small">
                                                <option>선택 <!-- 매수선택 --></option>
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">잔여금액 <!-- 잔여금액 --></th>
                                        <td colspan="3" id="annusUseAbleAmt"></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer" id="btn_close_annus">닫기 <!-- 닫기 --></button>
                        <button type="button" class="button small purple" id="btn_cancel_apply_annus" style="display:none;">적용취소<!-- 적용취소 --></button>
                        <button type="button" class="button small purple" id="btn_apply_annus">적용 <!-- 적용 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close" id="btn_close_modal_annus">레이어 닫기 <!-- 레이어 닫기 --></button>
                </div>
            </section>
            <!-- 레이어 : 아너스카드 -->
        
            <!--// 레이어 : 메가박스 아너스카드 -->
        
            <!-- 레이어 : 메가박스 영화할인 쿠폰 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var dcouponChgList = new Array();
        
        //초기화 공통 sMethodName.init
        function dcoupon_init() {
            setInitDcouponChg();
            dcouponChgList = new Array();
            $('#dcouponNo').val('');
        }
        
        $(function() {
            //영화할인쿠폰 문자만 사용
            $("#dcouponNo").megaBoxNumberCheck();
        
            //영화할인쿠폰 등록버튼 클릭
            $('#btn_reg_dcoupon').on('click', function() {
                registDcoupon();
            });
        
            //적용버튼 클릭
            $('#btn_apply_dcoupon').on('click', function() {
                applyDcouponChg();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_dcoupon').on('click', function() {
                var sMethodName = "dcoupon";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                $('#layer_dcoupon .close-layer').click();
            });
        
            //닫기버튼 클릭
            $('#btn_close_dcoupon, #btn_close_modal_dcoupon').on('click', function() {
                $('#dcouponNo').val('');
            });
        
        });
        
        //영화할인쿠폰 존재여부
        function getInitDcouponChgCnt() {
            return $('#layer_dcoupon tbody> tr').length;
        }
        
        //영화할인쿠폰 초기화
        function setInitDcouponChg() {
            $('#layer_dcoupon tbody> tr').remove();
        }
        
        //영화할인쿠폰 등록
        function registDcoupon() {
            //초기화
            var transNo = $("#transNo").val();
            var cponNo  = $("#dcouponNo").val();
        
            //영화할인쿠폰 자릿수 체크
            if (cponNo.length < 8) {
                gfn_alertMsgBox("할인쿠폰 번호를 확인해주세요");	//영화할인쿠폰 16자리를 입력하세요
                $("#dcouponNo").focus();
                return;
            }
        
            //기 조회여부 체크
            for (var i = 0; i < dcouponChgList.length; i++) {
                if (dcouponChgList[i].cponNo == cponNo) {
                    gfn_alertMsgBox('이미 조회 되었습니다.');
                    return;
                }
            };
        
            var paramData  = {cponNo:cponNo, transNo:transNo};
        
            $.ajax({
                url         : '/on/oh/ohz/PayBooking/registDiscountCpon.do',
                type        : 'POST',
                contentType : 'application/json;charset=UTF-8',
                dataType    : 'json',
                data        : JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
        
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    if (data.resultStatus == 'Y') {
                        addDcouponChg(cponNo);
                    } else {
                        if (data.msg != undefined && data.msg != null) {
                            gfn_alertMsgBox(data.msg);
                        }
                        //gfn_alertMsgBox('등록 처리 불가한 할인 쿠폰입니다.');
                    }
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        
        //영화할인쿠폰 추가
        function addDcouponChg(cponNo) {
            //초기화
            var transNo   = $("#transNo").val();
            var paramData = {transNo:transNo, cponNo:cponNo};
        
            $.ajax({
                url         : '/on/oh/ohz/PayBooking/searchDiscountCpon.do',
                type        : 'POST',
                contentType : 'application/json;charset=UTF-8',
                dataType    : 'json',
                data        : JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
        
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    if( data.cponList.length > 0){
        
                        var cponList = data.cponList[0];
                        dcouponChgList.push(cponList);
                        var i = dcouponChgList.length-1;
        
                        //console.log("-----------cponList" + cponList);
                        var expoNo  = String(cponList.cponNo).substring(0,4)
                        +"-"+String(cponList.cponNo).substring(4,8)
                        +"-"+String(cponList.cponNo).substring(8,12)
                        +"-****";
        
                        cponListText  = '<tr>';
                        cponListText += '	<td class="a-l">'+ cponList.cponNm +'<p class="inner-code">'+expoNo+'</p></td>';
                        cponListText += '	<td>'+ cponList.validStartDe.maskDate() +'<br />~ '+ cponList.validEndDe.maskDate() +'</td>';
                        cponListText += '	<td><input type="checkbox" title="쿠폰 사용여부 체크" name="chkDcoupon" data-idx="'+i+'"/></td>';
                        cponListText += '</tr>';
        
                        $('#layer_dcoupon tbody').append(cponListText);
                        $('#dcouponNo').val('');
        
                        //체크박스 이벤트 생성
                        setChkDisCponEvent();
                    }
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        
        //영화할인쿠폰 조회
        function searchDcouponChg() {
            //초기화
            var transNo   = $("#transNo").val();
            var paramData = { transNo:transNo };
        
            dcouponChgList = new Array();
            $('#layer_dcoupon tbody> tr').remove();
        
            $.ajax({
                url         : '/on/oh/ohz/PayBooking/searchDiscountCpon.do',
                type        : 'POST',
                contentType : 'application/json;charset=UTF-8',
                dataType    : 'json',
                data        : JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    // 안내문구 3줄로 인한 css수정처리
                    $('#layer_dcoupon div.layer-con').css('height', '465px');
        
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //쿠폰 전역변수 세팅
                    $.each(data.cponList, function(i, param){
                        dcouponChgList.push(param);
                    });
        
                    //쿠폰 목록 세팅
                    setDcouponChg(dcouponChgList);
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        
        
        //영화할인쿠폰 목록 세팅
        function setDcouponChg(cponList) {
            setInitDcouponChg();
        
            var cponListText = '';
        
            $.each(cponList, function(i, param){
                var expoNo  = param.cponNo.substring(0,4)
                                +"-"+param.cponNo.substring(4,8)
                                +"-"+param.cponNo.substring(8,12)
                                +"-****";
        
                cponListText  = '<tr>';
                cponListText += '	<td class="a-l">'+ param.cponNm +'<p class="inner-code">'+expoNo+'</p></td>';
                cponListText += '	<td>'+ param.validStartDe.maskDate() +'<br />~ '+ param.validEndDe.maskDate() +'</td>';
                cponListText += '	<td><input type="checkbox" title="쿠폰 사용여부 체크" name="chkDcoupon" data-idx="'+i+'"/></td>';
                cponListText += '</tr>';
        
                $('#layer_dcoupon tbody').append(cponListText);
        
                //체크박스 이벤트 생성
                setChkDisCponEvent();
            });
        }
        
        
        //체크박스 이벤트
        function setChkDisCponEvent() {
            $(":checkbox[name='chkDcoupon']").off().on('click', function() {
        
                if (!$(this).prop('checked')) {
                    return;
                }
                var transNo    = $("#transNo").val();
                var cponNo     = dcouponChgList[$(this).attr('data-idx')].cponNo;
                var methodName = "dcoupon";
                var paramData  = {transNo:transNo, cponNo:cponNo, methodName:methodName};
                var idx        = $(this).attr('data-idx');
        
                $.ajax({
                    url: "/on/oh/ohz/PayBooking/applyAbleCponChk.do",
                    type: "POST",
                    contentType: "application/json;charset=UTF-8",
                    dataType: "json",
                    data: JSON.stringify(paramData),
                    success: function (data, textStatus, jqXHR) {
                        //console.log(data);
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
                    },
                    error: function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
                        //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                        errBookingChk(err.msg);
        
                        //추후 order 변경 등 고려 foreach 로 처리
                        $(":checkbox[name='chkDcoupon']").each(function() {
                            if ($(this).attr('data-idx') == idx) {
                                $(this).prop('checked', false);
                            }
                        });
                    }
                });
        
            });
        }
        
        
        //영화할인쿠폰 적용
        function applyDcouponChg() {
        
            var $chk = $('#layer_dcoupon :checkbox[name="chkDcoupon"]:checked');
        
            if ($chk.length == 0) {
                gfn_alertMsgBox('선택된 쿠폰 정보가 없습니다.');
                return;
            }
        
            var transNo   = $('#transNo').val();
            var paramCpon = new Array();
        
            $.each($chk, function() {
                paramCpon.push({'cponNo' : dcouponChgList[$(this).data('idx')].cponNo});
            });
        
            var paramData = { transNo:transNo, cponList:paramCpon };
        
            $.ajax({
                url         : '/on/oh/ohz/PayBooking/applyDiscountCpon.do',
                type        : 'POST',
                contentType : 'application/json;charset=UTF-8',
                dataType    : 'json',
                data        : JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //예매화면 할인내역 갱신
                    setMovieDcInfo(data.policyList);
        
                    $('#btn_cancel_dcoupon').show(); //취소버튼
                    $('#btn_cancel_apply_dcoupon').show(); //적용취소버튼
        
                    //닫기버튼 클릭
                    $('#layer_dcoupon .close-layer').click();
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        }
        </script>
        
        <!-- 레이어 : 메가박스 영화할인 쿠폰 -->
        <section id="layer_dcoupon" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
            <div class="wrap">
                <header class="layer-header">
                    <h3 class="tit">메가박스 할인쿠폰<!-- 메가박스 할인쿠폰 --></h3>
                </header>
        
                <div class="layer-con">
                    <div class="pop-tit">사용할 쿠폰을 선택해주세요.<!-- 사용할 쿠폰을 선택해주세요. --></div>
        
                    <div class="popup-gray mid-info-box mb20">
                        <div class="pop-search-area">
                            <p class="sh-txt reset mr08"><span class="label">쿠폰번호<!-- 쿠폰번호 --></span></p>
        
                            <div class="sh-input">
                                <input id="dcouponNo" type="text" title="메가박스 영화할인쿠폰 16자리 입력" placeholder="" class="input-text" style="width:250px;" maxlength="16">
                            </div>
        
                            <div class="sh-btn gray">
                                <button type="button" class="button small gray" id="btn_reg_dcoupon">쿠폰등록<!-- 쿠폰등록 --></button>
                            </div>
                        </div>
                    </div>
        
                    <div class="table-wrap divide">
                        <table class="board-list line">
                            <caption>쿠폰명, 쿠폰번호, 유효기간, 사용 항목을 가진 메가박스 영화할인쿠폰 목록의 제목 표<!-- 쿠폰명, 쿠폰번호, 유효기간, 사용 항목을 가진 메가박스 영화할인쿠폰 목록의 제목 표 --></caption>
                            <colgroup>
                                <col>
                                <col style="width:115px;">
                                <col style="width:60px;">
                            </colgroup>
                            <thead>
                                <tr>
                                    <th scope="col">쿠폰명<!-- 쿠폰명 --></th>
                                    <th scope="col">유효기간<!-- 유효기간 --></th>
                                    <th scope="col">사용<!-- 사용 --></th>
                                </tr>
                            </thead>
                        </table>
        
                        <div class="scroll" style="min-height:171px; max-height:171px;">
                            <table class="board-list line">
                                <caption>쿠폰명, 쿠폰번호, 유효기간, 사용 항목을 가진 메가박스 영화할인쿠폰 목록의 내용 표<!-- 쿠폰명, 쿠폰번호, 유효기간, 사용 항목을 가진 메가박스 영화할인쿠폰 목록의 내용 표 --></caption>
                                <colgroup>
                                    <col>
                                    <col style="width:115px;">
                                    <col style="width:60px;">
                                </colgroup>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
        
                        <div class="box-border v1 use-guide mt15">
                            <p class="tit">이용안내<!-- 이용안내 --></p>
        
                            <ul class="dot-list gray">
                                <li>사용 가능한 쿠폰만 노출됩니다.<!-- 사용 가능한 쿠폰만 노출됩니다. --></li>
                                <li>전체 쿠폰 목록은 나의 메가박스 &gt; 할인쿠폰에서 확인 가능합니다.<!-- 전체 쿠폰 목록은 나의 메가박스 > 할인쿠폰에서 확인 가능합니다. --></li>
                                <li>보유하신 쿠폰은 등록 후 이용하실 수 있습니다.<!-- 보유하신 쿠폰은 등록 후 이용하실 수 있습니다. --></li>
                            </ul>
                        </div>
                    </div>
                </div>
        
                <div class="btn-group-fixed">
                    <button type="button" class="button small close-layer" id="btn_close_dcoupon">닫기<!-- 닫기 --></button>
                    <button type="button" class="button small purple" id="btn_cancel_apply_dcoupon" style="display:none;">적용취소<!-- 적용취소 --></button>
                    <button type="button" class="button small purple" id="btn_apply_dcoupon">적용<!-- 적용 --></button>
                </div>
        
                <button type="button" class="btn-modal-close" id="btn_close_modal_dcoupon">레이어 닫기<!-- 레이어 닫기 --></button>
            </div>
        </section>
        <!-- //레이어 : 메가박스 영화할인 쿠폰 -->
            <!-- //레이어 : 메가박스 영화할인 쿠폰 -->
        
            <!-- 레이어 : skt -->
            
        
        
        
        
        
        <script type="text/javascript">
        var sktNormalMemberChgInfo = new Object();	//skt normal
        
        //초기화 공통 sMethodName.init
        function skt_init() {  //스마트콘 전체초기화
            setInitSktMember();
            sktNormalMemberChgInfo = new Object();
        
            $('#sktMemberCardNum').val('');
            $('#sktMemberCardNum_hid').val('');
            $('#sktMemberUseAbleCnt').text('0');
        }
        
        $(function() {
            //숫자만 입력가능
            $("#sktMemberCardNum").megaBoxCardNumberCheck();
        
            //조회버튼 클릭
            $('#btn_select_skt').on('click', function() {
                searchSktMember();
            });
        
            //T멤버십 적용
            $('#btn_apply_skt').on('click', function() {
                //현재는 일반만 적용가능. 추후 확장 가능있음
                applyNormalSktMember();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_skt').on('click', function() {
                var sMethodName = "skt";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                 $('#layer_skt .close-layer').click();
            });
        
            //닫기버튼 클릭
            $('#btn_close_skt, #btn_close_modal_skt').on('click', function() {
                if (!$('#btn_cancel_apply_skt').is(':visible')) {
                    skt_init();
                }
            });
        });
        
        
        //T멤버십 초기화
        function setInitSktMember() {
            $('#selSktNormalMember > option').remove();
            $('#selSktNormalMember').append('<option value="0">선택</option>');
        }
        
        //T멤버십 조회
        function searchSktMember() {
            var transNo   = $("#transNo").val();
            var cardNo    = $("#sktMemberCardNum_hid").val().replaceAll('-', '').nvlNum(0);
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_skt').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo == "") {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            var paramData  = {transNo:transNo, cardNo:cardNo};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/searchTmemberShip.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //쿠폰 전역변수 세팅
                  sktNormalMemberChgInfo = data.tNormalInfo;
        
                  //쿠폰 목록 세팅
                  setSktNormalMemberChg(sktNormalMemberChgInfo);
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }, beforeSend : function() {
                $('#btn_select_skt').prop("disabled", true);
                $('#btn_select_skt').addClass('disabled');
              }
              , complete : function() {
                setTimeout(function(){
                       $('#btn_select_skt').removeClass('disabled');
                       $('#btn_select_skt').prop("disabled", false);
                },1500);
              }
            });
        }
        
        //T멤버십 목록 세팅
        function setSktNormalMemberChg(cponInfo) {
            setInitSktMember();
            var cponListText = "";
        
            $('#sktMemberUseAbleCnt').text(String(cponInfo.useAbleCnt).maskNumber());
        
            var cponList = cponInfo.comboList;
            var useAmt   = 0;
            for(var i=0;i<cponList.length;i++) {
                useAmt += cponList[i].useAmt;
                  cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
                $('#selSktNormalMember').append(cponListText);
            }
        }
        
        //T멤버십 적용
        function applyNormalSktMember() {
        
            var transNo = $("#transNo").val();
            var cardNo  = $("#sktMemberCardNum_hid").val().replaceAll('-', '').nvlNum(0);
            var useCnt  = $('#selSktNormalMember option:selected').val();
            var maxCnt  = $('#sktMemberUseAbleCnt').text().replaceAll(',', '').nvlNum(0);
        
            if (cardNo == "") {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            if ( useCnt == 0 ) {
                //할인 적용할 매수를 선택하세요.
                gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
                return;
            }
        
            if ( useCnt > maxCnt ) {
                //할인 적용할 매수를 선택하세요.
                gfn_alertMsgBox('당일 잔여횟수를 초과하였습니다.');
                return;
            }
        
            var paramData  = {transNo:transNo, cardNo:cardNo, useCnt:useCnt};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/applyTmemberNormal.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //할인내역 갱신
                  setMovieDcInfo(data.policyList);
        
                  $('#btn_cancel_skt').show(); //취소버튼
                  $('#btn_cancel_apply_skt').show(); //적용취소버튼
        
                  //닫기버튼 클릭
                  $('#layer_skt .close-layer').click();
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
            });
        }
        </script>
        
            <!-- 레이어 : skt -->
            <input type="hidden" id="sktMemberCardNum_hid">
            <section id="layer_skt" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">T멤버십<!-- T멤버십 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="reset mb10">
                            T멤버십 카드 정보를 입력해주세요<!-- T멤버십 카드 정보를 입력해주세요 -->
                        </div>
        
                        <div class="popup-gray mid-info-box mb15">
                            <div class="pop-search-area">
                                <p class="sh-txt reset mr08"><span class="sktMemberCardNum">카드번호<!-- 카드번호 --></span></p>
        
                                <div class="sh-input">
                                    <input type="text" title="T멤버십 카드번호 입력" class="input-text w200px" id="sktMemberCardNum" maxlength="20">
                                </div>
        
                                <div class="sh-btn gray">
                                    <button type="button" class="button small gray" id="btn_select_skt">조회<!-- 조회 --></button>
                                </div>
                            </div>
                        </div>
        
                        <div class="table-wrap">
                            <table class="board-form">
                                <caption></caption>
                                <colgroup>
                                    <col style="width:150px;">
                                    <col>
                                </colgroup>
                                <tbody>
                                    <tr>
                                        <th scope="row"><label for="selSktNormalMember">T 멤버십<!-- T 멤버십 --></label></th>
                                        <td>
                                            <div class="td-relative">
                                                <select class="w150px mr10 x-small" id="selSktNormalMember">
                                                    <option value="0">선택<!-- 선택 --></option>
                                                </select>
        
                                                당일 잔여<!-- 당일 잔여 --> <span class="font-green" id="sktMemberUseAbleCnt">0</span>회<!-- 회 -->
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
        
                        <div class="box-border v1 use-guide mt15">
                            <p class="tit">이용안내<!-- 이용안내 --></p>
        
                            <ul class="dot-list gray">
                                <li>장당 2,000원 할인(동반 4인 포함, 1일 최대 5매)<!-- 장당 2,000원 할인(동반 4인 포함, 1일 최대 5매) --></li>
                                <li>조조, 심야, 우대, 어린이요금, 문화의날 및 특별콘텐트 이용불가<!-- 조조, 심야, 우대, 어린이요금, 문화의날 및 특별콘텐트 이용불가 --></li>
                                <li>타 제휴 및 쿠폰 할인 중복사용 불가<!-- 타 제휴 및 쿠폰 할인 중복사용 불가 --></li>
                                <li>VIP무료 예매는 T멤버십 홈페이지에서 가능<!-- VIP무료 예매는 T멤버십 홈페이지에서 가능 --></li>
                            </ul>
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer" id="btn_close_skt">닫기<!-- 닫기 --></button>
                        <button type="button" class="button small purple" id="btn_cancel_apply_skt" style="display:none;">적용취소<!-- 적용취소 --></button>
                        <button type="button" class="button small purple" id="btn_apply_skt">적용<!-- 적용 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close" id="btn_close_modal_skt">레이어 닫기<!-- 레이어 닫기 --></button>
                </div>
            </section>
            <!--// 레이어 : skt -->
        
            <!--// 레이어 : skt -->
        
            <!-- 레이어 : 현대 M포인트 카드 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var hyMPointChgInfo = new Object();
        
        //초기화 공통 sMethodName.init
        function hydm_init() {  //현대M포인트 전체초기화
            setInitHyMPoint();
            hyMPointChgInfo = new Object();
        
            $('#hyMPointCardNum_1').val('');
            $('#hyMPointCardNum_2').val('');
            $('#hyMPointCardNum_3').val('');
            $('#hyMPointCardNum_4').val('');
            $('#hyMPointUseAbleAmt').text('0');
        
            $('#hyundai_m_point_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
            $('#hy_m_point_card_mm').val('');
            $('#hy_m_point_card_yy').val('');
            $('#hyundai_m_point_card_birthday').val('');
            $('#hyundai_m_point_card_password').val('');
        }
        
        
        $(function() {
            //숫자만 입력가능
            $('#hyMPointCardNum_1').megaBoxNumberCheck();
            $('#hyMPointCardNum_2').megaBoxNumberCheck();
            $('#hyMPointCardNum_3').megaBoxNumberCheck();
            $('#hyMPointCardNum_4').megaBoxNumberCheck();
            $('#hyundai_m_point_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
            $('#hy_m_point_card_mm').megaBoxNumberCheck();  //유효기간 숫자만 입력
            $('#hy_m_point_card_yy').megaBoxNumberCheck();  //유효기간 숫자만 입력
        
            //조회버튼 클릭
            $('#btn_select_hydm').on('click', function() {
                searchHyMPoint();
            });
        
            //현대m포인트 적용
            $('#btn_apply_hydm').on('click', function() {
                applyHyMPoint();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_hydm').on('click', function() {
                var sMethodName = "hydm";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                 $('#layer_hyundai_m_point .close-layer').click();
            });
        
            //닫기버튼 클릭
            $('#btn_close_hydm, #btn_close_modal_hydm').on('click', function() {
                if (!$('#btn_cancel_apply_hydm').is(':visible')) {
                    hydm_init();
                }
            });
        });
        
        
        //현대m포인트 포인트 초기화
        function setInitHyMPoint() {
            $('#selHyMPoint > option').remove();
            $('#selHyMPoint').append('<option value="0">선택</option>');
        }
        
        //현대m포인트 조회
        function searchHyMPoint() {
            var transNo    = $("#transNo").val();
            var cardNo1    = $("#hyMPointCardNum_1").val();
            var cardNo2    = $("#hyMPointCardNum_2").val();
            var cardNo3    = $("#hyMPointCardNum_3").val();
            var cardNo4    = $("#hyMPointCardNum_4").val();
            var cardNo     = cardNo1 + cardNo2 + cardNo3 + cardNo4;
        
            var valBirth   = $('#hyundai_m_point_card_birthday').val();  //생년월일/사업자번호 숫자만 입력
            var valMonth   = $('#hy_m_point_card_mm').val();  //유효기간 숫자만 입력
            var valYear    = $('#hy_m_point_card_yy').val();  //유효기간 숫자만 입력
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_hydm').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo1 == "" || cardNo2 == "" || cardNo3 == "" || cardNo4 == "") {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            if (valMonth == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#hy_m_point_card_mm').focus();
                return;
            }
        
            if (valYear == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#hy_m_point_card_yy').focus();
                return;
            }
        
            if (valBirth == "") {
                gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
                $('#hyundai_m_point_card_birthday').focus();
                return;
            }
        
            var paramData = { cardNo1:cardNo1,cardNo2:cardNo2,cardNo3:cardNo3,cardNo4:cardNo4,cardNo:cardNo,transNo:transNo, valMonth:valMonth, valYear:valYear, valBirth:valBirth};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/searchHyundaiMpoint.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //쿠폰 전역변수 세팅
                  hyMPointChgInfo = data.hyMPointInfo;
        
                  //쿠폰 목록 세팅
                  setHyMPointChg(hyMPointChgInfo);
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
              , beforeSend : function() {
                  $('#btn_select_hydm').prop("disabled", true);
                  $('#btn_select_hydm').addClass('disabled');
                }
                , complete : function() {
                  setTimeout(function(){
                         $('#btn_select_hydm').removeClass('disabled');
                         $('#btn_select_hydm').prop("disabled", false);
                  },1500);
                }
            });
        }
        
        //현대m포인트 목록 세팅
        function setHyMPointChg(cponInfo) {
            setInitHyMPoint();
            var cponListText = "";
        
            $('#hyMPointUseAbleAmt').text(String(cponInfo.useAbleAmt).maskNumber());
        
            var cponList = cponInfo.comboList;
            var useAmt   = 0;
            for(var i=0;i<cponList.length;i++) {
                useAmt += cponList[i].useAmt;
                  cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
                $('#selHyMPoint').append(cponListText);
            }
        }
        
        //현대m포인트 적용
        function applyHyMPoint() {
        
            var transNo  = $("#transNo").val();
            var cardNo1  = $("#hyMPointCardNum_1").val();
            var cardNo2  = $("#hyMPointCardNum_2").val();
            var cardNo3  = $("#hyMPointCardNum_3").val();
            var cardNo4  = $("#hyMPointCardNum_4").val();
            var cardNo   = cardNo1 + cardNo2 + cardNo3 + cardNo4;
            var useCnt   = $('#selHyMPoint option:selected').val();
            var password = $("#hyundai_m_point_card_password").val();
        
            var valBirth   = $('#hyundai_m_point_card_birthday').val();  //생년월일/사업자번호 숫자만 입력
            var valMonth   = $('#hy_m_point_card_mm').val();  //유효기간 숫자만 입력
            var valYear    = $('#hy_m_point_card_yy').val();  //유효기간 숫자만 입력
        
            if ( useCnt == 0 ) {
                //할인 적용할 매수를 선택하세요.
                gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
                return;
            }
        
            if (cardNo1 == "" || cardNo2 == "" || cardNo3 == "" || cardNo4 == "") {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            if (password == "") {
                gfn_alertMsgBox('비밀번호 4자리 이상 입력하세요.');
                $("#hyundai_m_point_card_password").focus();
                return;
            }
        
            if (valMonth == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#hy_m_point_card_mm').focus();
                return;
            }
        
            if (valYear == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#hy_m_point_card_yy').focus();
                return;
            }
        
            if (valBirth == "") {
                gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
                $('#hyundai_m_point_card_birthday').focus();
                return;
            }
        
            if ($('#hyundai_m_point_card_agree').prop('checked') == false) {
                gfn_alertMsgBox('결제대행서비스 약관에 모두 동의하셔야 결제하실 수 있습니다.');
                $('#hyundai_m_point_card_agree').focus();
                return;
            }
        
            var paramData = { cardNo1:cardNo1,cardNo2:cardNo2,cardNo3:cardNo3,cardNo4:cardNo4,cardNo:cardNo,password:password, transNo:transNo, valMonth:valMonth, valYear:valYear, valBirth:valBirth, useCnt:useCnt};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/applyHyundaiMpoint.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //할인내역 갱신
                  setMovieDcInfo(data.policyList);
        
                  $('#btn_cancel_hydm').show(); //취소버튼
                  $('#btn_cancel_apply_hydm').show(); //적용취소버튼
        
                  //닫기버튼 클릭
                  $('#layer_hyundai_m_point .close-layer').click();
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
            });
        }
        
        //현대m포인트 결제
        function payHyMPoint() {
            var cardNo1  = $("#hyMPointCardNum_1").val();
            var cardNo2  = $("#hyMPointCardNum_2").val();
            var cardNo3  = $("#hyMPointCardNum_3").val();
            var cardNo4  = $("#hyMPointCardNum_4").val();
            var cardNo   = cardNo1 + cardNo2 + cardNo3 + cardNo4;
            var useCnt   = $('#selHyMPoint option:selected').val();
            var password = $("#hyundai_m_point_card_password").val();
        
            var valBirth   = $('#hyundai_m_point_card_birthday').val();  //생년월일/사업자번호 숫자만 입력
            var valMonth   = $('#hy_m_point_card_mm').val();  //유효기간 숫자만 입력
            var valYear    = $('#hy_m_point_card_yy').val();  //유효기간 숫자만 입력
        
            if ( useCnt == 0 ) {
                //할인 적용할 매수를 선택하세요.
                gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
                return;
            }
        
            if (cardNo1 == "" || cardNo2 == "" || cardNo3 == "" || cardNo4 == "") {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            if (password == "") {
                gfn_alertMsgBox('비밀번호 4자리 이상 입력하세요.');
                return;
            }
        
            if (valMonth == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                return;
            }
        
            if (valYear == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                return;
            }
        
            if (valBirth == "") {
                gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
                return;
            }
        
            var option = { cardNo1:cardNo1,cardNo2:cardNo2,cardNo3:cardNo3,cardNo4:cardNo4,cardNo:cardNo,
                           password:password, valMonth:valMonth, valYear:valYear, valBirth:valBirth, useCnt:useCnt,
                           preDisc:'Y',  discType:'HYUNM'};
        
            //최종결제 금액 유효성 검사 및 결제 처리
            chkLastPayAmt(option);
        
        }
        </script>
        
            <!-- 레이어 : 현대 M포인트 카드 -->
            <section id="layer_hyundai_m_point" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">현대카드 M포인트<!-- 현대 M포인트 카드 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="reset">
                             현대 M포인트 카드 정보를 입력해주세요<!-- 현대 M포인트 카드 정보를 입력해주세요 -->
                        </div>
        
                        <div class="popup-gray mid-info-box">
                            <div class="pop-search-area">
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="hyundai_m_point_card_num">카드번호<!-- 카드번호 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" title="현대 M포인트 카드번호 첫번째자리 입력" class="input-text w60px x-small" id="hyMPointCardNum_1" maxlength="4"> -
                                        <input type="text" title="현대 M포인트 카드번호 두번째자리 입력" class="input-text w60px x-small" id="hyMPointCardNum_2" maxlength="4"> -
                                        <input type="number" title="현대 M포인트 카드번호 세번째자리 입력" class="input-text w60px x-small pwnew" id="hyMPointCardNum_3" maxlength="4" oninput="gfn_numberMaxLength(this);"> -
                                        <input type="text" title="현대 M포인트 카드번호 네번째자리 입력" class="input-text w60px x-small" id="hyMPointCardNum_4" maxlength="4">
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="hyundai_m_point_card_date">카드유효기간<!-- 카드유효기간 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" id="hy_m_point_card_mm" title="현대 M포인트 카드 유효기간 월 입력" placeholder="MM" class="input-text w60px x-small a-c" maxlength="2"> /
                                        <input type="text" id="hy_m_point_card_yy" title="현대 M포인트 카드 유효기간 년 입력" placeholder="YY" class="input-text w60px x-small a-c" maxlength="2">
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="hyundai_m_point_card_password">비밀번호<!-- 비밀번호 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" id="hyundai_m_point_card_password" title="현대 M포인트 카드 비밀번호 입력" class="input-text w60px x-small pwnew" maxlength="2">
                                        <span class="font-size-13 font-gray ml05">앞 2자리<!-- 앞 2자리 --></span>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line gray">
                                    <p class="sh-txt reset vt"><label for="hyundai_m_point_card_birthday">생년월일<!-- 생년월일 --></label></p>
                                    <div class="sh-input mr0">
                                        <input type="text" id="hyundai_m_point_card_birthday" title="현대 M포인트 카드 생년월일 입력" class="input-text w80px x-small" maxlength="10">
        
                                        <p class="reset inline-block font-size-13 ml05 font-gray">생년월일 6자리(카드소유자) / 사업자번호 10자리<!-- 생년월일 6자리(카드소유자) / 사업자번호 10자리 --></p>
        
                                        <button type="button" class="button gray x-small ml07" id="btn_select_hydm">조회<!-- 조회 --></button>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset vt"><label for="hyundai_m_point_card_ticket_counting">적용매수</label></p>
                                    <div class="sh-input mr0">
        
                                        <select title="현대 M포인트 선택" class="w120px v1 x-small" id="selHyMPoint">
                                            <option value="0">선택<!-- 선택 --></option>
                                        </select>
        
                                        <span class="ml05 font-size-13">사용 가능한 포인트는 <em class="font-gblue" id="hyMPointUseAbleAmt">0</em> Point 입니다.<!-- 입니다. --></span>
                                    </div>
                                </div>
                            </div>
                        </div>
        
                        <div class="box-border v1 use-guide">
                            <p class="tit">이용안내<!-- 이용안내 --></p>
        
                            <ul class="dot-list gray">
                                <li>영화 2,000포인트 차감 할인(1일 최대 8매), 현대카드로만 결제 가능<!-- 영화 2,000포인트 차감 할인(1일 최대 8매), 현대카드로만 결제 가능 --></li>
                                <li>우대, 문화의날 및 특별콘텐트 이용불가<!-- 우대, 문화의날 및 특별콘텐트 이용불가 --></li>
                                <li>타 제휴 및 쿠폰 할인 중복사용 불가<!-- 타 제휴 및 쿠폰 할인 중복사용 불가 --></li>
                            </ul>
                        </div>
        
                        <div class="mt10">
                            <input type="checkbox" id="hyundai_m_point_card_agree">
                            <label for="hyundai_m_point_card_agree">결제대행서비스 약관에 모두 동의 <!-- 결제대행서비스 약관에 모두 동의 --></label>
        
                            <div class="mt10">
                                <a href="https://www.firstpay.co.kr/jsp/common/agreementPopup.jsp?type=1&amp;langtype=HAN" title="전자금융거래 이용약관" target="_blank" class="a-link ml20">전자금융거래 이용약관 <!-- 전자금융거래 이용약관 --> <i class="iconset ico-arr-right-green"></i></a>
                                <a href="https://www.firstpay.co.kr/jsp/common/agreementPopup.jsp?type=3&amp;langtype=HAN" title="개인정보의 수집 및 이용안내" target="_blank" class="a-link ml20">개인정보의 수집 및 이용안내 <!-- 개인정보의 수집 및 이용안내 --> <i class="iconset ico-arr-right-green"></i></a>
                                <a href="https://www.firstpay.co.kr/jsp/common/agreementPopup.jsp?type=4&amp;langtype=HAN" title="개인정보 제공 및 위탁안내" target="_blank" class="a-link ml20">개인정보 제공 및 위탁안내 <!-- 개인정보 제공 및 위탁안내 --> <i class="iconset ico-arr-right-green"></i></a>
                            </div>
                        </div>
        
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer" id="btn_close_hydm">닫기<!-- 닫기 --></button>
                        <button type="button" class="button small purple" id="btn_cancel_apply_hydm" style="display:none;">적용취소<!-- 적용취소 --></button>
                        <button type="button" class="button small purple" id="btn_apply_hydm">적용<!-- 적용 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close" id="btn_close_modal_hydm">레이어 닫기<!-- 레이어 닫기 --></button>
                </div>
            </section>
            <!--// 레이어 : 현대 M포인트 카드 -->
            <!--// 레이어 : 현대 M포인트 카드 -->
        
            <!-- 레이어 : 문화누리 카드 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var culturenuriChgInfo = new Object();
        
        //초기화 공통 sMethodName.init
        function culturenuri_init() {  //문화누리 전체초기화
            setInitCulturenuri();
            culturenuriChgInfo = new Object();
        
            $('#culturenuriCardNum').val('');
            $('#culturenuriCardNum_hid').val('');
        
            $('#culturenuri_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
            $('#culturenuri_card_mm').val('');
            $('#culturenuri_card_yy').val('');
            $('#culturenuri_card_birthday').val('');
            $('#culturenuri_card_password').val('');
        }
        
        
        $(function() {
            //숫자만 입력가능
            $('#culturenuriCardNum').megaBoxCardNumberCheck();
            $('#culturenuri_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
            $('#culturenuri_card_mm').megaBoxNumberCheck();  //유효기간 숫자만 입력
            $('#culturenuri_card_yy').megaBoxNumberCheck();  //유효기간 숫자만 입력
        
            //조회버튼 클릭
            $('#btn_select_culturenuri').on('click', function() {
                searchCulturenuri();
            });
        
            //문화누리 적용
            $('#btn_apply_culturenuri').on('click', function() {
                applyCulturenuri();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_culturenuri').on('click', function() {
                var sMethodName = "culturenuri";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                 $('#layer_mnuri .close-layer').click();
            });
        
            //닫기버튼 클릭
            $('#btn_close_culturenuri, #btn_close_modal_culturenuri').on('click', function() {
                if (!$('#btn_cancel_apply_culturenuri').is(':visible')) {
                    culturenuri_init();
                }
            });
        });
        
        
        //문화누리 포인트 초기화
        function setInitCulturenuri() {
            $('#selCulturenuri > option').remove();
            $('#selCulturenuri').append('<option value="0">선택</option>');
        }
        
        //문화누리 조회
        function searchCulturenuri() {
            var transNo    = $("#transNo").val();
            var cardNo     = $("#culturenuriCardNum_hid").val().replaceAll('-', '').nvlNum(0);
        
            var valBirth   = $('#culturenuri_card_birthday').val();  //생년월일/사업자번호 숫자만 입력
            var valMonth   = $('#culturenuri_card_mm').val();  //유효기간 숫자만 입력
            var valYear    = $('#culturenuri_card_yy').val();  //유효기간 숫자만 입력
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_culturenuri').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo == "" || cardNo.length < 10) {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            if (valMonth == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#culturenuri_card_mm').focus();
                return;
            }
        
            if (valYear == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#culturenuri_card_yy').focus();
                return;
            }
        
            if (valBirth == "") {
                gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
                $('#culturenuri_card_birthday').focus();
                return;
            }
        
            var paramData = { cardNo:cardNo,transNo:transNo, valMonth:valMonth, valYear:valYear, valBirth:valBirth};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/searchCulturenuri.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //쿠폰 전역변수 세팅
                  culturenuriChgInfo = data.culturenuriInfo;
        
                  //쿠폰 목록 세팅
                  setCulturenuriChg(culturenuriChgInfo);
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
              , beforeSend : function() {
                  $('#btn_select_culturenuri').prop("disabled", true);
                  $('#btn_select_culturenuri').addClass('disabled');
                }
                , complete : function() {
                  setTimeout(function(){
                         $('#btn_select_culturenuri').removeClass('disabled');
                         $('#btn_select_culturenuri').prop("disabled", false);
                  },1500);
                }
            });
        }
        
        //문화누리 목록 세팅
        function setCulturenuriChg(cponInfo) {
            setInitCulturenuri();
        
            var cponListText = "";
            var cponList = cponInfo.comboList;
            var useAmt   = 0;
            for(var i=0;i<cponList.length;i++) {
                useAmt += cponList[i].useAmt;
                  cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
                $('#selCulturenuri').append(cponListText);
            }
        }
        
        //문화누리 적용
        function applyCulturenuri() {
        
            var transNo  = $("#transNo").val();
            var cardNo   = $("#culturenuriCardNum_hid").val().replaceAll('-', '').nvlNum(0);
            var useCnt   = $('#selCulturenuri option:selected').val();
            var password = $("#culturenuri_card_password").val();
        
            var valBirth   = $('#culturenuri_card_birthday').val();  //생년월일/사업자번호 숫자만 입력
            var valMonth   = $('#culturenuri_card_mm').val();  //유효기간 숫자만 입력
            var valYear    = $('#culturenuri_card_yy').val();  //유효기간 숫자만 입력
        
            if ( useCnt == 0 ) {
                //할인 적용할 매수를 선택하세요.
                gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
                return;
            }
        
            if (cardNo == "" || cardNo.length < 10) {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            if (password == "") {
                gfn_alertMsgBox('비밀번호 2자리 이상 입력하세요.');
                $("#culturenuri_card_password").focus();
                return;
            }
        
            if (valMonth == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#culturenuri_card_mm').focus();
                return;
            }
        
            if (valYear == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#culturenuri_card_yy').focus();
                return;
            }
        
            if (valBirth == "") {
                gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
                $('#culturenuri_card_birthday').focus();
                return;
            }
        
            var paramData = { cardNo:cardNo,password:password, transNo:transNo, valMonth:valMonth, valYear:valYear, valBirth:valBirth, useCnt:useCnt};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/applyCulturenuri.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //할인내역 갱신
                  setMovieDcInfo(data.policyList);
        
                  $('#btn_cancel_culturenuri').show(); //취소버튼
                  $('#btn_cancel_apply_culturenuri').show(); //적용취소버튼
        
                  //닫기버튼 클릭
                  $('#layer_mnuri .close-layer').click();
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
            });
        }
        
        //문화누리 결제
        function payCulturenuri() {
            var cardNo   = $("#culturenuriCardNum_hid").val().replaceAll('-', '').nvlNum(0);
            var useCnt   = $('#selCulturenuri option:selected').val();
            var password = $("#culturenuri_card_password").val();
        
            var valBirth   = $('#culturenuri_card_birthday').val();  //생년월일/사업자번호 숫자만 입력
            var valMonth   = $('#culturenuri_card_mm').val();  //유효기간 숫자만 입력
            var valYear    = $('#culturenuri_card_yy').val();  //유효기간 숫자만 입력
        
            if ( useCnt == 0 ) {
                //할인 적용할 매수를 선택하세요.
                gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
                return;
            }
        
            if (cardNo == "" || cardNo.length < 10) {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            if (password == "") {
                gfn_alertMsgBox('비밀번호 2자리 이상 입력하세요.');
                $("#culturenuri_card_password").focus();
                return;
            }
        
            if (valMonth == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#culturenuri_card_mm').focus();
                return;
            }
        
            if (valYear == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#culturenuri_card_yy').focus();
                return;
            }
        
            if (valBirth == "") {
                gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
                $('#culturenuri_card_birthday').focus();
                return;
            }
        
            var option = { cardNo:cardNo,
                           password:password, valMonth:valMonth, valYear:valYear, valBirth:valBirth, useCnt:useCnt,
                           preDisc:'Y',  discType:'CULTURE'};
        
            //최종결제 금액 유효성 검사 및 결제 처리
            chkLastPayAmt(option);
        
        }
        </script>
        
            <!-- 레이어 : 문화누리 카드 -->
            <input type="hidden" id="culturenuriCardNum_hid">
            <section id="layer_mnuri" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">문화누리 카드<!-- 문화누리 카드 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="reset">
                              문화누리 카드 정보를 입력해주세요.<!-- 문화누리 카드 정보를 입력해주세요. -->
                        </div>
        
                        <div class="popup-gray mid-info-box">
                            <div class="pop-search-area">
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="mnuri_card_num">카드번호<!-- 카드번호 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" title="문화누리 카드번호 입력" class="input-text w180px x-small" id="culturenuriCardNum" maxlength="20">
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="mnuri_card_num_card_date">카드유효기간<!-- 카드유효기간 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" id="culturenuri_card_mm" title="문화누리 카드 유효기간 월 입력" placeholder="MM" class="input-text w60px x-small a-c" maxlength="2"> /
                                        <input type="text" id="culturenuri_card_yy" title="문화누리 유효기간 년 입력" placeholder="YY" class="input-text w60px x-small a-c" maxlength="2">
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="culturenuri_card_password">비밀번호<!-- 비밀번호 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" id="culturenuri_card_password" title="문화누리 카드 비밀번호 입력" class="input-text w60px x-small pwnew" maxlength="2">
                                        <span class="font-gray ml05 font-size-13">앞 2자리<!-- 앞 2자리 --></span>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line gray">
                                    <p class="sh-txt reset vt"><label for="mnuri_card_birthday">생년월일<!-- 생년월일 --></label></p>
                                    <div class="sh-input mr0">
                                        <input type="text" id="culturenuri_card_birthday" title="문화누리 카드 생년월일 입력" class="input-text w80px x-small" maxlength="10">
        
                                        <p class="reset inline-block font-size-13 font-gray ml05">생년월일 6자리(카드소유자)<!-- 생년월일 6자리(카드소유자) --></p>
                                    </div>
                                    <button type="button" class="button gray x-small ml07" id="btn_select_culturenuri">조회<!-- 조회 --></button>
                                </div>
                            </div>
                        </div>
        
                        <div class="pop-util mb15">
                            <ul>
                                <li>
                                    <p class="vm">적용매수<!-- 적용매수 --></p>
                                </li>
                                <li class="a-r">
                                    <select title="문화누리 적용매수 선택" class="w120px x-small" id="selCulturenuri">
                                        <option value="0">선택<!-- 선택 --></option>
                                    </select>
                                </li>
                            </ul>
                        </div>
        
                        <div class="box-border v1 use-guide">
                            <p class="tit">이용안내<!-- 이용안내 --></p>
        
                            <ul class="dot-list gray">
                                <li>장당 2,500원 할인(동반 1인), 문화누리카드로만 결제 가능<!-- 장당 2,500원 할인(동반 1인), 문화누리카드로만 결제 가능 --></li>
                                <li>일반관 2D/3D 성인, 청소년 정상가 선택 시 할인 적용 가능<!-- 일반관 2D/3D 성인, 청소년 정상가 선택 시 할인 적용 가능 --></li>
                                <li>문화누리카드 잔액 부족 시 결제 불가<!-- 문화누리카드 잔액 부족 시 결제 불가 --></li>
                                <li>타 제휴 및 쿠폰 할인 중복사용 불가<!-- 타 제휴 및 쿠폰 할인 중복사용 불가 --></li>
                            </ul>
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer" id="btn_close_culturenuri">닫기<!-- 닫기 --></button>
                        <button type="button" class="button small purple" id="btn_cancel_apply_culturenuri" style="display:none;">적용취소<!-- 적용취소 --></button>
                        <button type="button" class="button small purple" id="btn_apply_culturenuri">적용<!-- 적용 --></button>
        
                    </div>
        
                    <button type="button" class="btn-modal-close" id="btn_close_modal_culturenuri">레이어 닫기<!-- 레이어 닫기 --></button>
                </div>
            </section>
            <!-- // 레이어 : 문화누리 카드 -->
            <!-- // 레이어 : 문화누리 카드 -->
        
            <!-- 레이어 : GS&POINT -->
            
        
        
        
        
        
        <script type="text/javascript">
        var gsnPointChgInfo = new Object();
        
        //초기화 공통 sMethodName.init
        function gsnp_init() {  //gs포인트 전체초기화
            setInitGsnPoint();
            gsnPointChgInfo = new Object();
        
            $('#gsnPointCardNum').val('');
            $('#gsnPointCardNum_hid').val('');
            $('#gsnPointUseAbleAmt').text('0');
            $('#gs_card_pwd').val('');
        }
        
        $(function() {
            //숫자만 입력가능
            $('#gsnPointCardNum').megaBoxCardNumberCheck();  //생년월일/사업자번호 숫자만 입력
        
            //조회버튼 클릭
            $('#btn_select_gsnp').on('click', function() {
                searchGsnPoint();
            });
        
            //gs포인트 적용
            $('#btn_apply_gsnp').on('click', function() {
                applyGsnPoint();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_gsnp').on('click', function() {
                var sMethodName = "gsnp";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                 $('#layer_gs_point .close-layer').click();
            });
        
            //닫기버튼 클릭
            $('#btn_close_gsnp, #btn_close_modal_gsnp').on('click', function() {
                if (!$('#btn_cancel_apply_gsnp').is(':visible')) {
                    gsnp_init();
                }
            });
        });
        
        
        //gs포인트 초기화
        function setInitGsnPoint() {
            $('#selGsnPoint > option').remove();
            $('#selGsnPoint').append('<option value="0">선택</option>');
        }
        
        //gs포인트 조회
        function searchGsnPoint() {
            var transNo    = $("#transNo").val();
            var cardNo     = $("#gsnPointCardNum_hid").val().replaceAll('-', '').nvlNum(0);
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_gsnp').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo == "" || cardNo.length < 10) {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            var paramData  = {transNo:transNo, cardNo:cardNo};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/searchGsPoint.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //쿠폰 전역변수 세팅
                  gsnPointChgInfo = data.gsPointInfo;
        
                  //쿠폰 목록 세팅
                  setGsPointChg(gsnPointChgInfo);
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
              , beforeSend : function() {
                  $('#btn_select_gsnp').prop("disabled", true);
                  $('#btn_select_gsnp').addClass('disabled');
                }
                , complete : function() {
                  setTimeout(function(){
                         $('#btn_select_gsnp').removeClass('disabled');
                         $('#btn_select_gsnp').prop("disabled", false);
                  },1500);
                }
            });
        }
        
        //gs포인트 목록 세팅
        function setGsPointChg(cponInfo) {
            setInitGsnPoint();
            var cponListText = "";
        
            $('#gsnPointUseAbleAmt').text(String(cponInfo.useAbleAmt).maskNumber());
        
            var cponList = cponInfo.comboList;
            var useAmt   = 0;
            for(var i=0;i<cponList.length;i++) {
                useAmt += cponList[i].useAmt;
                  cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
                $('#selGsnPoint').append(cponListText);
            }
        }
        
        //gs포인트 적용
        function applyGsnPoint() {
        
            var transNo  = $("#transNo").val();
            var cardNo     = $("#gsnPointCardNum_hid").val().replaceAll('-', '').nvlNum(0);
            var useCnt   = $('#selGsnPoint option:selected').val();
            var password = $("#gs_card_pwd").val();
        
            if ( useCnt == 0 ) {
                //할인 적용할 매수를 선택하세요.
                gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
                return;
            }
        
            if (cardNo == "" || cardNo.length < 10) {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            if (password == "") {
                gfn_alertMsgBox('비밀번호 4자리 이상 입력하세요.');
                $("#gs_card_pwd").focus();
                return;
            }
        
            var paramData  = {transNo:transNo, cardNo:cardNo, useCnt:useCnt, password:password};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/applyGsPoint.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //할인내역 갱신
                  setMovieDcInfo(data.policyList);
        
                  $('#btn_cancel_gsnp').show(); //취소버튼
                  $('#btn_cancel_apply_gsnp').show(); //적용취소버튼
        
                  //닫기버튼 클릭
                  $('#layer_gs_point .close-layer').click();
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
            });
        }
        </script>
        
            <!-- 레이어 : GS&POINT -->
            <input type="hidden" id="gsnPointCardNum_hid">
            <section id="layer_gs_point" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">GS&amp;POINT</h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="reset">
                            GS&amp;POINT 카드 정보를 입력해주세요.<!-- 카드 정보를 입력해주세요. -->
                        </div>
        
                        <div class="popup-gray mid-info-box">
                            <div class="pop-search-area">
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="gsnPointCardNum_1">카드번호<!-- 카드번호 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" title="GS&amp;POINT 카드번호 입력" class="input-text w180px x-small" id="gsnPointCardNum" maxlength="20">
                                        <button type="button" class="button gray x-small ml05" id="btn_select_gsnp">포인트 조회<!-- 포인트 조회 --></button>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset">사용가능 포인트<!-- 사용가능 포인트 --></p>
        
                                    <div class="sh-input">
                                        <div class="sh-input">
                                            <em id="gsnPointUseAbleAmt" class="font-gblue">0</em> 점<!-- 점 -->
                                        </div>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset">적용 매수 선택<!-- 적용 매수 선택 --></p>
        
                                    <div class="sh-input">
                                        <select title="GS 포인트 적용 매수 선택" class="w100px x-small" id="selGsnPoint">
                                            <option value="0">선택<!-- 선택 --></option>
                                        </select>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="gs_card_pwd">비밀번호<!-- 비밀번호 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" id="gs_card_pwd" title="GS&amp;POINT 카드 비밀번호 입력" class="input-text w100px x-small pwnew" maxlength="15">
                                    </div>
                                </div>
                            </div>
                        </div>
        
                        <div class="box-border v1 use-guide">
                            <p class="tit">이용안내<!-- 이용안내 --></p>
        
                            <ul class="dot-list gray">
                                <li>장당 2,000포인트 차감 할인(1일 최대 8매)<!-- 장당 2,000포인트 차감 할인(1일 최대 8매) --></li>
                                <li>우대, 문화의날 및 특별콘텐트 이용불가<!-- 우대, 문화의날 및 특별콘텐트 이용불가 --></li>
                            </ul>
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer" id="btn_close_gsnp">닫기<!-- 닫기 --></button>
                        <button type="button" class="button small purple" id="btn_cancel_apply_gsnp" style="display:none;">적용취소<!-- 적용취소 --></button>
                        <button type="button" class="button small purple" id="btn_apply_gsnp">적용<!-- 적용 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close" id="btn_close_modal_gsnp">레이어 닫기<!-- 레이어 닫기 --></button>
                </div>
            </section>
            <!--// 레이어 : GS&POINT -->
            <!--// 레이어 : GS&POINT -->
        
            <!-- 레이어 : 현대오일뱅크 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var hyOilChgInfo = new Object();
        
        //초기화 공통 sMethodName.init
        function hyoil_init() {  //현대오일뱅크 전체초기화
            setInitHyOil();
            hyOilChgInfo = new Object();
        
            $('#hyOilCardNum').val('');
            $('#hyOilCardNum_hid').val('');
            $('#hyOilUseAbleAmt').text('0');
            $('#ho_card_pwd').val('');
        }
        
        $(function() {
            //숫자만 입력가능
            $('#hyOilCardNum').megaBoxCardNumberCheck();
        
            //조회버튼 클릭
            $('#btn_select_hyoil').on('click', function() {
                searchHyOil();
            });
        
            //gs포인트 적용
            $('#btn_apply_hyoil').on('click', function() {
                applyHyOil();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_hyoil').on('click', function() {
                var sMethodName = "hyoil";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                 $('#layer_oilbank .close-layer').click();
            });
        
            //닫기버튼 클릭
            $('#btn_close_hyoil, #btn_close_modal_hyoil').on('click', function() {
                if (!$('#btn_cancel_apply_hyoil').is(':visible')) {
                    hyoil_init();
                }
            });
        });
        
        
        //현대오일뱅크 포인트 초기화
        function setInitHyOil() {
            $('#selHyOil > option').remove();
            $('#selHyOil').append('<option value="0">선택</option>');
        }
        
        //현대오일뱅크 조회
        function searchHyOil() {
            var transNo   = $("#transNo").val();
            var cardNo    = $("#hyOilCardNum_hid").val().replaceAll('-', '').nvlNum(0);
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_hyoil').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo == "" || cardNo.length < 10) {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            var paramData  = {transNo:transNo, cardNo:cardNo};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/searchHyunOilBank.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //쿠폰 전역변수 세팅
                  hyOilChgInfo = data.hOilPointInfo;
        
                  //쿠폰 목록 세팅
                  setHyOilChg(hyOilChgInfo);
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
              , beforeSend : function() {
                  $('#btn_select_hyoil').prop("disabled", true);
                  $('#btn_select_hyoil').addClass('disabled');
                }
                , complete : function() {
                  setTimeout(function(){
                         $('#btn_select_hyoil').removeClass('disabled');
                         $('#btn_select_hyoil').prop("disabled", false);
                  },1500);
                }
            });
        }
        
        //현대오일뱅크 목록 세팅
        function setHyOilChg(cponInfo) {
            setInitHyOil();
            var cponListText = "";
        
            $('#hyOilUseAbleAmt').text(String(cponInfo.useAbleAmt).maskNumber());
        
            var cponList = cponInfo.comboList;
            var useAmt   = 0;
            for(var i=0;i<cponList.length;i++) {
                useAmt += cponList[i].useAmt;
                  cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
                $('#selHyOil').append(cponListText);
            }
        }
        
        //현대오일뱅크 적용
        function applyHyOil() {
        
            var transNo  = $("#transNo").val();
            var cardNo    = $("#hyOilCardNum_hid").val().replaceAll('-', '').nvlNum(0);
            var useCnt   = $('#selHyOil option:selected').val();
            var password = $("#ho_card_pwd").val();
        
            if ( useCnt == 0 ) {
                //할인 적용할 매수를 선택하세요.
                gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
                return;
            }
        
            if (cardNo == "" || cardNo.length < 10) {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            if (password == "") {
                gfn_alertMsgBox('비밀번호 4자리 이상 입력하세요.');
                $("#gs_card_pwd").focus();
                return;
            }
        
            var paramData  = {transNo:transNo, cardNo:cardNo, useCnt:useCnt, password:password};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/applyHyunOilBank.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //할인내역 갱신
                  setMovieDcInfo(data.policyList);
        
                  $('#btn_cancel_hyoil').show(); //취소버튼
                  $('#btn_cancel_apply_hyoil').show(); //적용취소버튼
        
                  //닫기버튼 클릭
                  $('#layer_oilbank .close-layer').click();
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
            });
        }
        </script>
        
            <!-- 레이어 : 현대오일뱅크 -->
            <input type="hidden" id="hyOilCardNum_hid">
            <section id="layer_oilbank" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">현대오일뱅크<!-- 현대오일뱅크 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="reset">
                             현대오일뱅크 카드 정보를 입력해주세요.<!-- 현대오일뱅크 카드 정보를 입력해주세요. -->
                        </div>
        
                        <div class="popup-gray mid-info-box">
                            <div class="pop-search-area">
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="ho_card_num">카드번호<!-- 카드번호 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" title="현대오일뱅크 카드번호 입력" class="input-text w180px x-small" id="hyOilCardNum" maxlength="20">
        
                                        <button type="button" class="button gray x-small ml05" id="btn_select_hyoil">포인트 조회<!-- 포인트 조회 --></button>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset">사용가능 한포인트<!-- 사용가능 한포인트 --></p>
        
                                    <div class="sh-input">
                                        <em class="font-gblue" id="hyOilUseAbleAmt">0</em> 점<!-- 점 -->
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset">적용 매수 선택<!-- 적용 매수 선택 --></p>
        
                                    <div class="sh-input">
                                        <select title="현대오일뱅크 포인트 적용 매수 선택" class="w100px x-small" id="selHyOil">
                                            <option value="0">선택<!-- 선택 --></option>
                                        </select>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="ho_card_pwd">비밀번호<!-- 비밀번호 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" id="ho_card_pwd" title="현대오일뱅크 카드 비밀번호 입력" class="input-text w100px x-small pwnew">
                                    </div>
                                </div>
                            </div>
                        </div>
        
                        <div class="box-border v1 use-guide">
                            <p class="tit">이용안내<!-- 이용안내 --></p>
        
                            <ul class="dot-list gray">
                                <li>장당 2,000포인트 차감 할인(1일 최대 4매)<!-- 장당 2,000포인트 차감 할인(1일 최대 4매) --></li>
                                <li>우대, 문화의날 및 특별콘텐트 이용불가<!-- 우대, 문화의날 및 특별콘텐트 이용불가 --></li>
                            </ul>
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer" id="btn_close_hyoil">닫기<!-- 닫기 --></button>
                        <button type="button" class="button small purple" id="btn_cancel_apply_hyoil" style="display:none;">적용취소<!-- 적용취소 --></button>
                        <button type="button" class="button small purple" id="btn_apply_hyoil">적용<!-- 적용 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close" id="btn_close_modal_hyoil">레이어 닫기<!-- 레이어 닫기 --></button>
                </div>
            </section>
            <!--// 레이어 : 현대오일뱅크 -->
            <!--// 레이어 : 현대오일뱅크 -->
        
            <!-- 레이어 : 해피포인트 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var happPointChgInfo = new Object();
        
        //초기화 공통 sMethodName.init
        function happ_init() {  //스마트콘 전체초기화
            setInitHappPoint();
            happPointChgInfo = new Object();
        
            $('#happPointCardNum').val('');
            $('#happPointCardNum_hid').val('');
            $('#happUseAbleAmt').text('0');
        }
        
        $(function() {
            //숫자만 입력가능
            $("#happPointCardNum").megaBoxCardNumberCheck();
        
            //조회버튼 클릭
            $('#btn_select_happ').on('click', function() {
                searchHappPoint();
            });
        
            //해피포인트 적용
            $('#btn_apply_happ').on('click', function() {
                applyHappPoint();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_happ').on('click', function() {
                var sMethodName = "happ";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                 $('#layer_happypoint .close-layer').click();
            });
        
            //닫기버튼 클릭
            $('#btn_close_happ, #btn_close_modal_happ').on('click', function() {
                if (!$('#btn_cancel_apply_happ').is(':visible')) {
                    happ_init();
                }
            });
        });
        
        
        //해피포인트 초기화
        function setInitHappPoint() {
            $('#selHappPoint > option').remove();
            $('#selHappPoint').append('<option value="0">선택</option>');
        }
        
        //해피포인트 조회
        function searchHappPoint() {
            var transNo    = $("#transNo").val();
            var cardNo     = $("#happPointCardNum_hid").val().replaceAll('-', '').nvlNum(0);;
            var paramData  = {transNo:transNo, cardNo:cardNo };
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_happ').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo == "" || cardNo.length < 10) {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/searchHappyPoint.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //쿠폰 전역변수 세팅
                  happPointChgInfo = data.happPointInfo;
        
                  //쿠폰 목록 세팅
                  setHappPointChg(happPointChgInfo);
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
              , beforeSend : function() {
                  $('#btn_select_happ').prop("disabled", true);
                  $('#btn_select_happ').addClass('disabled');
                }
                , complete : function() {
                  setTimeout(function(){
                         $('#btn_select_happ').removeClass('disabled');
                         $('#btn_select_happ').prop("disabled", false);
                  },1500);
                }
            });
        }
        
        //해피포인트 목록 세팅
        function setHappPointChg(cponInfo) {
            setInitHappPoint();
            var cponListText = "";
        
            $('#happUseAbleAmt').text(String(cponInfo.useAbleAmt).maskNumber());
        
            var cponList = cponInfo.comboList;
            var useAmt   = 0;
            for(var i=0;i<cponList.length;i++) {
                useAmt += cponList[i].useAmt;
                  cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
                $('#selHappPoint').append(cponListText);
            }
        }
        
        //해피포인트 적용
        function applyHappPoint() {
        
            var transNo = $("#transNo").val();
            var cardNo     = $("#happPointCardNum_hid").val().replaceAll('-', '').nvlNum(0);;
            var useCnt  = $('#selHappPoint option:selected').val();
        
            if ( useCnt == 0 ) {
                //할인 적용할 매수를 선택하세요.
                gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
                return;
            }
        
            if (cardNo == "" || cardNo.length < 10) {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            var paramData  = {transNo:transNo, cardNo:cardNo, useCnt:useCnt};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/applyHappyPoint.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //할인내역 갱신
                  setMovieDcInfo(data.policyList);
        
                  $('#btn_cancel_happ').show(); //취소버튼
                  $('#btn_cancel_apply_happ').show(); //적용취소버튼
        
                  //닫기버튼 클릭
                  $('#layer_happypoint .close-layer').click();
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
            });
        }
        </script>
        
            <!-- 레이어 : 해피포인트 -->
            <input type="hidden" id="happPointCardNum_hid">
            <section id="layer_happypoint" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">해피포인트<!-- 해피포인트 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="reset">
                             해피포인트 카드 정보를 입력해주세요.<!-- 해피포인트 카드 정보를 입력해주세요. -->
                        </div>
        
                        <div class="popup-gray mid-info-box">
                            <div class="pop-search-area">
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="happy_card_num">카드번호<!-- 카드번호 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" title="해피포인트 카드번호 입력" class="input-text w180px x-small" id="happPointCardNum" maxlength="20">
        
                                        <button type="button" class="button gray x-small ml05" id="btn_select_happ">포인트 조회<!-- 포인트 조회 --></button>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset">사용가능 한포인트<!-- 사용가능 한포인트 --></p>
        
                                    <div class="sh-input">
                                        <em class="font-gblue" id="happUseAbleAmt">0</em> 점<!-- 점 -->
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset">적용 매수 선택<!-- 적용 매수 선택 --></p>
        
                                    <div class="sh-input">
                                        <select title="해피포인트 포인트 적용 매수 선택" class="w100px x-small" id="selHappPoint">
                                            <option value="0">선택<!-- 선택 --></option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>
        
                        <div class="box-border v1 use-guide mt15">
                            <p class="tit">이용안내<!-- 이용안내 --></p>
        
                            <ul class="dot-list gray">
                                <li>장당 2,000포인트 차감 할인<!-- 장당 2,000포인트 차감 할인 --></li>
                                <li>우대, 문화의날 및 특별콘텐트 이용불가<!-- 우대, 문화의날 및 특별콘텐트 이용불가 --></li>
                            </ul>
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer" id="btn_close_happ">닫기<!-- 닫기 --></button>
                        <button type="button" class="button small purple" id="btn_cancel_apply_happ" style="display:none;">적용취소<!-- 적용취소 --></button>
                        <button type="button" class="button small purple" id="btn_apply_happ">적용<!-- 적용 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close" id="btn_close_modal_happ">레이어 닫기<!-- 레이어 닫기 --></button>
                </div>
            </section>
            <!--// 레이어 : 해피포인트 -->
            <!--// 레이어 : 해피포인트 -->
        
            <!-- 레이어 : 블루멤버스 포인트 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var hbPointChgInfo = new Object();
        
        //초기화 공통 sMethodName.init
        function hbluep_init() {  //현대블루멤버스 전체초기화
            setInitHbPoint();
            hbPointChgInfo = new Object();
        
            $('#hbPointCardNum').val('');
            $('#hbPointCardNum_hid').val('');
            $('#hbPointUseAbleAmt').text('0');
            $('#bluemembers_card_pwd').val('');
        }
        
        $(function() {
            //숫자만 입력가능
            $('#hbPointCardNum').megaBoxCardNumberCheck();
        
            //조회버튼 클릭
            $('#btn_select_hbluep').on('click', function() {
                searchHbPoint();
            });
        
            //블루포인트 적용
            $('#btn_apply_hbluep').on('click', function() {
                applyHbPoint();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_hbluep').on('click', function() {
                var sMethodName = "hbluep";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                 $('#layer_bluemembers .close-layer').click();
            });
        
            //닫기버튼 클릭
            $('#btn_close_hbluep, #btn_close_modal_hbluep').on('click', function() {
                if (!$('#btn_cancel_apply_hbluep').is(':visible')) {
                    hbluep_init();
                }
            });
        });
        
        
        //현대블루멤버스 초기화
        function setInitHbPoint() {
            $('#selHbPoint > option').remove();
            $('#selHbPoint').append('<option value="0">선택</option>');
        }
        
        //현대블루멤버스 조회
        function searchHbPoint() {
            var transNo    = $("#transNo").val();
            var cardNo     = $("#hbPointCardNum_hid").val().replaceAll('-', '').nvlNum(0);
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_hbluep').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo == "" || cardNo.length < 10) {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            var paramData  = {transNo:transNo, cardNo:cardNo };
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/searchHyunBluePoint.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //쿠폰 전역변수 세팅
                  hbPointChgInfo = data.bluePointInfo;
        
                  //쿠폰 목록 세팅
                  setHbPointChg(hbPointChgInfo);
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
              , beforeSend : function() {
                  $('#btn_select_hbluep').prop("disabled", true);
                  $('#btn_select_hbluep').addClass('disabled');
                }
                , complete : function() {
                  setTimeout(function(){
                         $('#btn_select_hbluep').removeClass('disabled');
                         $('#btn_select_hbluep').prop("disabled", false);
                  },1500);
                }
            });
        }
        
        //현대블루멤버스 목록 세팅
        function setHbPointChg(cponInfo) {
            setInitHbPoint();
            var cponListText = "";
        
            $('#hbPointUseAbleAmt').text(String(cponInfo.useAbleAmt).maskNumber());
        
            var cponList = cponInfo.comboList;
            var useAmt   = 0;
            for(var i=0;i<cponList.length;i++) {
                useAmt += cponList[i].useAmt;
                  cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
                $('#selHbPoint').append(cponListText);
            }
        }
        
        //현대블루멤버스 적용
        function applyHbPoint() {
        
            var transNo  = $("#transNo").val();
            var cardNo   = $("#hbPointCardNum_hid").val().replaceAll('-', '').nvlNum(0);
            var useCnt   = $('#selHbPoint option:selected').val();
            var password = $("#bluemembers_card_pwd").val();
        
            if ( useCnt == 0 ) {
                //할인 적용할 매수를 선택하세요.
                gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
                return;
            }
        
            if (cardNo == "" || cardNo.length < 10) {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            if (password == "") {
                gfn_alertMsgBox('비밀번호 4자리 이상 입력하세요.');
                $("#gs_card_pwd").focus();
                return;
            }
        
            var paramData  = {transNo:transNo, cardNo:cardNo, useCnt:useCnt, password:password};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/applyHyunBluePoint.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //할인내역 갱신
                  setMovieDcInfo(data.policyList);
        
                  $('#btn_cancel_hbluep').show(); //취소버튼
                  $('#btn_cancel_apply_hbluep').show(); //적용취소버튼
        
                  //닫기버튼 클릭
                  $('#layer_bluemembers .close-layer').click();
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
            });
        }
        </script>
        
            <!-- 레이어 : 블루멤버스 포인트 -->
            <input type="hidden" id="hbPointCardNum_hid">
            <section id="layer_bluemembers" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">블루멤버스 포인트<!-- 블루멤버스 포인트 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="reset">
                             블루멤버스 포인트 카드 정보를 입력해주세요.<!-- 블루멤버스 포인트 카드 정보를 입력해주세요. -->
                        </div>
        
                        <div class="popup-gray mid-info-box">
                            <div class="pop-search-area">
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="bluemembers_card_num">카드번호<!-- 카드번호 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" title="블루멤버스 포인트 카드번호 입력" class="input-text w180px x-small" id="hbPointCardNum" maxlength="20">
        
                                        <button type="button" class="button gray x-small ml05" id="btn_select_hbluep">포인트 조회<!-- 포인트 조회 --></button>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset">사용가능 한포인트<!-- 사용가능 한포인트 --></p>
        
                                    <div class="sh-input">
                                        <em class="font-gblue" id="hbPointUseAbleAmt">0</em> 점<!-- 점 -->
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset">적용 매수 선택<!-- 적용 매수 선택 --></p>
        
                                    <div class="sh-input">
                                        <select title="블루멤버스 적용 매수 선택" class="w100px x-small" id="selHbPoint">
                                            <option value="0">선택<!-- 선택 --></option>
                                        </select>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="bluemembers_card_pwd">비밀번호<!-- 비밀번호 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" id="bluemembers_card_pwd" title="블루멤버스 포인트 카드 비밀번호 입력" class="input-text w120px x-small pwnew">
                                    </div>
                                </div>
                            </div>
                        </div>
        
                        <div class="box-border v1 use-guide mt15">
                            <p class="tit">이용안내<!-- 이용안내 --></p>
        
                            <ul class="dot-list gray">
                                <li>장당 4,000포인트 차감 할인(1일 최대 8매)<!-- 장당 4,000포인트 차감 할인(1일 최대 8매) --></li>
                                <li>우대, 문화의날 및 특별콘텐트 이용불가<!-- 우대, 문화의날 및 특별콘텐트 이용불가 --></li>
                            </ul>
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer" id="btn_close_hbluep">닫기<!-- 닫기 --></button>
                        <button type="button" class="button small purple" id="btn_cancel_apply_hbluep" style="display:none;">적용취소<!-- 적용취소 --></button>
                        <button type="button" class="button small purple" id="btn_apply_hbluep">적용<!-- 적용 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close" id="btn_close_modal_hbluep">레이어 닫기<!-- 레이어 닫기 --></button>
                </div>
            </section>
            <!--// 레이어 : 블루멤버스 포인트 -->
        
            <!--// 레이어 : 블루멤버스 포인트 -->
        
            <!-- 레이어 : 중앙멤버십 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var joongangChgInfo = new Object();
        
        //초기화 공통 sMethodName.init
        function joongang_init() {  //중앙멤버십 전체초기화
            setInitJoongang();
            joongangChgInfo = new Object();
        
            $('#joongangCardNum').val('');
            $('#joongangCardNum_hid').val('');
            $('#joongangUseAbleAmt').text('0');
            $('#joongangUseAbleText').text('');
        }
        
        $(function() {
            //숫자만 입력가능
            $('#joongangCardNum').megaBoxCardNumberCheck();
        
            //조회버튼 클릭
            $('#btn_select_joongang').on('click', function() {
                searchJoongang();
            });
        
            //중앙멤버십 적용
            $('#btn_apply_joongang').on('click', function() {
                applyJoongang();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_joongang').on('click', function() {
                var sMethodName = "joongang";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                 $('#layer_jmembership .close-layer').click();
            });
        
            //닫기버튼 클릭
            $('#btn_close_joongang, #btn_close_modal_joongang').on('click', function() {
                if (!$('#btn_cancel_apply_joongang').is(':visible')) {
                    joongang_init();
                }
            });
        });
        
        
        //중앙멤버십 포인트 초기화
        function setInitJoongang() {
            $('#joongangUseAbleAmt').text('0');
            $('#joongangUseAbleText').text('');
        
            $('#selJoongang > option').remove();
            $('#selJoongang').append('<option value="0">선택</option>');
        }
        
        //중앙멤버십 조회
        function searchJoongang() {
            var transNo   = $("#transNo").val();
            var cardNo    = $("#joongangCardNum_hid").val();
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_joongang').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo == "") {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            var paramData  = {transNo:transNo, cardNo:cardNo};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/searchJoongAngMem.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //쿠폰 전역변수 세팅
                  joongangChgInfo = data.jjMemInfo;
        
                  //쿠폰 목록 세팅
                  setJoongangChg(joongangChgInfo);
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
              , beforeSend : function() {
                  $('#btn_select_joongang').prop("disabled", true);
                  $('#btn_select_joongang').addClass('disabled');
                }
                , complete : function() {
                  setTimeout(function(){
                         $('#btn_select_joongang').removeClass('disabled');
                         $('#btn_select_joongang').prop("disabled", false);
                  },1500);
                }
            });
        }
        
        //중앙멤버십 목록 세팅
        function setJoongangChg(cponInfo) {
            setInitJoongang();
            var cponListText = "";
        
            $('#joongangUseAbleAmt').text(String(cponInfo.useAbleAmt).maskNumber());
        
            var availableTxt = '';
            if (String(cponInfo.useAbleAmt) > "0") {
                availableTxt = '사용가능';/* 사용가능 */
            } else {
                availableTxt = '사용불가';/* 사용불가 */
            }
        
            $('#joongangUseAbleText').text(availableTxt);
        
            var cponList = cponInfo.comboList;
            var useAmt   = 0;
            for(var i=0;i<cponList.length;i++) {
                useAmt += cponList[i].useAmt;
                  cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
                $('#selJoongang').append(cponListText);
            }
        }
        
        //중앙멤버십 적용
        function applyJoongang() {
        
            var transNo  = $("#transNo").val();
            var cardNo   = $("#joongangCardNum_hid").val();
            var useCnt   = $('#selJoongang option:selected').val();
        
            if (cardNo == "") {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            if ( useCnt == 0 ) {
                //할인 적용할 매수를 선택하세요.
                gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
                return;
            }
        
            var paramData  = {transNo:transNo, cardNo:cardNo,useCnt:useCnt};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/applyJoongAng.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //할인내역 갱신
                  setMovieDcInfo(data.policyList);
        
                  $('#btn_cancel_joongang').show(); //취소버튼
                  $('#btn_cancel_apply_joongang').show(); //적용취소버튼
        
                  //닫기버튼 클릭
                  $('#layer_jmembership .close-layer').click();
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
            });
        }
        </script>
        
        <!-- 레이어 : 중앙멤버십 -->
        <input type="hidden" id="joongangCardNum_hid">
        <section id="layer_jmembership" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
            <div class="wrap">
                <header class="layer-header">
                    <h3 class="tit">중앙멤버십<!-- 중앙멤버십 --></h3>
                </header>
        
                <div class="layer-con">
                    <div class="reset">
                        멤버십카드 정보를 입력해주세요.<!-- 멤버십카드 정보를 입력해주세요. -->
                    </div>
        
                    <div class="popup-gray mid-info-box mb15">
                        <div class="pop-search-area">
                            <div class="pop-search-area-line">
                                <p class="sh-txt reset"><label for="jmembership_card_num">카드번호<!-- 카드번호 --></label></p>
        
                                <div class="sh-input">
                                    <input type="text" title="중앙멤버십 카드번호 입력" class="input-text w200px x-small" maxlength="20" id="joongangCardNum">
                                </div>
        
                                <div class="sh-btn gray">
                                    <button type="button" class="button x-small gray" id="btn_select_joongang">조회<!-- 조회 --></button>
                                </div>
                            </div>
        
                            <div class="pop-search-area-line">
                                <p class="sh-txt reset">사용여부<!-- 사용여부 --></p>
                                <span class="font-green" id="joongangUseAbleText"></span>
                            </div>
        
                            <div class="pop-search-area-line">
                                <p class="sh-txt reset">사용가능금액<!-- 사용가능금액 --></p>
                                <span class="font-green" id="joongangUseAbleAmt">0</span> 점<!-- 점 -->
                            </div>
        
                            <div class="pop-search-area-line">
                                <p class="sh-txt reset vt"><label for="hyundai_m_point_card_ticket_counting">적용 매수 선택</label></p>
                                <div class="sh-input mr0">
        
                                    <select title="중앙멤버십 선택" class="w120px v1 x-small" id="selJoongang">
                                        <option value="0">선택<!-- 선택 --></option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
        
                    <div class="box-border v1">
                        <p class="tit">이용안내<!-- 이용안내 --></p>
        
                            <ul class="dot-list gray">
                                <li>장당 1,000원 할인(연 24회)<!-- 장당 1,000원 할인(연 24회) --></li>
                                <li>우대/문화의날 및 특별콘텐트 이용불가<!-- 우대/문화의날 및 특별콘텐트 이용불가 --></li>
                            </ul>
                    </div>
                </div>
        
                <div class="btn-group-fixed">
                    <button type="button" class="button small close-layer" id="btn_close_joongang">닫기 <!-- 닫기 --></button>
                    <button type="button" class="button small purple" id="btn_cancel_apply_joongang" style="display:none;">적용취소 <!-- 적용취소 --></button>
                    <button type="button" class="button small purple" id="btn_apply_joongang">적용 <!-- 적용 --></button>
                </div>
        
                <button type="button" class="btn-modal-close" id="btn_close_modal_joongang">레이어 닫기<!-- 레이어 닫기 --></button>
            </div>
        </section>
        <!--// 레이어 : 중앙멤버십 -->
        
            <!--// 레이어 : 중앙멤버십 -->
        
            <!-- 레이어 : 중앙패밀리포인트 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var jfamilyChgInfo = new Object();
        
        //초기화 공통 sMethodName.init
        function jfamily_init() {  //중앙패밀리 전체초기화
            setInitJfamily();
            jfamilyChgInfo = new Object();
        
            $('#jfamilyUseAbleAmt').text('0');
        }
        
        $(function() {
        
            //조회버튼 클릭
            $('#btn_select_jfamily').on('click', function() {
                searchJfamily();
            });
        
            //블루포인트 적용
            $('#btn_apply_jfamily').on('click', function() {
                applyJfamily();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_jfamily').on('click', function() {
                var sMethodName = "jfamily";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                 $('#layer_jfpoint .close-layer').click();
            });
        });
        
        
        //중앙패밀리 초기화
        function setInitJfamily() {
            $('#selJfamily > option').remove();
            $('#selJfamily').append('<option>선택</option>');
        }
        
        //중앙패밀리 조회
        function searchJfamily() {
            var transNo    = $("#transNo").val();
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_jfamily').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            //추후 중앙 그룹ID 적용 필요
            var paramData  = {transNo:transNo, usrId:parent.usrId};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/searchJoongAngFamily.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //쿠폰 전역변수 세팅
                  jfamilyChgInfo = data.jfamilyInfo;
        
                  //쿠폰 목록 세팅
                  setJfamilyChg(jfamilyChgInfo);
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
            });
        }
        
        //중앙패밀리 목록 세팅
        function setJfamilyChg(cponInfo) {
            setInitJfamily();
            var cponListText = "";
        
            $('#jfamilyUseAbleAmt').text(String(cponInfo.useAbleAmt).maskNumber());
            $('#jfamilyTicketCnt').val(String(cponInfo.ticketCnt));
        
            var cponList = cponInfo.comboList;
            var useAmt   = 0;
            for(var i=0;i<cponList.length;i++) {
                useAmt += cponList[i].useAmt;
                  cponListText =  '<option value="'+cponList[i].useCnt+'">'+cponList[i].useCnt+'매'+' (-'+String(useAmt).maskNumber()+')</option>';
                $('#selJfamily').append(cponListText);
            }
            $('#selJfamily').selectpicker('refresh');
        }
        
        //중앙패밀리 적용
        function applyJfamily() {
        
            var transNo   = $("#transNo").val();
            var useCnt    = $('#selJfamily option:selected').val();
            var ticketCnt = $('#jfamilyTicketCnt').val();
        
            if ( useCnt == 0 ) {
                //할인 적용할 매수를 선택하세요.
                gfn_alertMsgBox('할인 적용할 매수를 선택하세요.');
                return;
            }
        
            if (ticketCnt != useCnt) {
                //예매할 티켓 만큼 매수를 선택해주세요.
                gfn_alertMsgBox('예매할 티켓 만큼 매수를 선택해주세요.');
                return;
            }
        
            //사용건수와 티켓건수 상이시 오류(내용에 전체 건수 포함 전달 필요)
            var paramData  = {transNo:transNo, useCnt:useCnt, usrId:parent.usrId};
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/applyJoongAngFamily.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //할인내역 갱신
                  setMovieDcInfo(data.policyList);
        
                  $('#btn_cancel_jfamily').show(); //취소버튼
                  $('#btn_cancel_apply_jfamily').show(); //적용취소버튼
        
                  //닫기버튼 클릭
                  $('#layer_jfpoint .close-layer').click();
        
                  //chkLastPayAmt();
        
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
            });
        }
        </script>
        <input type="hidden" id="jfamilyTicketCnt" name="jfamilyTicketCnt">
            <!-- 레이어 : 중앙 패밀리 포인트 -->
            <section id="layer_jfpoint" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">중앙패밀리 포인트<!-- 중앙멤버십 포인트 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="reset">
                            회원님께서 보유하고 있는 포인트를 조회 및 적용하는 페이지입니다.<!-- 회원님께서 보유하고 있는 포인트를 조회 및 적용하는 페이지입니다. -->
                        </div>
        
                        <div class="popup-gray mid-info-box">
                            <div class="pop-search-area">
                                <div class="pop-search-area-line" style="display:none">
                                    <p class="sh-txt reset">사용가능한 포인트<!-- 사용가능한 포인트 --></p>
        
                                    <div class="sh-input">
                                        <button type="button" class="button gray x-small" id="btn_select_jfamily">조회<!-- 조회 --></button>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset">사용가능한 포인트<!-- 사용가능 한포인트 --></p>
        
                                    <div class="sh-input">
                                        <em id="jfamilyUseAbleAmt" class="font-gblue">0</em> Point
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="before_sale_card_date">적용 매수 선택<!-- 적용 매수 선택 --></label></p>
        
                                    <div class="sh-input">
                                        <div class="dropdown bootstrap-select x-small bs3"><select title="중앙 패밀리 포인트 매수 선택" class="selectpicker x-small" id="selJfamily" tabindex="-98"><option class="bs-title-option" value=""></option>
                                            <option>선택<!-- 선택 --></option>
                                        </select><button type="button" class="btn dropdown-toggle btn-default bs-placeholder" data-toggle="dropdown" role="button" data-id="selJfamily" title="중앙 패밀리 포인트 매수 선택"><div class="filter-option"><div class="filter-option-inner"><div class="filter-option-inner-inner">중앙 패밀리 포인트 매수 선택</div></div> </div><span class="bs-caret"><span class="caret"></span></span></button><div class="dropdown-menu open" role="combobox"><div class="inner open" role="listbox" aria-expanded="false" tabindex="-1"><ul class="dropdown-menu inner "></ul></div></div></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer">닫기<!-- 닫기 --></button>
                        <button type="button" class="button small purple" id="btn_cancel_apply_jfamily" style="display:none;">적용취소<!-- 적용취소 --></button>
                        <button type="button" class="button small purple" id="btn_apply_jfamily">적용<!-- 적용 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close">레이어 닫기<!-- 레이어 닫기 --></button>
                </div>
            </section>
            <!--// 레이어 : 중앙 패밀리 포인트 -->
        
            <!--// 레이어 : 중앙패밀리포인트 -->
        
            <!-- 레이어 : ok 캐쉬백 -->
            
        
        
        
        
        
        <script type="text/javascript">
        
        var okCashInfo = new Object();
        
        //초기화 공통 sMethodName.init
        function okcb_init() {
            setInitStoreChg();
            okCashInfo = new Object();
            $("#okCashbagCardNum").val('');
            $("#okCashbagCardNum_hid").val('');
            $("#spn_okcb_useable_amt").text('0');
            $("#okcashbagUsePoint").val('');
            $("#okcashbagUsePwd").val('');
            $("#okcashbagPreUsePoint").val('');
            $("#okcashbag_save_back").prop('checked', false);
        }
        
        
        $(function() {
            //숫자만 입력가능
            $("#okCashbagCardNum").megaBoxCardNumberCheck();
        
            //사용할포인트
            $("#okcashbagUsePoint").megaBoxCommaNumberCheck();
        
            //조회버튼 클릭
            $('#btn_select_okcb').on('click', function() {
                searchOkCashBag();
            });
        
            //적용버튼 클릭
            $('#btn_apply_okcb').on('click', function() {
                applyOkCashBag();
            });
        
            //모두사용 클릭
            $('#btn_all_use_okcb').on('click', function() {
                useAllOkCashBag();
            });
        
            //적용취소버튼 클릭
            $('#btn_cancel_apply_okcb').on('click', function() {
                var sMethodName = "okcb";
                cancelMbxSellCpInfo(sMethodName);
        
                //닫기버튼 클릭
                   $('#layer_okcashbag .close-layer').click();
            });
        
            //닫기버튼 클릭
            $('#btn_close_okcb, #btn_close_modal_okcb').on('click', function() {
                if (!$('#btn_cancel_apply_okcb').is(':visible')) {
                    okcb_init();
                }
            });
        
        });
        
        //ok캐쉬백 모두사용
        function useAllOkCashBag() {
        
            var useAbleAmt = $("#spn_okcb_useable_amt").text().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
            var remainAmt  = $('.pay-area > .pay').eq(0).find('.money').find('em').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
        
            if (parseInt(useAbleAmt ) == 0) {
                //조회 후 사용 가능합니다.
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                $("#okCashbagCardNum").focus();
                return;
            }
        
            var maxAmt = useAbleAmt;
            if (parseInt(useAbleAmt) > parseInt(remainAmt)) {
                maxAmt = remainAmt;
            }
        
            maxAmt = parseInt(maxAmt /100) * 100;
            $("#okcashbagUsePoint").val(String(maxAmt).maskNumber());
        }
        
        //ok캐쉬백 조회
        function searchOkCashBag() {
            var transNo    = $("#transNo").val();
            var cardNo     = $("#okCashbagCardNum_hid").val();
            var paramData  = {transNo:transNo,cardNo:cardNo };
        
            //기존에 적용된 동일 수단이 있으면 초기화 후 재조회
            if ($('#btn_cancel_apply_okcb').is(':visible')) {
                //이미 적용된 결제 수단은 재조회 할 수 없습니다. \\n[적용 취소]후 재조회 할 수 있습니다.
                gfn_alertMsgBox('이미 적용된 결제 수단은 재조회 할 수 없습니다. \n[적용 취소]후 재조회 할 수 있습니다.');
                return;
            }
        
            if (cardNo == "") {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                $("#okCashbagCardNum").focus();
                return;
            }
        
            if (cardNo.length < 15) {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                $("#okCashbagCardNum").focus();
                return;
            }
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/searchOkCashBag.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //쿠폰 전역변수 세팅
                    okCashInfo = data.okCashInfo;
        
                    $('#spn_okcb_useable_amt').text( String(okCashInfo.useAbleAmt).maskNumber() );
                    $("#okcashbagPreUsePoint").val('');	//이전사용금액 초기화
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
                , beforeSend : function() {
                    $('#btn_select_okcb').prop("disabled", true);
                    $('#btn_select_okcb').addClass('disabled');
                }
                , complete : function() {
                    setTimeout(function(){
                           $('#btn_select_okcb').removeClass('disabled');
                           $('#btn_select_okcb').prop("disabled", false);
                    },1500);
                }
            });
        }
        
        
        //ok캐쉬백 적용
        function applyOkCashBag() {
            var transNo    = $("#transNo").val();
            var cardNo     = $("#okCashbagCardNum_hid").val();
            var useAmt     = $("#okcashbagUsePoint").val().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
            var useAbleAmt = $("#spn_okcb_useable_amt").text().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
            var remainAmt  = $('.pay-area > .pay').eq(0).find('.money').find('em').text().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
            var saveOk     = $("#okcashbag_save_back").prop("checked")==true?"Y":"N";
            var preUseAmt  = $("#okcashbagPreUsePoint").val().replaceAll(',', '').replaceAll('-', '').nvlNum(0);
        
            remainAmt = parseInt(remainAmt) + parseInt(preUseAmt);	//이전 사용금액이 있는 경우 잔여금액에 이전 사용금액 포함
        
            //카드번호 체크
            if (cardNo == "") {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                $("#okCashbagCardNum").focus();
                return;
            }
        
            if (cardNo.length < 15) {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                $("#okCashbagCardNum").focus();
                return;
            }
        
            if (parseInt(useAbleAmt) == 0) {
                //OK 캐쉬백 사용가능 포인트 조회 후 사용 가능합니다.
                gfn_alertMsgBox('OK 캐쉬백 사용가능 포인트 조회 후 사용 가능합니다.');
                return;
            }
        
        
            if (parseInt(useAmt) == 0) {
                //OK 캐쉬백 사용가능 포인트 조회 후 사용 가능합니다.
                gfn_alertMsgBox('사용 포인트를 입력하세요.');
                $("#okcashbagUsePoint").focus();
                return;
            }
        
        
            if (parseInt(useAbleAmt) < 1000) {
                //OK 캐쉬백 포인트 1,000점 이상 보유 시 사용 가능합니다.
                gfn_alertMsgBox('OK 캐쉬백 포인트 1,000점 이상 보유 시 사용 가능합니다.');
                return;
            }
        
        
            if (parseInt(useAmt) % 100 != 0) {
                //OK 캐쉬백 포인트 100점 단위로 사용 가능합니다.
                gfn_alertMsgBox('OK 캐쉬백 포인트 100점 단위로 사용 가능합니다.');
                $("#okcashbagUsePoint").focus();
                return;
            }
        
            if (parseInt(useAmt) > parseInt(remainAmt)) {
                //사용 포인트가 결제 금액보다 큽니다.
                gfn_alertMsgBox('사용 포인트가 결제 금액보다 큽니다.');
                $("#okcashbagUsePoint").focus();
                return;
            }
        
            var password = $("#okcashbagUsePwd").val();
        
            if (password.length < 6) {
                //비밀번호 6자리 이상 입력하세요
                gfn_alertMsgBox('비밀번호 6자리 이상 입력하세요.');
                $("#okcashbagUsePwd").focus();
                return;
            }
        
            var paramData = { cardNo:cardNo, password:password, useAmt:useAmt, transNo:transNo, saveOk:saveOk};
        
            $.ajax({
                url: "/on/oh/ohz/PayBooking/applyOkCashBag.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data: JSON.stringify(paramData),
                success: function (data, textStatus, jqXHR) {
                    //console.log(data);
                    if (!msgBookingLoginChk(data)) {
                        return;
                    }
        
                    //할인내역 갱신
                    setMovieDcInfo(data.policyList);
        
                    $('#btn_cancel_okcb').show(); //취소버튼
                    $('#btn_cancel_apply_okcb').show(); //적용취소버튼
        
                    $('#okcashbagPreUsePoint').val($("#okcashbagUsePoint").val()); //취소버튼
        
                    //닫기버튼 클릭
                    $('#layer_okcashbag .close-layer').click();
                },
                error: function(xhr,status,error){
                    var err = JSON.parse(xhr.responseText);
                    //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                    errBookingChk(err.msg);
                }
            });
        
        }
        </script>
        
            <!-- 레이어 : ok 캐쉬백 -->
            <input type="hidden" id="okCashbagCardNum_hid">
            <section id="layer_okcashbag" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">OK 캐쉬백 <!-- OK 캐쉬백 --></h3>
                    </header>
        
                    <div class="layer-con">
        
                        <div class="reset">
                            OK 캐쉬백 카드 정보를 입력해주세요. <!-- OK 캐쉬백 카드 정보를 입력해주세요. -->
                        </div>
        
                        <div class="popup-gray mid-info-box mb10">
                            <div class="pop-search-area line-wid">
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="okCashbagCardNum">카드번호 <!-- 카드번호 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" id="okCashbagCardNum" title="OK 캐쉬백 카드번호 입력" class="input-text w200px x-small" maxlength="20"><!-- OK 캐쉬백 카드번호 입력 -->
                                    </div>
        
                                    <div class="sh-btn">
                                        <button type="button" class="button x-small gray" id="btn_select_okcb">조회 <!-- 조회 --></button>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset">사용가능한 포인트 <!-- 사용가능한 포인트 --></p>
                                    <span class="font-green" id="spn_okcb_useable_amt">0</span> Point
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="okcashbagUsePoint">사용할 포인트 <!-- 사용할 포인트 --></label></p>
                                    <input type="text" id="okcashbagUsePoint" title="사용할 ok 캐쉬백 포인트 입력" class="input-text w120px mr05 x-small" maxlength="10"> Point <!-- 사용할 ok 캐쉬백 포인트 입력 -->
                                    <input type="hidden" id="okcashbagPreUsePoint">
        
                                    <div class="sh-btn ml05">
                                        <button type="button" class="button gray-line x-small" id="btn_all_use_okcb">모두사용 <!-- 모두사용 --></button>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="okcashbagUsePwd">비밀번호 <!-- 비밀번호 --></label></p>
                                    <input type="text" id="okcashbagUsePwd" title="" class="input-text w120px x-small pwnew" maxlength="15"> <!-- ok 캐쉬백 카드 비밀번호 입력 -->
                                </div>
        
                            </div>
                        </div>
        
                        <div class="a-r mb20">
                            <input type="checkbox" id="okcashbag_save_back">
                            <label for="okcashbag_save_back">동일 카드로 적립 <!-- 동일 카드로 적립 --></label>
                        </div>
        
                        <div class="box-border v1 use-guide mt10">
                            <p class="tit">이용안내 <!-- 이용안내 --></p>
        
                            <ul class="dot-list gray">
                                <li><b>OK캐쉬백 사용없이 적립만 진행할 경우 예매완료 후 상영일까지 ‘MY &gt; 예매내역’ 에서 추후적립 하실 수 있습니다.</b> <!-- OK캐쉬백 사용없이 적립만 진행할 경우 예매완료 후 상영일까지 ‘MY > 예매내역’에서 추후적립 하실 수 있습니다. --></li>
                                <li>OK캐쉬백 1,000점 이상 보유 시 100점 단위로 사용가능 <!-- OK캐쉬백 1,000점 이상 보유 시 100점 단위로 사용가능 --></li>
                                <li>OK캐쉬백 적립 : 최종 결제금액의 2% 적립 <!-- OK캐쉬백 적립 : 최종 결제금액의 2% 적립 --></li>
                                <li>고객님의 안전한 포인트 사용을 위하여 온라인 비밀번호로 변경하셔야 합니다. <br>(숫자, 문자, 특수문자 조합 6~16자리) <!-- 고객님의 안전한 포인트 사용을 위하여 온라인 비밀번호로 변경하셔야 합니다. <br />(숫자, 문자, 특수문자 조합 6~16자리) --></li>
                            </ul>
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer" id="btn_close_okcb">닫기 <!-- 닫기 --></button>
                        <button type="button" class="button small purple" id="btn_cancel_apply_okcb" style="display:none;">적용취소 <!-- 적용취소 --></button>
                        <button type="button" class="button small purple" id="btn_apply_okcb">적용 <!-- 적용 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close" id="btn_close_modal_okcb">레이어 닫기 <!-- 레이어 닫기 --></button>
                </div>
            </section>
            <!--// 레이어 : ok 캐쉬백 -->
        
        
        
        
            <!--// 레이어 : ok 캐쉬백 -->
        
            <!-- 레이어 : 리아결제 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var tellerChgInfo = new Object();
        
        //초기화 공통 sMethodName.init
        function teller_init() {  //상담원결제 전체초기화
            setInitTeller();
        
            $('#tellerCardNum_1').val('');
            $('#tellerCardNum_2').val('');
            $('#tellerCardNum_3').val('');
            $('#tellerCardNum_4').val('');
        
            $('#teller_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
            $('#teller_card_mm').val('');
            $('#teller_card_yy').val('');
            $('#teller_card_birthday').val('');
            $('#teller_card_password').val('');
        
            var remainAmt = $('.pay-area > .pay').eq(0).find('.money').find('em').text().replaceAll(',', '');
            $('.ria-finish-box > .right > b').text(String(remainAmt).maskNumber());
        }
        
        
        $(function() {
            //숫자만 입력가능
            $('#tellerCardNum_1').megaBoxNumberCheck();
            $('#tellerCardNum_2').megaBoxNumberCheck();
            $('#tellerCardNum_3').megaBoxNumberCheck();
            $('#tellerCardNum_4').megaBoxNumberCheck();
            $('#teller_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
            $('#teller_card_mm').megaBoxNumberCheck();  //유효기간 숫자만 입력
            $('#teller_card_yy').megaBoxNumberCheck();  //유효기간 숫자만 입력
        
            //상담원예매 결제 버튼 클릭
            $("#btn_teller_booking").on('click', function() {
                payTeller();
            });
        
            //상담원예매 초기화 버튼 클릭
            $("#btn_teller_init").on('click', function() {
                teller_init();
            });
        
            //상담원예매 카드정보 불러오기 버튼 클릭
            $("#btn_teller_Card_Info").on('click', function() {
                tellerCardInfo();
            });
        
        });
        
        
        //상담원 결제 초기화
        function setInitTeller() {
            $('#teller_install > option:eq(0)').attr('selected', 'selected');
        }
        
        
        //상담원예매 카드정보 불러오기 버튼 클릭
        function tellerCardInfo(){
            var paramData   = { in_param1:parent.riaParamReciveTime};
        
        
            $.ajaxMegaBox({
                url    : "/on/oh/ohz/PayBooking/selectTellerCardInfo.do",
                data   : JSON.stringify(paramData),
                success: function(result){
        
                    if("0" != result.statCd){
                        gfn_alertMsgBoxSize(result.msg,400,250);    //예매가능한 날짜가 아닙니다.
                    }
                    else {
                        var decBirthDay         = result.resultMap.decBirthDay;
                        var decCardNo           = result.resultMap.decCardNo;
                        var decCardNo1          = decCardNo.substring(0,4);
                        var decCardNo2          = decCardNo.substring(4,8);
                        var decCardNo3          = decCardNo.substring(8,12);
                        var decCardNo4          = decCardNo.substring(12,16);;
                        var decCardExpireDate   = result.resultMap.decCardExpireDate;
                        var decCardExpireDateYy = decCardExpireDate.substring(0,2);
                        var decCardExpireDateMm = decCardExpireDate.substring(2,4);;
                        var decCardAuth         = result.resultMap.decCardAuth;
        
                        //console.log(decCardNo, decCardExpireDate);
        
                        $('#tellerCardNum_1').val(decCardNo1);
                        $('#tellerCardNum_2').val(decCardNo2);
                        $('#tellerCardNum_3').val(decCardNo3);
                        $('#tellerCardNum_4').val(decCardNo4);
                        $('#teller_card_birthday').val(decBirthDay);
                        $('#teller_card_mm').val(decCardExpireDateMm);
                        $('#teller_card_yy').val(decCardExpireDateYy);
                        $('#teller_card_password').val(decCardAuth);
        
                    }
        
                }
                , beforeSend : function() {
                    $('#btn_teller_Card_Info').prop("disabled", true);
                    $('#btn_teller_Card_Info').addClass('disabled');
                }
                , complete : function() {
                    setTimeout(function(){
                           $('#btn_teller_Card_Info').removeClass('disabled');
                           $('#btn_teller_Card_Info').prop("disabled", false);
                    },1500);
                }
        
            });
        
        }
        
        //상담원 결제
        function payTeller() {
            var cardNo1  = $("#tellerCardNum_1").val();
            var cardNo2  = $("#tellerCardNum_2").val();
            var cardNo3  = $("#tellerCardNum_3").val();
            var cardNo4  = $("#tellerCardNum_4").val();
            var cardNo   = cardNo1 + cardNo2 + cardNo3 + cardNo4;
            var Installment  = $('#teller_install option:selected').val();
            var password = $("#teller_card_password").val();
        
            var valBirth   = $('#teller_card_birthday').val();  //생년월일/사업자번호 숫자만 입력
            var valMonth   = $('#teller_card_mm').val();  //유효기간 숫자만 입력
            var valYear    = $('#teller_card_yy').val();  //유효기간 숫자만 입력
            var teller_fee = $('#chk_teller_fee').prop('checked')==true?"Y":"N";
        
            if (cardNo1 == "" || cardNo2 == "" || cardNo3 == "" || cardNo4 == "") {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            if (password == "") {
                gfn_alertMsgBox('비밀번호 2자리 이상 입력하세요.');
                $("#teller_card_password").focus();
                return;
            }
        
            if (valMonth == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#teller_card_mm').focus();
                return;
            }
        
            if (valYear == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#teller_card_yy').focus();
                return;
            }
        
            if (valBirth == "") {
                gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
                $('#teller_card_birthday').focus();
                return;
            }
        
            var option = { cardNo1:cardNo1,cardNo2:cardNo2,cardNo3:cardNo3,cardNo4:cardNo4,cardNo:cardNo,
                           password:password, valMonth:valMonth, valYear:valYear, valBirth:valBirth, Installment:Installment,
                           preDisc:'Y',  discType:'TELLER', tellerFee:teller_fee};
        
            $('#lastPayMethod').val('credit');
            $('#preDisc').val('Y');
            $('#discType').val('TELLER');
            $('#tellerFee').val(teller_fee);
        
            //최종결제 금액 유효성 검사 및 결제 처리
            chkLastPayAmt(option);
        
        }
        </script>
        
            <!-- 레이어  : 리아 결제 -->
            <section id="layer_ria" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">신용/체크 카드 <!-- 신용/체크 카드 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="pop-tit pb30">
                            <button type="button" class="button small right mr125" id="btn_teller_init"> <i class="iconset ico-reset-small"></i>새로입력 <!-- 새로입력 --></button>
                            <button type="button" class="button small right" id="btn_teller_Card_Info">카드정보 불러오기 <!-- 카드정보 불러오기 --></button>
                        </div>
        
                        <div class="popup-gray mid-info-box">
                            <div class="pop-search-area">
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="ria_card_num">카드번호 <!-- 카드번호 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" id="tellerCardNum_1" title="체크/신용카드 카드번호 첫번째자리 입력" class="input-text x-small w60px" maxlength="4"><!-- 체크/신용카드 카드번호 첫번째자리 입력 --> -
                                        <input type="text" id="tellerCardNum_2" title="체크/신용카드 카드번호 두번째자리 입력" class="input-text w60px x-small " maxlength="4"> <!-- 체크/신용카드 카드번호 두번째자리 입력 --> -
                                        <input type="number" id="tellerCardNum_3" title="체크/신용카드 카드번호 세번째자리 입력" class="input-text w60px x-small pwnew" maxlength="4" oninput="gfn_numberMaxLength(this);"> <!-- 체크/신용카드 카드번호 세번째자리 입력 --> -
                                        <input type="text" id="tellerCardNum_4" title="체크/신용카드 카드번호 네번째자리 입력" class="input-text w60px x-small " maxlength="4"><!-- 체크/신용카드 카드번호 네번째자리 입력 -->
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="teller_card_mm">유효기간 <!-- 유효기간 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" id="teller_card_mm" title="체크/신용카드 유효기간 월 입력" placeholder="MM" class="input-text w60px  x-small a-c" maxlength="2"><!-- 체크/신용카드 유효기간 월 입력 --> /
                                        <input type="text" id="teller_card_yy" title="체크/신용카드 유효기간 년 입력" placeholder="YY" class="input-text w60px x-small a-c" maxlength="2"><!-- 체크/신용카드 유효기간 년 입력 -->
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="teller_card_password">비밀번호 <!-- 비밀번호 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" id="teller_card_password" title="체크/신용카드 비밀번호 앞 2자리 입력" class="input-text w130px x-small pwnew" maxlength="2"><!-- 체크/신용카드 비밀번호 앞 2자리 입력 -->
                                        <span class="font-size-13 font-gray ml05">앞 2자리</span><!-- 앞 2자리 -->
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line gray">
                                    <p class="sh-txt reset vt"><label for="teller_card_birthday">생년월일 <!-- 생년월일 --></label></p>
                                    <div class="sh-input mr0">
                                        <input type="text" id="teller_card_birthday" title="체크/신용카드 생년월일 입력" class="input-text w130px x-small pwnew" maxlength="10"><!-- 체크/신용카드 생년월일 입력 -->
        
                                        <p class="reset inline-block font-size-13 ml05 font-gray">생년월일 6자리(카드소유자) / 사업자번호 10자리 <!-- 생년월일 6자리(카드소유자) / 사업자번호 10자리 --></p>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="teller_install">할부 <!-- 할부 --></label></p>
        
                                    <div class="sh-input">
                                        <select name="" id="teller_install" class="small w130px">
                                            <option value="00">일시불 <!-- 일시불 --></option>
                                            
                                                
                                                    
                                                
                                                
                                                <option value="02">2 개월 <!-- 개월 --></option>
                                            
                                                
                                                    
                                                
                                                
                                                <option value="03">3 개월 <!-- 개월 --></option>
                                            
                                                
                                                    
                                                
                                                
                                                <option value="04">4 개월 <!-- 개월 --></option>
                                            
                                                
                                                    
                                                
                                                
                                                <option value="05">5 개월 <!-- 개월 --></option>
                                            
                                                
                                                    
                                                
                                                
                                                <option value="06">6 개월 <!-- 개월 --></option>
                                            
                                                
                                                    
                                                
                                                
                                                <option value="07">7 개월 <!-- 개월 --></option>
                                            
                                                
                                                    
                                                
                                                
                                                <option value="08">8 개월 <!-- 개월 --></option>
                                            
                                                
                                                    
                                                
                                                
                                                <option value="09">9 개월 <!-- 개월 --></option>
                                            
                                                
                                                
                                                    
                                                
                                                <option value="10">10 개월 <!-- 개월 --></option>
                                            
                                                
                                                
                                                    
                                                
                                                <option value="11">11 개월 <!-- 개월 --></option>
                                            
                                                
                                                
                                                    
                                                
                                                <option value="12">12 개월 <!-- 개월 --></option>
                                            
                                        </select>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="ria_select">수수료 적용 <!-- 수수료 적용 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="checkbox" id="chk_teller_fee">
                                        <label for="chk_teller_fee">수수료 함께 결제시 체크해주세요 <!-- 수수료 함께 결제시 체크해주세요 --></label>
                                    </div>
                                </div>
                            </div>
                        </div>
        
                        <div class="ria-finish-box">
                            <span class="left">최종결제금액 <!-- 최종결제금액 --></span>
                            <span class="right"><b>&nbsp;</b> <em>원 <!-- 원 --></em></span>
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer" id="btn_cancel_teller_booking">취소 <!-- 취소 --></button>
                        <button type="button" class="button small purple" id="btn_teller_booking">결제 <!-- 결제 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close">레이어 닫기 <!-- 레이어 닫기 --></button>
                </div>
            </section>
        
            <!--// 레이어 : 리아결제 -->
        
            <!-- 레이어 : 현금영수증 -->
            
        
        
        
        
        
        <script type="text/javascript">
        
        var precash_option;
        
        $(function() {
        
            //숫자만 입력가능
            $("#cashBillPhoneNo").megaBoxNumberCheck();
        
            //닫기 클릭 이벤트
            $('#btn_bill_close').on('click', function() {
                /*
                if ($('#cashBillPhoneNo').val().length < 10) {
                    gfn_alertMsgBox('휴대폰 번호를 입력해 주세요.');	//휴대폰 번호를 입력해 주세요.
                    $('#cashBillPhoneNo').focus();
                    return false;
                }
                */
        
                $('#cashBillYn').val('Y');
                $('#cashrecIssueCd').val('SELFPRN');	//자진발급
        
                //예매번호 생성
                payBokdNoProc(precash_option);
            });
        
            //즉시발급 클릭 이벤트
            $('#btn_bill_print').on('click', function() {
                var msg = "";
                if ($(":radio[name='bizmDivCd']:checked").val() == "PERSON") {
                    msg = "휴대폰 번호를 입력해 주세요.";	//휴대폰 번호를 입력해 주세요.
                } else {
                    msg = "사업자번호를 입력해 주세요.";	//사업자 번호를 입력해 주세요.
                }
        
                if ($('#cashBillPhoneNo').val() == "") {
                    gfn_alertMsgBox(msg);
                    $('#cashBillPhoneNo').focus();
                    return false;
                }
        
                if ($(":radio[name='bizmDivCd']:checked").val() == "PERSON") {
                    if ($('#cashBillPhoneNo').val().length < 10) {
                        gfn_alertMsgBox("올바른 휴대폰 번호를 입력해 주세요.");
                        $('#cashBillPhoneNo').focus();
                        return false;
                    }
                } else {
                    if ($('#cashBillPhoneNo').val().length != 10) {
                        gfn_alertMsgBox("올바른 사업자번호를 입력해 주세요.");
                        $('#cashBillPhoneNo').focus();
                        return false;
                    }
                }
        
                $('#cashBillYn').val('Y');
                $('#cashrecIssueCd').val('GERNPRN');	//일반발급
        
                //예매번호 생성
                payBokdNoProc(precash_option);
            });
        
            //레이어 닫기 이벤트
            $('#btn_bill_layer_close').on('click', function() {
                /*
                if ($('#cashBillPhoneNo').val().length < 10) {
                    gfn_alertMsgBox('휴대폰 번호를 입력해 주세요.');	//휴대폰 번호를 입력해 주세요.
                    $('#cashBillPhoneNo').focus();
                    return false;
                }
                */
        
                $('#cashBillYn').val('Y');
                $('#cashrecIssueCd').val('SELFPRN');	//자진발급
        
                //예매번호 생성
                payBokdNoProc(precash_option);
            });
        });
        
        
        </script>
            <!-- 레이어 : 현금영수증 -->
            <section id="layer_cash_bill" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">현금영수증 발급 <!-- 현금영수증 발급 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="pop-tit">
                            현금영수증 발행을 위해 아래 정보를 입력해 주세요. <!-- 현금영수증 발행을 위해 아래 정보를 입력해 주세요. -->
                        </div>
        
                        <div class="popup-gray mid-info-box mb15">
                            <div class="pop-search-area line-sht">
                                <div class="pop-search-area-line ">
                                    <p class="sh-txt reset">금액 <!-- 금액 --></p>
                                    <strong id="cashBillAmt">12,000</strong>원 <!-- 원 -->
                                </div>
        
                                <div class="pop-search-area-line longline">
                                    <p class="sh-txt reset">거래구분 <!-- 거래구분 --></p>
        
                                    <div class="sh-input">
                                        <div>
                                            <span>
                                                <input type="radio" id="radio_cash_bill01" name="bizmDivCd" checked="checked" value="PERSON">
                                                <label for="radio_cash_bill01">개인소득공제용 <!-- 개인소득공제용 --></label>
                                            </span>
        
                                            <span class="ml20">
                                                <input type="radio" id="radio_cash_bill02" name="bizmDivCd" value="BIZM">
                                                <label for="radio_cash_bill02">사업자증빙용 <!-- 사업자증빙용 --></label>
                                            </span>
                                        </div>
        
                                        <div class="mt05">
        
                                            <!-- 개인소득공제용 선택되었을때 -->
                                            <input type="text" title="휴대폰 번호 입력" class="input-text w200px" maxlength="20" id="cashBillPhoneNo" name="cashBillPhoneNo"><!-- 휴대폰 번호 입력 -->
                                            <span class="ml10">휴대폰 번호를 입력해 주세요. <!-- 휴대폰 번호를 입력해 주세요. --></span>
        
                                            <!--사업자증빙용 선택되었을때 -->
                                            <!--
                                            <input type="text" title="사업자 번호 입력" class="input-text w200px">
                                            <span class="ml10">사업자 번호를 입력해 주세요.</span>
                                             -->
                                            <!-- //사업자증빙용 선택되었을때 -->
                                        </div>
                                    </div>
        
                                </div>
                            </div>
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer" id="btn_bill_close">자진발급 <!-- 자진발급 --></button>
                        <button type="button" class="button small purple close-layer" id="btn_bill_print">즉시발급 <!-- 즉시발급 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close" id="btn_bill_layer_close">레이어 닫기 <!-- 레이어 닫기 --></button>
                </div>
            </section>
            <!--// 레이어 : 현금영수증 -->
        
        
            <!--// 레이어 : 현금영수증 -->
        
            <!-- 레이어 : 즉시할인 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var preDiscChgInfo = new Object();
        
        //초기화 공통 sMethodName.init
        function pre_disc_init() {  //선할인 전체초기화
            setInitPreDisc();
            preDiscChgInfo = new Object();
        
            $('#preDiscCardNum_1').val('');
            $('#preDiscCardNum_2').val('');
            $('#preDiscCardNum_3').val('');
            $('#preDiscCardNum_4').val('');
            $('#preDiscUseAbleAmt').val('0');
        
            $('#pre_disc_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
            $('#pre_disc_card_mm').val('');
            $('#pre_disc_card_yy').val('');
            $('#pre_disc_birthday').val('');
            $('#pre_disc_password').val('');
            $('#chk_pre_disc_agree').prop('checked');
            $('#pre_disc_all_text').text('');
        }
        
        
        $(function() {
            pre_disc_init();
        
            //숫자만 입력가능
            $('#preDiscCardNum_1').megaBoxNumberCheck();
            $('#preDiscCardNum_2').megaBoxNumberCheck();
            $('#preDiscCardNum_3').megaBoxNumberCheck();
            $('#preDiscCardNum_4').megaBoxNumberCheck();
        
            $('#pre_disc_birthday').megaBoxNumberCheck();
            $('#pre_disc_card_mm').megaBoxNumberCheck();
            $('#pre_disc_card_yy').megaBoxNumberCheck();
        
            //조회버튼 클릭
            $('#btn_pre_disc').on('click', function() {
                searchPreDisc();
            });
        
            //선할인 적용
            $('#btn_pay_pre_disc').on('click', function() {
                applyPreDisc();
            });
        
        });
        
        
        //선할인 포인트 초기화
        function setInitPreDisc() {
            $('#preDiscUseAbleAmt').val('0');
            $('#pre_disc_all_text').text('');
        }
        
        
        //선할인 조회
        function searchPreDisc() {
            var transNo    = $("#transNo").val();
            var cardNo1    = $("#preDiscCardNum_1").val();
            var cardNo2    = $("#preDiscCardNum_2").val();
            var cardNo3    = $("#preDiscCardNum_3").val();
            var cardNo4    = $("#preDiscCardNum_4").val();
        
            var cardNo     = cardNo1 + cardNo2 + cardNo3 + cardNo4;
        
            var valBirth   = $('#pre_disc_birthday').val(); //생년월일/사업자번호 숫자만 입력
            var valMonth   = $('#pre_disc_card_mm').val();  //유효기간 숫자만 입력
            var valYear    = $('#pre_disc_card_yy').val();  //유효기간 숫자만 입력
        
            var preDisc    = $('#preDisc').val();   //선할인여부
            var discType   = $('#discType').val();  //선할인타입(BC)
            var payAmt     = $('.pay-area > .pay').eq(0).find('.money').find('em').text().replaceAll(',', '');
        
            if (cardNo1 == "" || cardNo2 == "" || cardNo3 == "" || cardNo4 == "") {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            if (valMonth == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#pre_disc_card_mm').focus();
                return;
            }
        
            if (valYear == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#pre_disc_card_yy').focus();
                return;
            }
        
            if (valBirth == "") {
                gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
                $('#pre_disc_birthday').focus();
                return;
            }
        
        
            var paramData = {
                              cardNo1:cardNo1,
                              cardNo2:cardNo2,
                              cardNo3:cardNo3,
                              cardNo4:cardNo4,
                              cardNo:cardNo,
                              transNo:transNo,
                              valMonth:valMonth,
                              valYear:valYear,
                              valBirth:valBirth,
                              preDisc:preDisc,
                              discType:discType,
                              payAmt:payAmt
                            };
        
            $.ajax({
              url: "/on/oh/ohz/PayBooking/searchPreDiscPoint.do",
              type: "POST",
              contentType: "application/json;charset=UTF-8",
              dataType: "json",
              data: JSON.stringify(paramData),
              success: function (data, textStatus, jqXHR) {
                  //console.log(data);
                if (!msgBookingLoginChk(data)) {
                    return;
                }
        
                  //쿠폰 전역변수 세팅
                  preDiscChgInfo = data.preDiscInfo;
        
                  //쿠폰 목록 세팅
                  setPreDiscChg(preDiscChgInfo);
              },
              error: function(xhr,status,error){
                  var err = JSON.parse(xhr.responseText);
                  //err.statCd 에 따라서 이전화면으로 리턴 가능토록
                  errBookingChk(err.msg);
              }
              , beforeSend : function() {
                  $('#btn_pre_disc').prop("disabled", true);
                  $('#btn_pre_disc').addClass('disabled');
                }
                , complete : function() {
                  setTimeout(function(){
                         $('#btn_pre_disc').removeClass('disabled');
                         $('#btn_pre_disc').prop("disabled", false);
                  },1500);
                }
            });
        }
        
        //선할인 목록 세팅
        function setPreDiscChg(cponInfo) {
            setInitPreDisc();
        
            var remainAmt = $('.pay-area > .pay').eq(0).find('.money').find('em').text().replaceAll(',', '');;
            var discAmt   = cponInfo.useAbleAmt;
        
            if (discAmt == 0) {
                //선할인 대상 카드가 아닙니다.
                gfn_alertMsgBox('선할인 대상 카드가 아닙니다.');
                return;
            }
        
            var payAmt    = parseInt(remainAmt) - parseInt(discAmt);
        
            var cponListText = "";
            cponListText += String(remainAmt).maskNumber() + '원 - ' + String(discAmt).maskNumber() + '원 = ';
            cponListText += String(payAmt).maskNumber() + '원';
        
            $('#pre_disc_all_text').text(cponListText);
            $('#preDiscUseAbleAmt').val(cponInfo.useAbleAmt);
        }
        
        //선할인 적용
        function applyPreDisc() {
            var transNo    = $("#transNo").val();
            var cardNo1    = $("#preDiscCardNum_1").val();
            var cardNo2    = $("#preDiscCardNum_2").val();
            var cardNo3    = $("#preDiscCardNum_3").val();
            var cardNo4    = $("#preDiscCardNum_4").val();
            var cardNo     = cardNo1 + cardNo2 + cardNo3 + cardNo4;
        
            var valBirth   = $('#pre_disc_birthday').val();  //생년월일/사업자번호 숫자만 입력
            var valMonth   = $('#pre_disc_card_mm').val();  //유효기간 숫자만 입력
            var valYear    = $('#pre_disc_card_yy').val();  //유효기간 숫자만 입력
            var password   = $('#pre_disc_password').val(); //비밀번호
            var preDisc    = $('#preDisc').val();   //선할인여부
            var discType   = $('#discType').val();  //선할인타입(BC)
        
            if ($('#pre_disc_all_text').text() == '') {
                gfn_alertMsgBox('선할인 금액 조회 후 결제 가능합니다.');
                return;
            }
        
            if (cardNo1 == "" || cardNo2 == "" || cardNo3 == "" || cardNo4 == "") {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            if (password == "") {
                gfn_alertMsgBox('비밀번호 2자리 이상 입력하세요.');
                $("#pre_disc_password").focus();
                return;
            }
        
            if (valMonth == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#pre_disc_card_mm').focus();
                return;
            }
        
            if (valYear == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#pre_disc_card_yy').focus();
                return;
            }
        
            if (valBirth == "") {
                gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
                $('#pre_disc_birthday').focus();
                return;
            }
        
            if ($('#chk_pre_disc_agree').prop('checked') == false) {
                gfn_alertMsgBox('결제대행서비스 약관에 모두 동의하셔야 결제하실 수 있습니다.');
                $('#chk_pre_disc_agree').focus();
                return;
            }
        
            var option = {cardNo1:cardNo1  , cardNo2:cardNo2,  cardNo3:cardNo3   , cardNo4:cardNo4  ,
                          cardNo:cardNo    , transNo:transNo,  valMonth:valMonth , valYear:valYear  ,
                          valBirth:valBirth, preDisc:preDisc,  discType:discType ,
                          password:password};
        
            //최종결제 금액 유효성 검사 및 결제 처리
            chkLastPayAmt(option);
        
            //닫기버튼 클릭
            $('#layer_before_sale .close-layer').click();
        }
        </script>
        <input type="hidden" name="preDiscUseAbleAmt" id="preDiscUseAbleAmt" value="0">
            <!-- 레이어  : 선 할인카드 -->
            <section id="layer_before_sale" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">즉시할인카드 <!-- 즉시할인카드 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="pop-tit">
                            카드정보 입력 후 [조회] 버튼을 눌러 최종 결제금액을 확인해 주세요. <!-- 카드정보 입력 후 [조회] 버튼을 눌러 최종 결제금액을 확인해 주세요. -->
                        </div>
        
                        <div class="popup-gray mid-info-box">
                            <div class="pop-search-area">
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="before_sale_card_num">카드번호 <!-- 카드번호 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" title="즉시할인카드 카드번호 첫번째자리 입력" class="input-text x-small w60px" id="preDiscCardNum_1" maxlength="4"> - <!-- 즉시할인카드 카드번호 첫번째자리 입력 -->
                                        <input type="text" title="즉시할인카드 카드번호 두번째자리 입력" class="input-text w60px x-small " id="preDiscCardNum_2" maxlength="4"> - <!-- 즉시할인카드 카드번호 두번째자리 입력 -->
                                        <input type="number" title="즉시할인카드 카드번호 세번째자리 입력" class="input-text w60px x-small pwnew" id="preDiscCardNum_3" maxlength="4" oninput="gfn_numberMaxLength(this);"> - <!-- 즉시할인카드 카드번호 세번째자리 입력 -->
                                        <input type="text" title="즉시할인카드 카드번호 네번째자리 입력" class="input-text w60px x-small " id="preDiscCardNum_4" maxlength="4"> <!-- 즉시할인카드 카드번호 네번째자리 입력 -->
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="before_sale_card_date">카드유효기간 <!-- 카드유효기간 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" id="pre_disc_card_mm" title="즉시할인카드 유효기간 월 입력" placeholder="MM" class="input-text w60px  x-small a-c" maxlength="2"> / <!-- 즉시할인카드 유효기간 월 입력 -->
                                        <input type="text" id="pre_disc_card_yy" title="즉시할인카드 유효기간 년 입력 " placeholder="YY" class="input-text w60px x-small a-c" maxlength="2"><!-- 즉시할인카드 유효기간 년 입력 -->
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset"><label for="pre_disc_password">비밀번호 <!-- 비밀번호 --></label></p>
        
                                    <div class="sh-input">
                                        <input type="text" id="pre_disc_password" title="즉시할인카드 비밀번호 앞 2자리 입력" class="input-text w60px x-small pwnew" maxlength="2"><!-- 즉시할인카드 비밀번호 앞 2자리 입력 -->
                                        <span class="font-size-13 font-gray ml05">앞 2자리 <!-- 앞 2자리 --></span>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line gray">
                                    <p class="sh-txt reset vt"><label for="pre_disc_birthday">생년월일 <!-- 생년월일 --></label></p>
                                    <div class="sh-input mr0">
                                        <input type="text" id="pre_disc_birthday" title="현대 M포인트 카드 생년월일 입력" class="input-text w80px x-small " maxlength="10">
        
                                        <p class="reset inline-block font-size-13 ml05 font-gray">생년월일 6자리(카드소유자) / 사업자번호 10자리 <!-- 생년월일 6자리(카드소유자) / 사업자번호 10자리 --></p>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset">최종결제금액 <!-- 최종결제금액 --></p>
        
                                    <div class="sh-input">
                                        <button type="button" class="button gray x-small" id="btn_pre_disc">조회 <!-- 조회 --></button>
                                    </div>
                                </div>
        
                                <div class="pop-search-area-line">
                                    <p class="sh-txt reset">최종결제금액 <!-- 최종결제금액 --></p>
        
                                    <div class="sh-input" id="pre_disc_all_text"></div>
                                </div>
                            </div>
                        </div>
        
                        <div class="mt10">
                            <input type="checkbox" id="chk_pre_disc_agree">
                            <label for="chk_pre_disc_agree">결제대행서비스 약관에 모두 동의 <!-- 결제대행서비스 약관에 모두 동의 --></label>
        
                            <div class="mt10">
                                <a href="https://www.firstpay.co.kr/jsp/common/agreementPopup.jsp?type=1&amp;langtype=HAN" title="전자금융거래 이용약관" target="_blank" class="a-link ml20">전자금융거래 이용약관 <!-- 전자금융거래 이용약관 --> <i class="iconset ico-arr-right-green"></i></a>
                                <a href="https://www.firstpay.co.kr/jsp/common/agreementPopup.jsp?type=3&amp;langtype=HAN" title="개인정보의 수집 및 이용안내" target="_blank" class="a-link ml20">개인정보의 수집 및 이용안내 <!-- 개인정보의 수집 및 이용안내 --> <i class="iconset ico-arr-right-green"></i></a>
                                <a href="https://www.firstpay.co.kr/jsp/common/agreementPopup.jsp?type=4&amp;langtype=HAN" title="개인정보 제공 및 위탁안내" target="_blank" class="a-link ml20">개인정보 제공 및 위탁안내 <!-- 개인정보 제공 및 위탁안내 --> <i class="iconset ico-arr-right-green"></i></a>
                            </div>
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button small close-layer">닫기 <!-- 닫기 --></button>
                        <button type="button" class="button small purple" id="btn_pay_pre_disc">결제 <!-- 결제 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close">레이어 닫기 <!-- 레이어 닫기 --></button>
                </div>
            </section>
        
            <!--// 레이어 : 즉시할인 -->
        
            <!-- 레이어 : 구인증 -->
            
        
        
        
        
        
        <script type="text/javascript">
        var favorCreditChgInfo = new Object();
        
        //초기화 공통 sMethodName.init
        function favorCreditCard_init() {  //구인증 전체초기화
            $('h3.tit').text($("#card_select option:selected").text())
        
            // 초기화
            $('#favorCreditCardNum_1').val('');
            $('#favorCreditCardNum_2').val('');
            $('#favorCreditCardNum_3').val('');
            $('#favorCreditCardNum_4').val('');
            $('#favorCredit_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
            $('#favorCredit_card_mm').val('');
            $('#favorCredit_card_yy').val('');
            $('#favorCredit_card_birthday').val('');
            $('#favorCredit_card_password').val('');
        
            favorCreditCardInfo();
        
            var remainAmt = $('.pay-area > .pay').eq(0).find('.money').find('em').text().replaceAll(',', '');
            $('.ria-finish-box > .right > b').text(String(remainAmt).maskNumber());
        }
        
        
        $(function() {
            //숫자만 입력가능
            $('#favorCreditCardNum_1').megaBoxNumberCheck();
            $('#favorCreditCardNum_2').megaBoxNumberCheck();
            $('#favorCreditCardNum_3').megaBoxNumberCheck();
            $('#favorCreditCardNum_4').megaBoxNumberCheck();
            $('#favorCredit_card_birthday').megaBoxNumberCheck();  //생년월일/사업자번호 숫자만 입력
            $('#favorCredit_card_mm').megaBoxNumberCheck();  //유효기간 숫자만 입력
            $('#favorCredit_card_yy').megaBoxNumberCheck();  //유효기간 숫자만 입력
        
            //상담원예매 결제 버튼 클릭
            $("#btn_favorCredit_booking").on('click', function() {
                payfavorCredit();
            });
        
        });
        
        
        //상담원예매 카드정보 불러오기 버튼 클릭
        function favorCreditCardInfo(){
            var cardCd = $("#card_select option:selected").val();
        
            var paramData = { forwordView : 'false', cardCd : cardCd};
        
            $.ajax({
                url    : "/on/oh/ohh/PersonInfoMng/selectFavorUseCreditCardLa.do",
                type: "POST",
                contentType: "application/json;charset=UTF-8",
                dataType: "json",
                data   : JSON.stringify(paramData),
                success: function(result){
        
                    if("0" != result.statCd){
                        gfn_alertMsgBoxSize(result.msg,400,250);
                    }
                    else {
        
                        if(result.mbFavorCreditCard.length > 0){
                            $.each(result.mbFavorCreditCard, function (i, item) {
                                if(item.cardCd == cardCd) {
                                    var cardNos = item.cardNoOrg;
        
                                    $('#favorCreditCardNum_1').val(cardNos.substring(0,4));
                                    $('#favorCreditCardNum_2').val(cardNos.substring(4,8));
                                    $('#favorCreditCardNum_3').val(cardNos.substring(8,12));
                                    $('#favorCreditCardNum_4').val(cardNos.substring(12,16));
        
                                    return false;
                                }
                            });
                        }
                    }
        
                }
        //         , beforeSend : function() {
        //     	}
        //     	, complete : function() {
        //     		setTimeout(function(){
        //     		},1500);
        //     	}
        
            });
        
        }
        
        //상담원 결제
        function payfavorCredit() {
            var cardNo1  = $("#favorCreditCardNum_1").val();
            var cardNo2  = $("#favorCreditCardNum_2").val();
            var cardNo3  = $("#favorCreditCardNum_3").val();
            var cardNo4  = $("#favorCreditCardNum_4").val();
            var cardNo   = cardNo1 + cardNo2 + cardNo3 + cardNo4;
            var password = $("#favorCredit_card_password").val();
        
            var valBirth   = $('#favorCredit_card_birthday').val();  //생년월일/사업자번호 숫자만 입력
            var valMonth   = $('#favorCredit_card_mm').val();  //유효기간 숫자만 입력
            var valYear    = $('#favorCredit_card_yy').val();  //유효기간 숫자만 입력
            var preDisc    = 'Y';
            var discType   = '';
        // 	var favorCredit_fee = $('#chk_favorCredit_fee').prop('checked')==true?"Y":"N";
        
            if (cardNo1 == "" || cardNo2 == "" || cardNo3 == "" || cardNo4 == "") {
                gfn_alertMsgBox('카드 번호를 입력하세요.');
                return;
            }
        
            if (password == "") {
                gfn_alertMsgBox('비밀번호 2자리 이상 입력하세요.');
                $("#favorCredit_card_password").focus();
                return;
            }
        
            if (valMonth == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#favorCredit_card_mm').focus();
                return;
            }
        
            if (valYear == "") {
                gfn_alertMsgBox('카드 유효기간을 입력하세요.');
                $('#favorCredit_card_yy').focus();
                return;
            }
        
            if (valBirth == "") {
                gfn_alertMsgBox('생년월일(사업자번호)을 입력하세요.');
                $('#favorCredit_card_birthday').focus();
                return;
            }
        
            if($("input:checkbox[id='checkbox']").is(":checked") == false) {
                gfn_alertMsgBox('결제대행서비스 약관에 모두 동의하셔야 결제하실 수 있습니다.');
                $('#allchk').focus();
                return;
            }
        
            var option = {cardNo1:cardNo1, cardNo2:cardNo2, cardNo3:cardNo3, cardNo4:cardNo4, cardNo:cardNo,
                    password:password, valMonth:valMonth, valYear:valYear, preDisc:preDisc,
                    discType:discType, valBirth:valBirth, password:password};
        
            $('#lastPayMethod').val('credit');
            $('#preDisc').val(preDisc);
            $('#discType').val(discType);
        
            //최종결제 금액 유효성 검사 및 결제 처리
            chkLastPayAmt(option);
        
        }
        </script>
        
        <!-- 레이어  : 리아 결제 -->
        <section id="layer_favor_credit" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
            <div class="wrap">
                <header class="layer-header">
                    <h3 class="tit"></h3>
                </header>
        
                <div class="layer-con">
                    
        
                    <div class="popup-gray mid-info-box">
                        <div class="pop-search-area">
                            <div class="pop-search-area-line">
                                <p class="sh-txt reset"><label for="ria_card_num">카드번호 <!-- 카드번호 --></label></p>
        
                                <div class="sh-input">
                                    <input type="text" id="favorCreditCardNum_1" title="체크/신용카드 카드번호 첫번째자리 입력" class="input-text x-small w60px" maxlength="4"><!-- 체크/신용카드 카드번호 첫번째자리 입력 --> -
                                    <input type="text" id="favorCreditCardNum_2" title="체크/신용카드 카드번호 두번째자리 입력" class="input-text w60px x-small " maxlength="4"> <!-- 체크/신용카드 카드번호 두번째자리 입력 --> -
                                    <input type="text" id="favorCreditCardNum_3" title="체크/신용카드 카드번호 세번째자리 입력" class="input-text w60px x-small pwnew" maxlength="4" oninput="gfn_numberMaxLength(this);"> <!-- 체크/신용카드 카드번호 세번째자리 입력 --> -
                                    <input type="text" id="favorCreditCardNum_4" title="체크/신용카드 카드번호 네번째자리 입력" class="input-text w60px x-small " maxlength="4"><!-- 체크/신용카드 카드번호 네번째자리 입력 -->
                                </div>
                            </div>
        
                            <div class="pop-search-area-line">
                                <p class="sh-txt reset"><label for="favorCredit_card_mm">유효기간 <!-- 유효기간 --></label></p>
        
                                <div class="sh-input">
                                    <input type="text" id="favorCredit_card_mm" title="체크/신용카드 유효기간 월 입력" placeholder="MM" class="input-text w60px  x-small a-c" maxlength="2"><!-- 체크/신용카드 유효기간 월 입력 --> /
                                    <input type="text" id="favorCredit_card_yy" title="체크/신용카드 유효기간 년 입력" placeholder="YY" class="input-text w60px x-small a-c" maxlength="2"><!-- 체크/신용카드 유효기간 년 입력 -->
                                </div>
                            </div>
        
                            <div class="pop-search-area-line">
                                <p class="sh-txt reset"><label for="favorCredit_card_password">비밀번호 <!-- 비밀번호 --></label></p>
        
                                <div class="sh-input">
                                    <input type="text" id="favorCredit_card_password" title="체크/신용카드 비밀번호 앞 2자리 입력" class="input-text w130px x-small pwnew" maxlength="2"><!-- 체크/신용카드 비밀번호 앞 2자리 입력 -->
                                    <span class="font-size-13 font-gray ml05">앞 2자리</span><!-- 앞 2자리 -->
                                </div>
                            </div>
        
                            <div class="pop-search-area-line gray">
                                <p class="sh-txt reset vt"><label for="favorCredit_card_birthday">생년월일 <!-- 생년월일 --></label></p>
                                <div class="sh-input mr0">
                                    <input type="text" id="favorCredit_card_birthday" title="체크/신용카드 생년월일 입력" class="input-text w130px x-small pwnew" maxlength="10"><!-- 체크/신용카드 생년월일 입력 -->
        
                                    <p class="reset inline-block font-size-13 ml05 font-gray">생년월일 6자리(카드소유자) / 사업자번호 10자리 <!-- 생년월일 6자리(카드소유자) / 사업자번호 10자리 --></p>
                                </div>
                            </div>
        
                            
                        </div>
                    </div>
        
        
        
        
                    <div class="ria-pro-box">
                        <div class="tp">
                            <input type="checkbox" id="checkbox">
                            <label for="checkbox">결제대행서비스 약관에 모두 동의</label>
                        </div>
                        <ul class="linklist">
                            <li><a href="https://www.firstpay.co.kr/jsp/common/agreementPopup.jsp?type=1&amp;langtype=HAN" title="전자금융거래 이용약관" target="_blank">전자금융거래 이용약관 &gt;</a></li>
                            <li><a href="https://www.firstpay.co.kr/jsp/common/agreementPopup.jsp?type=3&amp;langtype=HAN" title="개인정보의 수집 및 이용안내" target="_blank">개인정보의 수집 및 이용안내 &gt;</a></li>
                            <li><a href="https://www.firstpay.co.kr/jsp/common/agreementPopup.jsp?type=4&amp;langtype=HAN" title="개인정보 제공 및 위탁안내" target="_blank">개인정보 제공 및 위탁안내 &gt;</a></li>
                        </ul>
                    </div>
        
        
                </div>
        
                <div class="btn-group-fixed">
                    <button type="button" class="button small close-layer" id="btn_cancel_favorCredit_booking">취소 <!-- 취소 --></button>
                    <button type="button" class="button small purple" id="btn_favorCredit_booking">결제 <!-- 결제 --></button>
                </div>
        
                <button type="button" class="btn-modal-close">레이어 닫기 <!-- 레이어 닫기 --></button>
            </div>
        </section>
        
            <!--// 레이어 : 구인증 -->
        
            <!-- 레이어 : 해피머니 - 해피캐시 -->
            
        
        
        
        
        
        <script type="text/javascript">
        
        var happcashInfo = {};				
        
        function happcash_init() {
            happcashInfo = {};
            $("#happcashId").val("");
            $("#happcashPwd").val("");
            $("#happcashAbleCash").text("0");
            $("#happcashUseCash").val("");
        }
        var happcash = {
            
            
            fn_post : function(options){
                
                if(!options.url){
                    gfn_alertMsgBox("must set options property !");
                }
                
                options.data = options.data || {};
                
                
                if(!options.success){
                    options.success = function(data, textStatus, jqXHR){
                        gfn_alertMsgBox("must define success callback");
                    }
                }
                
                if(!options.error){
                    //  jqXHR jqXHR, String textStatus, String errorThrown
                    options.error = function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
        
                        // 메시지 변경처리
                        err.msg = err.msg || '';
                        if(err.msg.indexOf('회원오류')>=0){
                            gfn_alertMsgBox('존재하지 않는 아이디 입니다.');
                        }else if(err.msg.indexOf('결제비밀번호')>=0 || err.msg.indexOf('로그인 비밀번호')>=0){ 
                            gfn_alertMsgBox('결제비밀번호를 확인 바랍니다.');
                        }else{
                            gfn_alertMsgBox(err.msg);
                        }
                    }
                }
        
                $.ajax({
                  url: options.url,
                  type: "POST",
                  contentType: "application/json;charset=UTF-8",
                  dataType: "json",
                  data: JSON.stringify(options.data),
                  success: options.success,
                  error: options.error,
                  beforeSend : function() {
                      $(options.block).prop("disabled", true);
                      $(options.block).addClass('disabled');
                    }
                    , complete : function() {
                    setTimeout(function(){
                        $(options.block).removeClass('disabled');
                        $(options.block).prop("disabled", false);
                    },1500);
                    }
                });
            },
            
            fn_searchPoint : function() {
        
                
                var happcashId = $.trim($("#happcashId").val());
                if (happcashId == "") {
                    gfn_alertMsgBox('해피머니 아이디를 입력 바랍니다.');
                    $("#happcashId").focus();
                    return;
                }
        
                
                var happcashPwd = $.trim($("#happcashPwd").val());
                if (happcashPwd.length != 6) {
                    gfn_alertMsgBox('결재비밀번호 6자리를 입력 바랍니다.');
                    $("#happcashPwd").focus();
                    return;
                }
        
                
                happcash.fn_post({
                    url : "/on/oh/ohz/PayBooking/searchHappcash.do",
                    block : "#happcashSearch",
                    data : { transNo:$("#transNo").val(), authValue:$("#happcashId").val(), payPwd:$("#happcashPwd").val() },
                    success : function(data, textStatus, jqXHR){
                        // gfn_alertMsgBox(JSON.stringify(data));
        
                        
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
        
                        
                        
                        happcashInfo = data.happcashInfo;
                        //console.log('data', data);
        
                        $('#happcashAbleCash').text( happcash.get_money_str(happcashInfo.balance) );
                        $("#happcashUseCash").val('');	 
                    }
                });
            },
            
            get_money_num : function(source){
                var _money = parseInt(String(source).replace(/[^0-9]/g,''));
                if(isNaN(_money)){
                    return 0;
                }
                return _money;
            },
            
            get_money_str : function(source){
                var _money = parseInt(String(source).replace(/[^0-9]/g,''));
                if(isNaN(_money)){
                    _money = 0;
                }
                return String(_money).maskNumber();
            },
            
            fn_applyAbleCash : function () {
                var useAbleAmt = happcash.get_money_num(happcashInfo.balance);		
                var remainAmt = happcash.get_money_num($('.pay-area > .pay').eq(0).find('.money').find('em').text());	
                var isChecked = $("#happcashUseCashAll").prop("checked");
        
                
                if (useAbleAmt == 0) {
                    gfn_alertMsgBox('사용가능 포인트가 없습니다.');
                    return;
                }
        
                
                var maxAmt = (useAbleAmt>remainAmt) ? remainAmt : useAbleAmt;
                maxAmt = useAbleAmt>0?parseInt(maxAmt/100) * 100:0;
                $("#happcashUseCash").val(happcash.get_money_str(maxAmt));
            },
            
            fn_applyCash : function () {
                var transNo    = $("#transNo").val(); 
                var useAmt     = happcash.get_money_num($("#happcashUseCash").val());	
                var useAbleAmt = happcash.get_money_num(happcashInfo.balance);			
                var remainAmt = happcash.get_money_num($('.pay-area > .pay').eq(0).find('.money').find('em').text());	
        
                
                var happcashId = $.trim($("#happcashId").val());
                if (happcashId == "") {
                    gfn_alertMsgBox('해피머니 아이디를 입력 바랍니다.');
                    return;
                }
        
                
                var happcashPwd = $.trim($("#happcashPwd").val());
                if (happcashPwd.length != 6) {
                    gfn_alertMsgBox('결재비밀번호 6자리를 입력 바랍니다.');
                    return;
                }
        
                
                var happcashAbleCash = happcash.get_money_num($("#happcashAbleCash").text());	
                if (happcashAbleCash == 0) {
                    gfn_alertMsgBox('해피머니 잔액을 조회 바랍니다.');
                    return;
                }
        
                
                if (useAmt == 0) {
                    gfn_alertMsgBox('사용할 금액을 입력 바랍니다.');
                    return;
                }
        
        
                
                if ( useAmt > useAbleAmt ) {
                    gfn_alertMsgBox('사용금액(#1)이 보유금액(#2)을 초과 했습니다.'.replace('#1',happcash.get_money_str(useAmt)).replace('#2',happcash.get_money_str(useAbleAmt)));
                    $("#happcashUseCash").focus();
                    return;
                }
        
                
                if ( parseInt(useAmt) > parseInt(remainAmt) ) {
                    gfn_alertMsgBox('사용 금액(#1)이 결제 금액(#2)보다 큽니다.'.replace('#1',happcash.get_money_str(useAmt)).replace('#2',happcash.get_money_str(remainAmt)));
                    $("#happcashUseCash").focus();
                    return;
                }
        
                
                if (parseInt(useAmt) % 100 != 0) {
                    gfn_alertMsgBox('100원 단위로 사용 가능합니다.');
                    $("#happcashUseCash").focus();
                    return;
                }
        
                
                
                happcash.fn_post({
                    url : "/on/oh/ohz/PayBooking/applyHappcash.do",
                    block : "#btn_apply_happcash",
                    data : { transNo:$("#transNo").val(), useAmt:useAmt, authValue:$("#happcashId").val(), payKey:happcashInfo.payKey },
                    success : function(data, textStatus, jqXHR){
                        
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
                        //console.log('data', data);
                        
                        setMovieDcInfo(data.policyList);
        
                        $('#btn_cancel_happcash').show(); 					// 취소버튼
                        $('#btn_cancel_apply_happcash').show(); 			// 버튼 - 적용취소
                        $('#layer_happcash .close-layer').click();			// 버튼 - 닫기
                    }
                });
            }
        };
        
        
        $(function() {
            // 버튼 - 조회
            $('#happcashSearch').on('click', function() {
                happcash.fn_searchPoint();
            });
        
            // 버튼 - 적용
            $('#btn_apply_happcash').on('click', function() {
                happcash.fn_applyCash();
            });
        
            // 버튼 - 모두사용
            $('#happcashUseCashAll').on('click', function() {
                happcash.fn_applyAbleCash();
            });
        
            // 버튼 - 적용취소
            $('#btn_cancel_apply_happcash').on('click', function() {
                cancelMbxSellCpInfo('happcash');
                   $('#layer_happcash .close-layer').click();
            });
        
            // 버튼 - 닫기
            $('#btn_close_happcash, #btn_close_modal_happcash').on('click', function() {
                if (!$('#btn_cancel_apply_happcash').is(':visible')) {	// 적용취소 버튼이 보이지 않으면 초기화
                    happcash_init();
                }
            });
        });
        
        </script>
        <!--// 레이어 : 해피머니 - 해피캐시 (PC) START -->
        <section id="layer_happcash" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
            <div class="wrap">
                <header class="layer-header">
                    <h3 class="tit">해피머니상품권 해피캐시 </h3>
                </header>
        
                <div class="layer-con">
        
                    <div class="reset">
                        해피머니 아이디와 비밀번호를 입력 후 조회해주세요. 
                    </div>
        
                    <div class="popup-gray mid-info-box mb10">
                        <div class="pop-search-area line-wid">
        
                            <div class="pop-search-area-line">
                                <p class="sh-txt reset"><label for="happcashId">아이디</label></p>
                                <div class="sh-input">
                                    <input type="text" id="happcashId" title="해피머니 아이디 입력" class="input-text w200px x-small" maxlength="20">
                                </div>
                            </div>
        
                            <div class="pop-search-area-line">
                                <p class="sh-txt reset"><label for="happcashPwd">비밀번호</label></p>
                                <div class="sh-input">
                                    <input type="text" id="happcashPwd" title="비밀번호 입력" class="input-text w120px x-small pwnew" maxlength="6">
                                </div>
        
                                <div class="sh-btn">
                                    <button type="button" class="button x-small gray" id="happcashSearch">조회</button>
                                </div>
                            </div>
        
                            <div class="pop-search-area-line">
                                <p class="sh-txt reset">보유금액</p>
                                <span class="font-green" id="happcashAbleCash">0</span> 원
                            </div>
        
                            <div class="pop-search-area-line">
                                <p class="sh-txt reset"><label for="happcashUseCash">사용할금액</label></p>
                                <input type="text" id="happcashUseCash" title="사용할 금액을 입력 바랍니다." class="input-text w200px x-small" maxlength="10">
        
                                <div class="sh-btn ml05">
                                    <button type="button" class="button gray-line x-small" id="happcashUseCashAll">모두사용</button>
                                </div>
                            </div>
        
                        </div>
                    </div>
        
                    <div class="box-border v1 use-guide mt10">
                        <p class="tit">이용안내</p>
        
                        <ul class="dot-list gray">
                            <li>해피머니 아이디와 비밀번호를 통해 조회 후 사용하실 수 있습니다.</li>
                            <li>조회된 보유금액에 한해 100원 단위로 사용 가능합니다.</li>
                            
                            <li>환불관련 문의 : 1588-5245</li>
                        </ul>
                    </div>
                </div>
        
                <div class="btn-group-fixed">
                    <button type="button" class="button small close-layer" id="btn_close_happcash">닫기</button>
                    <button type="button" class="button small purple" id="btn_cancel_apply_happcash" style="display:none;">적용취소</button>
                    <button type="button" class="button small purple" id="btn_apply_happcash">적용</button>
                </div>
        
                <button type="button" class="btn-modal-close" id="btn_close_modal_happcash">레이어 닫기</button>
            </div>
        </section>
        <!--// 레이어 : 해피머니 - 해피캐시 (PC) END -->
            <!--// 레이어 : 해피머니 - 해피캐시 -->
        
            <!-- 레이어 : 해피머니 - 해피머니상품권  -->
            
        
        
        
        
        
        <script type="text/javascript">
        
        var happgiftInfo = {};				
        
        function happgift_init() {
            happgiftInfo = {};
            $("#happgiftId").val("");
            $("#happgiftId_hid").val("");
            $("#happgiftPwd").val("");
            $("#happgiftAbleCash").text("0");
            $("#happgiftUseCash").val("");
        }
        var happgift = {
            
            
            fn_post : function(options){
                
                if(!options.url){
                    gfn_alertMsgBox("must set options property !");
                }
                
                options.data = options.data || {};
                
                
                if(!options.success){
                    options.success = function(data, textStatus, jqXHR){
                        gfn_alertMsgBox("must define success callback");
                    }
                }
                
                if(!options.error){
        
        
                    //  jqXHR jqXHR, String textStatus, String errorThrown
                    options.error = function(xhr,status,error){
                        var err = JSON.parse(xhr.responseText);
        
                        // 메시지 변경처리
                        err.msg = err.msg || '';
                        if(err.msg.indexOf('사용가능 상품권')>=0){
                            gfn_alertMsgBox('사용 가능한 상품권이 없습니다.');
                        }else{
                            gfn_alertMsgBox(err.msg);
                        }
                    }
                }
        
                $.ajax({
                  url: options.url,
                  type: "POST",
                  contentType: "application/json;charset=UTF-8",
                  dataType: "json",
                  data: JSON.stringify(options.data),
                  success: options.success,
                  error: options.error,
                  beforeSend : function() {
                      $(options.block).prop("disabled", true);
                      $(options.block).addClass('disabled');
                    }
                    , complete : function() {
                    setTimeout(function(){
                        $(options.block).removeClass('disabled');
                        $(options.block).prop("disabled", false);
                    },1500);
                    }
                });
            },
            
            fn_searchPoint : function() {
        
                
                var happgiftId = $.trim($("#happgiftId_hid").val());
                if (happgiftId == "") {
                    gfn_alertMsgBox('PIN번호를 입력 바랍니다.');
                    return;
                }
        
                
                var happgiftPwd = $.trim($("#happgiftPwd").val());
                if (happgiftPwd.length != 8) {
                    gfn_alertMsgBox('인증번호(발행일) 8자리를 입력 바랍니다.');
                    return;
                }
        
                
                happgift.fn_post({
                    url : "/on/oh/ohz/PayBooking/searchHappgift.do",
                    block : "#happgiftSearch",
                    data : { transNo:$("#transNo").val(), giftInfoCnt:"01", giftInfo: happgift.fn_gift_info($("#happgiftId_hid").val(),$("#happgiftPwd").val()) },
                    success : function(data, textStatus, jqXHR){
                        // gfn_alertMsgBox(JSON.stringify(data));
        
                        
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
        
                        
                        
                        happgiftInfo = data.happgiftInfo;
        
                        $('#happgiftAbleCash').text( happgift.get_money_str(happgiftInfo.balance) );
                        $("#happgiftUseCash").val('');	 
                    }
                });
            },
            
            get_money_num : function(source){
                var _money = parseInt(String(source).replace(/[^0-9]/g,''));
                if(isNaN(_money)){
                    return 0;
                }
                return _money;
            },
            
            get_money_str : function(source){
                var _money = parseInt(String(source).replace(/[^0-9]/g,''));
                if(isNaN(_money)){
                    _money = 0;
                }
                return String(_money).maskNumber();
            },
            
            fn_applyAbleCash : function () {
                var useAbleAmt = happgift.get_money_num(happgiftInfo.balance);		
                var remainAmt = happgift.get_money_num($('.pay-area > .pay').eq(0).find('.money').find('em').text());	
                var isChecked = $("#happgiftUseCashAll").prop("checked");
        
                
                if (useAbleAmt == 0) {
                    gfn_alertMsgBox('사용가능 포인트가 없습니다.');
                    return;
                }
        
                
                var maxAmt = (useAbleAmt>remainAmt) ? remainAmt : useAbleAmt;
                maxAmt = useAbleAmt>0?parseInt(maxAmt/100) * 100:0;
                $("#happgiftUseCash").val(happgift.get_money_str(maxAmt));
            },
            
            fn_applyCash : function () {
                var transNo    = $("#transNo").val(); 
                var useAmt     = happgift.get_money_num($("#happgiftUseCash").val());	
                var useAbleAmt = happgift.get_money_num(happgiftInfo.balance);			
                var remainAmt = happgift.get_money_num($('.pay-area > .pay').eq(0).find('.money').find('em').text());	
        
                
                var happgiftId = $.trim($("#happgiftId_hid").val());
                if (happgiftId == "") {
                    gfn_alertMsgBox('PIN번호를 입력 바랍니다.');
                    return;
                }
        
                
                var happgiftPwd = $.trim($("#happgiftPwd").val());
                if (happgiftPwd.length != 8) {
                    gfn_alertMsgBox('인증번호(발행일) 8자리를 입력 바랍니다.');
                    return;
                }
        
                
                var happgiftAbleCash = happgift.get_money_num($("#happgiftAbleCash").text());	
                if (happgiftAbleCash == 0) {
                    gfn_alertMsgBox('해피머니 잔액을 조회 바랍니다.');
                    return;
                }
        
                
                if (useAmt == 0) {
                    gfn_alertMsgBox('사용할 금액을 입력 바랍니다.');
                    return;
                }
        
        
                
                if ( useAmt > useAbleAmt ) {
                    gfn_alertMsgBox('사용금액(#1)이 보유금액(#2)을 초과 했습니다.'.replace('#1',happgift.get_money_str(useAmt)).replace('#2',happgift.get_money_str(useAbleAmt)));
                    $("#happgiftUseCash").focus();
                    return;
                }
        
                
                if ( parseInt(useAmt) > parseInt(remainAmt) ) {
                    gfn_alertMsgBox('사용 금액(#1)이 결제 금액(#2)보다 큽니다.'.replace('#1',happgift.get_money_str(useAmt)).replace('#2',happgift.get_money_str(remainAmt)));
                    $("#happgiftUseCash").focus();
                    return;
                }
        
                
                if (parseInt(useAmt) % 100 != 0) {
                    gfn_alertMsgBox('100원 단위로 사용 가능합니다.');
                    $("#happgiftUseCash").focus();
                    return;
                }
        
                
                
                happgift.fn_post({
                    url : "/on/oh/ohz/PayBooking/applyHappgift.do",
                    block : "#btn_apply_happgift",
                    data : { transNo:$("#transNo").val(), useAmt:useAmt, giftInfoCnt:"01", giftInfo: happgift.fn_gift_info($("#happgiftId_hid").val(),$("#happgiftPwd").val()) },
                    success : function(data, textStatus, jqXHR){
                        
                        if (!msgBookingLoginChk(data)) {
                            return;
                        }
                        //console.log('data', data);
                        
                        setMovieDcInfo(data.policyList);
        
                        $('#btn_cancel_happgift').show(); 					// 취소버튼
                        $('#btn_cancel_apply_happgift').show(); 			// 버튼 - 적용취소
                        $('#layer_happgift .close-layer').click();			// 버튼 - 닫기
                    }
                });
            },
            
            fn_gift_info : function(pin, issue_date){
                if(!pin || !issue_date){
                    return '';
                }
                return pin.rpad(30, " ") + issue_date;
            }
        };
        
        
        $(function() {
            // 버튼 - 조회
            $('#happgiftSearch').on('click', function() {
                happgift.fn_searchPoint();
            });
        
            // 버튼 - 적용
            $('#btn_apply_happgift').on('click', function() {
                happgift.fn_applyCash();
            });
        
            // 버튼 - 모두사용
            $('#happgiftUseCashAll').on('click', function() {
                happgift.fn_applyAbleCash();
            });
        
            // 버튼 - 적용취소
            $('#btn_cancel_apply_happgift').on('click', function() {
                cancelMbxSellCpInfo('happgift');
                   $('#layer_happgift .close-layer').click();
            });
        
            // 버튼 - 닫기
            $('#btn_close_happgift, #btn_close_modal_happgift').on('click', function() {
                if (!$('#btn_cancel_apply_happgift').is(':visible')) {	// 적용취소 버튼이 보이지 않으면 초기화
                    happgift_init();
                }
            });
        
            // 숫자만 입력 가능 - PIN번호, 사용할 금액
            $("#happgiftId").megaBoxCardNumberCheck();
        });
        
        </script>
        <!--// 레이어 : 해피머니 - 해피머니상품권PIN (PC) START -->
        <input type="hidden" id="happgiftId_hid">
        <section id="layer_happgift" class="modal-layer"><a href="" class="focus">레이어로 포커스 이동 됨</a>
            <div class="wrap">
                <header class="layer-header">
                    <h3 class="tit">해피머니 모바일 문화상품권 </h3>
                </header>
        
                <div class="layer-con">
        
                    <div class="reset">
                        보유하고 계신 해피머니 모바일 상품권(지류/모바일)의 PIN번호와 인증번호를 입력해주세요. 
                    </div>
        
                    <div class="popup-gray mid-info-box mb10">
                        <div class="pop-search-area line-wid">
        
                            <div class="pop-search-area-line">
                                <p class="sh-txt reset"><label for="happgiftId">PIN번호</label></p>
                                <div class="sh-input">
                                    <input type="text" id="happgiftId" title="핀번호 입력" class="input-text w200px x-small" maxlength="20">
                                </div>
                            </div>
        
                            <div class="pop-search-area-line">
                                <p class="sh-txt reset"><label for="happgiftPwd">인증번호</label></p>
                                <div class="sh-input">
                                    <input type="text" id="happgiftPwd" title="인증번호(발행일) 입력" class="input-text w120px x-small pwnew" maxlength="8">
                                </div>
        
                                <div class="sh-btn">
                                    <button type="button" class="button x-small gray" id="happgiftSearch">조회</button>
                                </div>
                            </div>
        
                            <div class="pop-search-area-line">
                                <p class="sh-txt reset">보유금액</p>
                                <span class="font-green" id="happgiftAbleCash">0</span> 원
                            </div>
        
                            <div class="pop-search-area-line">
                                <p class="sh-txt reset"><label for="happgiftUseCash">사용할금액</label></p>
                                <input type="text" id="happgiftUseCash" title="사용할 금액을 입력 바랍니다." class="input-text w200px x-small" maxlength="10">
        
                                <div class="sh-btn ml05">
                                    <button type="button" class="button gray-line x-small" id="happgiftUseCashAll">모두사용</button>
                                </div>
                            </div>
        
                        </div>
                    </div>
        
                    <div class="box-border v1 use-guide mt10">
                        <p class="tit">이용안내</p>
        
                        <ul class="dot-list gray">
                            <li>소지하신 지류/모바일 PIN번호 16자리와 인증번호 8자리를 입력 후 이용하실 수 있습니다.</li>
                            <li>조회된 보유금액에 한해 100원 단위로 사용 가능합니다.</li>
                            <li>예매 취소 시 사용하신 PIN번호는 재확인이 불가하므로 사용하신 상품권은 관람 완료시까지 소지하시기 바랍니다.</li>
                            <li>환불관련 문의 : 1588-5245</li>
                        </ul>
                    </div>
                </div>
        
                <div class="btn-group-fixed">
                    <button type="button" class="button small close-layer" id="btn_close_happgift">닫기</button>
                    <button type="button" class="button small purple" id="btn_cancel_apply_happgift" style="display:none;">적용취소</button>
                    <button type="button" class="button small purple" id="btn_apply_happgift">적용</button>
                </div>
        
                <button type="button" class="btn-modal-close" id="btn_close_modal_happgift">레이어 닫기</button>
            </div>
        </section>
        <!--// 레이어 : 해피머니 - 해피머니상품권PIN (PC) END -->
            <!--// 레이어 : 해피머니 - 해피머니상품권 -->
        
            <!-- 레이어 : 5분연장 -->
            <section id="layer_time_delay" class="modal-layer" style="z-index:4000;"><a href="" class="focus">레이어로 포커스 이동 됨</a>
                <div class="wrap">
                    <header class="layer-header">
                        <h3 class="tit">알림<!-- 알림 --></h3>
                    </header>
        
                    <div class="layer-con">
                        <div class="pop-tit">
                            예매가능시간이 1분 남았습니다.<br>연장하시겠습니까? (1회만 가능)
                            <!-- 예매가능시간이 1분 남았습니다.<br />
                            연장하시겠습니까? (1회만 가능) -->
                        </div>
                    </div>
        
                    <div class="btn-group-fixed">
                        <button type="button" class="button purple" id="delayFiveMin">5분연장하기<!-- 5분연장하기 --></button>
                        <button type="button" class="button close-layer" id="delayFiveMinClose">취소<!-- 취소 --></button>
                    </div>
        
                    <button type="button" class="btn-modal-close">레이어 닫기<!-- 레이어 닫기 --></button>
                </div>
            </section>
        
            <a href="#layer_cash_bill" w-data="600" h-data="400" class="button active btn-modal-open target" id="cash_pop" style="display:none;" title="현금영수증">현금영수증<!-- 현금영수증 --></a>
            <a href="#layer_before_sale" w-data="600" h-data="550" class="button active btn-modal-open target" id="pre_disc_pop" style="display:none;" title="선할인">선할인</a>
            <!--// 레이어 : 5분연장 -->
        
        
        
        <div class="normalStyle" style="display:none;position:fixed;top:0;left:0;background:#000;opacity:0.7;text-indent:-9999px;width:100%;height:100%;z-index:100;">닫기</div><div class="alertStyle" style="display:none;position:fixed;top:0px;left:0px;background:#000;opacity:0.7;width:100%;height:100%;z-index:5005;"></div><div class="tooltip-layer" style="display: block; min-width: 200px; z-index: 501; opacity: 0; pointer-events: none;"><div class="wrap" style="min-width: 200px;"><div class="tit-area" style="display: none;"></div><div class="cont-area"></div></div><button class="btn-close-tooltip" style="display: none;">툴팁 닫기</button></div><div class="tipPin" style="position: absolute; top: 0px; left: 0px; width: 22px; height: 12px; opacity: 0; z-index: 501;"></div><span class="tempspan4wth" style="position: absolute; display: block; font-size: 15px; opacity: 0;"></span></body>
</html>